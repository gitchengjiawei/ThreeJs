(function(w,K){"object"===typeof exports&&"undefined"!==typeof module?K(exports):"function"===typeof define&&define.amd?define(["exports"],K):(w=w||self,K(w.mapvgl={}))})(this,function(w){function K(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e["default"]:e}function H(e,c){return c={exports:{}},e(c,c.exports),c.exports}function Le(e,c){return function(a){return c(e(a))}}function Me(e){var c=function(a){if(void 0===a||null===a)return a;1<arguments.length&&(a=Array.prototype.slice.call(arguments));
return e(a)};"conversion"in e&&(c.conversion=e.conversion);return c}function Ne(e){var c=function(a){if(void 0===a||null===a)return a;1<arguments.length&&(a=Array.prototype.slice.call(arguments));var b=e(a);if("object"===("undefined"===typeof b?"undefined":jc(b)))for(var d=b.length,c=0;c<d;c++)b[c]=Math.round(b[c]);return b};"conversion"in e&&(c.conversion=e.conversion);return c}function ba(e,c){if(!(this instanceof ba))return new ba(e,c);c&&c in Zc&&(c=null);if(c&&!(c in qa))throw Error("Unknown model: "+
c);if("undefined"===typeof e)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(e instanceof ba)this.model=e.model,this.color=e.color.slice(),this.valpha=e.valpha;else if("string"===typeof e){c=mb.get(e);if(null===c)throw Error("Unable to parse color from string: "+e);this.model=c.model;var a=qa[this.model].channels;this.color=c.value.slice(0,a);this.valpha="number"===typeof c.value[a]?c.value[a]:1}else if(e.length)this.model=c||"rgb",a=qa[this.model].channels,c=kc.call(e,0,a),this.color=lc(c,
a),this.valpha="number"===typeof e[a]?e[a]:1;else if("number"===typeof e)e&=16777215,this.model="rgb",this.color=[e>>16&255,e>>8&255,e&255],this.valpha=1;else{this.valpha=1;c=wa(e);"alpha"in e&&(c.splice(c.indexOf("alpha"),1),this.valpha="number"===typeof e.alpha?e.alpha:0);c=c.sort().join("");if(!(c in mc))throw Error("Unable to parse color from object: "+Oe(e));this.model=mc[c];a=qa[this.model].labels;var b=[];for(c=0;c<a.length;c++)b.push(e[a[c]]);this.color=lc(b)}if(Mb[this.model])for(a=qa[this.model].channels,
c=0;c<a;c++)(e=Mb[this.model][c])&&(this.color[c]=e(this.color[c]));this.valpha=Math.max(0,Math.min(1,this.valpha));$c&&$c(this)}function Pe(e){return function(c){return Number(c.toFixed(e))}}function V(e,c,a){e=Array.isArray(e)?e:[e];e.forEach(function(b){(Mb[b]||(Mb[b]=[]))[c]=a});e=e[0];return function(b){if(arguments.length){a&&(b=a(b));var d=this[e]();d.color[c]=b;return d}d=this[e]().color[c];a&&(d=a(d));return d}}function ca(e){return function(c){return Math.max(0,Math.min(e,c))}}function lc(e,
c){for(var a=0;a<c;a++)"number"!==typeof e[a]&&(e[a]=0);return e}function fa(e){return e*Math.PI/180}function nc(e){return e/Math.PI*180}function oc(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function pc(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function qc(e,c){return 1E-8>Math.abs(e-c)}function ra(){}function ad(e,c){for(var a in c)e[a]=c[a]}function Ca(e,c){this.lng=e;this.lat=c}function bd(e,c){this.x=e;this.y=c}function rc(e,c){var a=document.createElement("canvas");e&&
(a.width=e);c&&(a.height=c);return a}function ia(e){e=e||{};this.gradient=e.gradient||{"0.25":"rgba(0, 0, 255, 1)","0.55":"rgba(0, 255, 0, 1)","0.85":"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"};this.maxSize=void 0===e.maxSize?35:e.maxSize;this.minSize=e.minSize||0;this.max=e.max||100;this.min=e.min||0;this.initPalette()}function Ha(e){this.options=e||{};this._initialize()}function sc(e,c,a,b,d){var f=1-e,k=1-e;return f*f*f*c+3*k*k*e*a+3*(1-e)*e*e*b+e*e*e*d}function Oa(e){this.WORLD_SIZE_MC_HALF=
2.0037726372307256E7;this.WORLD_SIZE_MC=2*this.WORLD_SIZE_MC_HALF;this.options=e||{};this._initialize()}function cd(e,c){return e&&c?Math.round(Math.sqrt(Math.pow(e.lng-c.lng,2)+Math.pow(e.lat-c.lat,2))):0}function dd(e){for(var c=["webgl2","experimental-webgl2","webgl","experimental-webgl"],a,b=0;b<c.length;b++)try{if(a=e.getContext(c[b],{premultipliedAlpha:!1}))break}catch(d){}return a}function bb(e,c,a){a=U({TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"REPEAT",TEXTURE_WRAP_T:"REPEAT"},
a);var b=e.createTexture();e.bindTexture(e.TEXTURE_2D,b);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,c);for(var d in a)e.texParameteri(e.TEXTURE_2D,e[d],e[a[d]]);e.bindTexture(e.TEXTURE_2D,null);return b}function Ia(e,c,a,b){if("object"===("undefined"===typeof c?"undefined":jc(c)))c=bb(e,c,b),a(c,null);else{var d=new Image;d.crossOrigin="anonymous";d.onload=function(){var c=pc(d.width),k=pc(d.height),g=document.createElement("canvas");g.width=
c;g.height=k;g.getContext("2d").drawImage(d,0,0,c,k);d=g;c=bb(e,d,b);a(c,d)};d.src=c}}function nb(e,c,a){a=a||2;var b=c&&c.length,d=b?c[0]*a:e.length,f=ed(e,0,d,a,!0),k=[];if(!f||f.next===f.prev)return k;var g;if(b){var h=a;b=[];var m;var n=0;for(m=c.length;n<m;n++){var p=c[n]*h;var l=n<m-1?c[n+1]*h:e.length;p=ed(e,p,l,h,!1);p===p.next&&(p.steiner=!0);b.push(Qe(p))}b.sort(Re);for(n=0;n<b.length;n++){c=b[n];h=f;if(h=Se(c,h))c=fd(h,c),ob(c,c.next);f=ob(f,f.next)}}if(e.length>80*a){var r=g=e[0];var q=
b=e[1];for(h=a;h<d;h+=a)n=e[h],c=e[h+1],n<r&&(r=n),c<q&&(q=c),n>g&&(g=n),c>b&&(b=c);g=Math.max(g-r,b-q);g=0!==g?1/g:0}pb(f,k,a,r,q,g);return k}function ed(e,c,a,b,d){if(d===0<tc(e,c,a,b))for(d=c;d<a;d+=b)var f=gd(d,e[d],e[d+1],f);else for(d=a-b;d>=c;d-=b)f=gd(d,e[d],e[d+1],f);f&&Sa(f,f.next)&&(qb(f),f=f.next);return f}function ob(e,c){if(!e)return e;c||(c=e);do{var a=!1;if(e.steiner||!Sa(e,e.next)&&0!==ha(e.prev,e,e.next))e=e.next;else{qb(e);e=c=e.prev;if(e===e.next)break;a=!0}}while(a||e!==c);return c}
function pb(e,c,a,b,d,f,k){if(e){if(!k&&f){var g=e,h=g;do null===h.z&&(h.z=uc(h.x,h.y,b,d,f)),h.prevZ=h.prev,h=h.nextZ=h.next;while(h!==g);h.prevZ.nextZ=null;h.prevZ=null;g=h;var m,n,p,l,r=1;do{h=g;var q=g=null;for(n=0;h;){n++;var t=h;for(m=p=0;m<r&&(p++,t=t.nextZ,t);m++);for(l=r;0<p||0<l&&t;)0!==p&&(0===l||!t||h.z<=t.z)?(m=h,h=h.nextZ,p--):(m=t,t=t.nextZ,l--),q?q.nextZ=m:g=m,m.prevZ=q,q=m;h=t}q.nextZ=null;r*=2}while(1<n)}for(g=e;e.prev!==e.next;){h=e.prev;t=e.next;if(f)q=Te(e,b,d,f);else a:if(q=
e,n=q.prev,p=q,r=q.next,0<=ha(n,p,r))q=!1;else{for(m=q.next.next;m!==q.prev;){if(cb(n.x,n.y,p.x,p.y,r.x,r.y,m.x,m.y)&&0<=ha(m.prev,m,m.next)){q=!1;break a}m=m.next}q=!0}if(q)c.push(h.i/a),c.push(e.i/a),c.push(t.i/a),qb(e),g=e=t.next;else if(e=t,e===g){if(!k)pb(ob(e),c,a,b,d,f,1);else if(1===k){k=c;g=a;h=e;do t=h.prev,q=h.next.next,!Sa(t,q)&&hd(t,h,h.next,q)&&rb(t,q)&&rb(q,t)&&(k.push(t.i/g),k.push(h.i/g),k.push(q.i/g),qb(h),qb(h.next),h=e=q),h=h.next;while(h!==e);e=h;pb(e,c,a,b,d,f,2)}else if(2===
k)a:{k=e;do{for(g=k.next.next;g!==k.prev;){if(h=k.i!==g.i){h=k;t=g;if(q=h.next.i!==t.i&&h.prev.i!==t.i){b:{q=h;do{if(q.i!==h.i&&q.next.i!==h.i&&q.i!==t.i&&q.next.i!==t.i&&hd(q,q.next,h,t)){q=!0;break b}q=q.next}while(q!==h);q=!1}q=!q}if(q=q&&rb(h,t)&&rb(t,h)){q=h;n=!1;p=(h.x+t.x)/2;t=(h.y+t.y)/2;do q.y>t!==q.next.y>t&&q.next.y!==q.y&&p<(q.next.x-q.x)*(t-q.y)/(q.next.y-q.y)+q.x&&(n=!n),q=q.next;while(q!==h);q=n}h=q}if(h){e=fd(k,g);k=ob(k,k.next);e=ob(e,e.next);pb(k,c,a,b,d,f);pb(e,c,a,b,d,f);break a}g=
g.next}k=k.next}while(k!==e)}break}}}}function Te(e,c,a,b){var d=e.prev,f=e.next;if(0<=ha(d,e,f))return!1;var k=d.x>e.x?d.x>f.x?d.x:f.x:e.x>f.x?e.x:f.x,g=d.y>e.y?d.y>f.y?d.y:f.y:e.y>f.y?e.y:f.y,h=uc(d.x<e.x?d.x<f.x?d.x:f.x:e.x<f.x?e.x:f.x,d.y<e.y?d.y<f.y?d.y:f.y:e.y<f.y?e.y:f.y,c,a,b);c=uc(k,g,c,a,b);a=e.prevZ;for(b=e.nextZ;a&&a.z>=h&&b&&b.z<=c;){if(a!==e.prev&&a!==e.next&&cb(d.x,d.y,e.x,e.y,f.x,f.y,a.x,a.y)&&0<=ha(a.prev,a,a.next))return!1;a=a.prevZ;if(b!==e.prev&&b!==e.next&&cb(d.x,d.y,e.x,e.y,
f.x,f.y,b.x,b.y)&&0<=ha(b.prev,b,b.next))return!1;b=b.nextZ}for(;a&&a.z>=h;){if(a!==e.prev&&a!==e.next&&cb(d.x,d.y,e.x,e.y,f.x,f.y,a.x,a.y)&&0<=ha(a.prev,a,a.next))return!1;a=a.prevZ}for(;b&&b.z<=c;){if(b!==e.prev&&b!==e.next&&cb(d.x,d.y,e.x,e.y,f.x,f.y,b.x,b.y)&&0<=ha(b.prev,b,b.next))return!1;b=b.nextZ}return!0}function Re(e,c){return e.x-c.x}function Se(e,c){var a=c,b=e.x,d=e.y,f=-Infinity;do{if(d<=a.y&&d>=a.next.y&&a.next.y!==a.y){var k=a.x+(d-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(k<=b&&k>f){f=
k;if(k===b){if(d===a.y)return a;if(d===a.next.y)return a.next}var g=a.x<a.next.x?a:a.next}}a=a.next}while(a!==c);if(!g)return null;if(b===f)return g.prev;c=g;k=g.x;var h=g.y,m=Infinity;for(a=g.next;a!==c;){if(b>=a.x&&a.x>=k&&b!==a.x&&cb(d<h?b:f,d,k,h,d<h?f:b,d,a.x,a.y)){var n=Math.abs(d-a.y)/(b-a.x);(n<m||n===m&&a.x>g.x)&&rb(a,e)&&(g=a,m=n)}a=a.next}return g}function uc(e,c,a,b,d){e=32767*(e-a)*d;c=32767*(c-b)*d;e=(e|e<<8)&16711935;e=(e|e<<4)&252645135;e=(e|e<<2)&858993459;c=(c|c<<8)&16711935;c=(c|
c<<4)&252645135;c=(c|c<<2)&858993459;return(e|e<<1)&1431655765|((c|c<<1)&1431655765)<<1}function Qe(e){var c=e,a=e;do{if(c.x<a.x||c.x===a.x&&c.y<a.y)a=c;c=c.next}while(c!==e);return a}function cb(e,c,a,b,d,f,k,g){return 0<=(d-k)*(c-g)-(e-k)*(f-g)&&0<=(e-k)*(b-g)-(a-k)*(c-g)&&0<=(a-k)*(f-g)-(d-k)*(b-g)}function ha(e,c,a){return(c.y-e.y)*(a.x-c.x)-(c.x-e.x)*(a.y-c.y)}function Sa(e,c){return e.x===c.x&&e.y===c.y}function hd(e,c,a,b){return Sa(e,c)&&Sa(a,b)||Sa(e,b)&&Sa(a,c)?!0:0<ha(e,c,a)!==0<ha(e,c,
b)&&0<ha(a,b,e)!==0<ha(a,b,c)}function rb(e,c){return 0>ha(e.prev,e,e.next)?0<=ha(e,c,e.next)&&0<=ha(e,e.prev,c):0>ha(e,c,e.prev)||0>ha(e,e.next,c)}function fd(e,c){var a=new vc(e.i,e.x,e.y),b=new vc(c.i,c.x,c.y),d=e.next,f=c.prev;e.next=c;c.prev=e;a.next=d;d.prev=a;b.next=a;a.prev=b;f.next=b;b.prev=f;return b}function gd(e,c,a,b){e=new vc(e,c,a);b?(e.next=b.next,e.prev=b,b.next.prev=e,b.next=e):(e.prev=e,e.next=e);return e}function qb(e){e.next.prev=e.prev;e.prev.next=e.next;e.prevZ&&(e.prevZ.nextZ=
e.nextZ);e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function vc(e,c,a){this.i=e;this.x=c;this.y=a;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function tc(e,c,a,b){for(var d=0,f=a-b;c<a;c+=b)d+=(e[f]-e[c])*(e[c+1]+e[f+1]),f=c;return d}function id(e){try{return Nb.createObjectURL(new Blob([e],{type:"application/javascript"}))}catch(a){var c=new Ue;c.append(e);return Nb.createObjectURL(c.getBlob(type))}}function Ta(e,c){this.shapeLayer=e;this.gl=c;this.initData()}function jd(){wc=!0;
for(var e=0;64>e;++e)Da[e]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e],ta["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(e)]=e;ta[45]=62;ta[95]=63}function Ve(e,c,a){for(var b=[],d=c;d<a;d+=3)c=(e[d]<<16)+(e[d+1]<<8)+e[d+2],b.push(Da[c>>18&63]+Da[c>>12&63]+Da[c>>6&63]+Da[c&63]);return b.join("")}function kd(e){wc||jd();for(var c=e.length,a=c%3,b="",d=[],f=0,k=c-a;f<k;f+=16383)d.push(Ve(e,f,f+16383>k?k:f+16383));1===a?(e=e[c-1],b+=Da[e>>2],b+=
Da[e<<4&63],b+="=="):2===a&&(e=(e[c-2]<<8)+e[c-1],b+=Da[e>>10],b+=Da[e>>4&63],b+=Da[e<<2&63],b+="=");d.push(b);return d.join("")}function Ob(e,c,a,b,d){var f=8*d-b-1;var k=(1<<f)-1,g=k>>1,h=-7;d=a?d-1:0;var m=a?-1:1,n=e[c+d];d+=m;a=n&(1<<-h)-1;n>>=-h;for(h+=f;0<h;a=256*a+e[c+d],d+=m,h-=8);f=a&(1<<-h)-1;a>>=-h;for(h+=b;0<h;f=256*f+e[c+d],d+=m,h-=8);if(0===a)a=1-g;else{if(a===k)return f?NaN:Infinity*(n?-1:1);f+=Math.pow(2,b);a-=g}return(n?-1:1)*f*Math.pow(2,a-b)}function ld(e,c,a,b,d,f){var k,g=8*f-
d-1,h=(1<<g)-1,m=h>>1,n=23===d?Math.pow(2,-24)-Math.pow(2,-77):0;f=b?0:f-1;var p=b?1:-1,l=0>c||0===c&&0>1/c?1:0;c=Math.abs(c);isNaN(c)||Infinity===c?(c=isNaN(c)?1:0,b=h):(b=Math.floor(Math.log(c)/Math.LN2),1>c*(k=Math.pow(2,-b))&&(b--,k*=2),c=1<=b+m?c+n/k:c+n*Math.pow(2,1-m),2<=c*k&&(b++,k/=2),b+m>=h?(c=0,b=h):1<=b+m?(c=(c*k-1)*Math.pow(2,d),b+=m):(c=c*Math.pow(2,m-1)*Math.pow(2,d),b=0));for(;8<=d;e[a+f]=c&255,f+=p,c/=256,d-=8);b=b<<d|c;for(g+=d;0<g;e[a+f]=b&255,f+=p,b/=256,g-=8);e[a+f-p]|=128*l}
function Ja(e,c){if((v.TYPED_ARRAY_SUPPORT?2147483647:1073741823)<c)throw new RangeError("Invalid typed array length");v.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(c),e.__proto__=v.prototype):(null===e&&(e=new v(c)),e.length=c);return e}function v(e,c,a){if(!(v.TYPED_ARRAY_SUPPORT||this instanceof v))return new v(e,c,a);if("number"===typeof e){if("string"===typeof c)throw Error("If encoding is specified then the first argument must be a string");return xc(this,e)}return md(this,e,c,a)}function md(e,c,
a,b){if("number"===typeof c)throw new TypeError('"value" argument must not be a number');if("undefined"!==typeof ArrayBuffer&&c instanceof ArrayBuffer){c.byteLength;if(0>a||c.byteLength<a)throw new RangeError("'offset' is out of bounds");if(c.byteLength<a+(b||0))throw new RangeError("'length' is out of bounds");c=void 0===a&&void 0===b?new Uint8Array(c):void 0===b?new Uint8Array(c,a):new Uint8Array(c,a,b);v.TYPED_ARRAY_SUPPORT?(e=c,e.__proto__=v.prototype):e=yc(e,c);return e}if("string"===typeof c){b=
e;e=a;if("string"!==typeof e||""===e)e="utf8";if(!v.isEncoding(e))throw new TypeError('"encoding" must be a valid string encoding');a=nd(c,e)|0;b=Ja(b,a);c=b.write(c,e);c!==a&&(b=b.slice(0,c));return b}return We(e,c)}function od(e){if("number"!==typeof e)throw new TypeError('"size" argument must be a number');if(0>e)throw new RangeError('"size" argument must not be negative');}function xc(e,c){od(c);e=Ja(e,0>c?0:zc(c)|0);if(!v.TYPED_ARRAY_SUPPORT)for(var a=0;a<c;++a)e[a]=0;return e}function yc(e,
c){var a=0>c.length?0:zc(c.length)|0;e=Ja(e,a);for(var b=0;b<a;b+=1)e[b]=c[b]&255;return e}function We(e,c){if(Ea(c)){var a=zc(c.length)|0;e=Ja(e,a);if(0===e.length)return e;c.copy(e,0,0,a);return e}if(c){if("undefined"!==typeof ArrayBuffer&&c.buffer instanceof ArrayBuffer||"length"in c)return(a="number"!==typeof c.length)||(a=c.length,a=a!==a),a?Ja(e,0):yc(e,c);if("Buffer"===c.type&&pd(c.data))return yc(e,c.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");
}function zc(e){if(e>=(v.TYPED_ARRAY_SUPPORT?2147483647:1073741823))throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+(v.TYPED_ARRAY_SUPPORT?2147483647:1073741823).toString(16)+" bytes");return e|0}function Ea(e){return!(null==e||!e._isBuffer)}function nd(e,c){if(Ea(e))return e.length;if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!==typeof e&&(e=""+e);var a=e.length;
if(0===a)return 0;for(var b=!1;;)switch(c){case "ascii":case "latin1":case "binary":return a;case "utf8":case "utf-8":case void 0:return Pb(e).length;case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return 2*a;case "hex":return a>>>1;case "base64":return qd(e).length;default:if(b)return Pb(e).length;c=(""+c).toLowerCase();b=!0}}function Xe(e,c,a){var b=!1;if(void 0===c||0>c)c=0;if(c>this.length)return"";if(void 0===a||a>this.length)a=this.length;if(0>=a)return"";a>>>=0;c>>>=0;if(a<=c)return"";
for(e||(e="utf8");;)switch(e){case "hex":e=c;c=a;a=this.length;if(!e||0>e)e=0;if(!c||0>c||c>a)c=a;b="";for(a=e;a<c;++a)e=b,b=this[a],b=16>b?"0"+b.toString(16):b.toString(16),b=e+b;return b;case "utf8":case "utf-8":return rd(this,c,a);case "ascii":e="";for(a=Math.min(this.length,a);c<a;++c)e+=String.fromCharCode(this[c]&127);return e;case "latin1":case "binary":e="";for(a=Math.min(this.length,a);c<a;++c)e+=String.fromCharCode(this[c]);return e;case "base64":return c=0===c&&a===this.length?kd(this):
kd(this.slice(c,a)),c;case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":c=this.slice(c,a);a="";for(e=0;e<c.length;e+=2)a+=String.fromCharCode(c[e]+256*c[e+1]);return a;default:if(b)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase();b=!0}}function Ua(e,c,a){var b=e[c];e[c]=e[a];e[a]=b}function sd(e,c,a,b,d){if(0===e.length)return-1;"string"===typeof a?(b=a,a=0):2147483647<a?a=2147483647:-2147483648>a&&(a=-2147483648);a=+a;isNaN(a)&&(a=d?0:e.length-1);0>a&&(a=e.length+a);if(a>=
e.length){if(d)return-1;a=e.length-1}else if(0>a)if(d)a=0;else return-1;"string"===typeof c&&(c=v.from(c,b));if(Ea(c))return 0===c.length?-1:td(e,c,a,b,d);if("number"===typeof c)return c&=255,v.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf?d?Uint8Array.prototype.indexOf.call(e,c,a):Uint8Array.prototype.lastIndexOf.call(e,c,a):td(e,[c],a,b,d);throw new TypeError("val must be string, number or Buffer");}function td(e,c,a,b,d){function f(a,b){return 1===k?a[b]:a.readUInt16BE(b*
k)}var k=1,g=e.length,h=c.length;if(void 0!==b&&(b=String(b).toLowerCase(),"ucs2"===b||"ucs-2"===b||"utf16le"===b||"utf-16le"===b)){if(2>e.length||2>c.length)return-1;k=2;g/=2;h/=2;a/=2}if(d)for(b=-1;a<g;a++)if(f(e,a)===f(c,-1===b?0:a-b)){if(-1===b&&(b=a),a-b+1===h)return b*k}else-1!==b&&(a-=a-b),b=-1;else for(a+h>g&&(a=g-h);0<=a;a--){g=!0;for(b=0;b<h;b++)if(f(e,a+b)!==f(c,b)){g=!1;break}if(g)return a}return-1}function rd(e,c,a){a=Math.min(e.length,a);for(var b=[];c<a;){var d=e[c],f=null,k=239<d?
4:223<d?3:191<d?2:1;if(c+k<=a)switch(k){case 1:128>d&&(f=d);break;case 2:var g=e[c+1];128===(g&192)&&(d=(d&31)<<6|g&63,127<d&&(f=d));break;case 3:g=e[c+1];var h=e[c+2];128===(g&192)&&128===(h&192)&&(d=(d&15)<<12|(g&63)<<6|h&63,2047<d&&(55296>d||57343<d)&&(f=d));break;case 4:g=e[c+1];h=e[c+2];var m=e[c+3];128===(g&192)&&128===(h&192)&&128===(m&192)&&(d=(d&15)<<18|(g&63)<<12|(h&63)<<6|m&63,65535<d&&1114112>d&&(f=d))}null===f?(f=65533,k=1):65535<f&&(f-=65536,b.push(f>>>10&1023|55296),f=56320|f&1023);
b.push(f);c+=k}e=b.length;if(e<=ud)b=String.fromCharCode.apply(String,b);else{a="";for(c=0;c<e;)a+=String.fromCharCode.apply(String,b.slice(c,c+=ud));b=a}return b}function ea(e,c,a){if(0!==e%1||0>e)throw new RangeError("offset is not uint");if(e+c>a)throw new RangeError("Trying to access beyond buffer length");}function la(e,c,a,b,d,f){if(!Ea(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(c>d||c<f)throw new RangeError('"value" argument is out of bounds');if(a+b>e.length)throw new RangeError("Index out of range");
}function Qb(e,c,a,b){0>c&&(c=65535+c+1);for(var d=0,f=Math.min(e.length-a,2);d<f;++d)e[a+d]=(c&255<<8*(b?d:1-d))>>>8*(b?d:1-d)}function Rb(e,c,a,b){0>c&&(c=4294967295+c+1);for(var d=0,f=Math.min(e.length-a,4);d<f;++d)e[a+d]=c>>>8*(b?d:3-d)&255}function vd(e,c,a,b,d,f){if(a+b>e.length)throw new RangeError("Index out of range");if(0>a)throw new RangeError("Index out of range");}function wd(e,c,a,b,d){d||vd(e,c,a,4,3.4028234663852886E38,-3.4028234663852886E38);ld(e,c,a,b,23,4);return a+4}function xd(e,
c,a,b,d){d||vd(e,c,a,8,1.7976931348623157E308,-1.7976931348623157E308);ld(e,c,a,b,52,8);return a+8}function Pb(e,c){c=c||Infinity;for(var a,b=e.length,d=null,f=[],k=0;k<b;++k){a=e.charCodeAt(k);if(55295<a&&57344>a){if(!d){if(56319<a){-1<(c-=3)&&f.push(239,191,189);continue}else if(k+1===b){-1<(c-=3)&&f.push(239,191,189);continue}d=a;continue}if(56320>a){-1<(c-=3)&&f.push(239,191,189);d=a;continue}a=(d-55296<<10|a-56320)+65536}else d&&-1<(c-=3)&&f.push(239,191,189);d=null;if(128>a){if(0>--c)break;
f.push(a)}else if(2048>a){if(0>(c-=2))break;f.push(a>>6|192,a&63|128)}else if(65536>a){if(0>(c-=3))break;f.push(a>>12|224,a>>6&63|128,a&63|128)}else if(1114112>a){if(0>(c-=4))break;f.push(a>>18|240,a>>12&63|128,a>>6&63|128,a&63|128)}else throw Error("Invalid code point");}return f}function yd(e){for(var c=[],a=0;a<e.length;++a)c.push(e.charCodeAt(a)&255);return c}function qd(e){e=(e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")).replace(Ye,"");if(2>e.length)e="";else for(;0!==e.length%4;)e+="=";wc||jd();
var c=e.length;if(0<c%4)throw Error("Invalid string. Length must be a multiple of 4");var a="="===e[c-2]?2:"="===e[c-1]?1:0;var b=new Ze(3*c/4-a);var d=0<a?c-4:c;var f=0;for(c=0;c<d;c+=4){var k=ta[e.charCodeAt(c)]<<18|ta[e.charCodeAt(c+1)]<<12|ta[e.charCodeAt(c+2)]<<6|ta[e.charCodeAt(c+3)];b[f++]=k>>16&255;b[f++]=k>>8&255;b[f++]=k&255}2===a?(k=ta[e.charCodeAt(c)]<<2|ta[e.charCodeAt(c+1)]>>4,b[f++]=k&255):1===a&&(k=ta[e.charCodeAt(c)]<<10|ta[e.charCodeAt(c+1)]<<4|ta[e.charCodeAt(c+2)]>>2,b[f++]=k>>
8&255,b[f++]=k&255);return b}function sb(e,c,a,b){for(var d=0;d<b&&!(d+a>=c.length||d>=e.length);++d)c[d+a]=e[d];return d}function zd(e){return!!e.constructor&&"function"===typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function ua(e,c){var a=[];e.forEach(function(b){a.push(c?-b:b,b)});return a}function Ad(e){for(var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=[],b=0;b<e-1;b++){var d=2*(b+c);a.push(d,d+1,d+2);a.push(d+2,d+1,d+3)}return a}function Sb(e){return function(c,
a,b){c=a+e;a=b.length-1;return b[0<a?0>c?0:c>a?a:c:c<a?a:0<c?0:c]}}function Ka(e){if(!e[0]||!e[0].length)return e;for(var c=e[0].length,a=[],b=0,d=0;d<e.length;d++)for(var f=0;f<c;f++)a[b++]=e[d][f];return a}function Bd(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],c=[],a=0,b=0;b<e.length;b++){var d=e[b];if(0<b){var f=e[b-1];a+=Math.sqrt(Math.pow(d[0]-f[0],2)+Math.pow(d[1]-f[1],2))}c.push(a)}return{arr:c,total:a}}function $e(e){var c=0,a=0,b=!0,d=!1,f=void 0;try{for(var k=
Cd(e),g;!(b=(g=k.next()).done);b=!0){var h=g.value;c+=h.w*h.h;a=Math.max(a,h.w)}}catch(t){d=!0,f=t}finally{try{!b&&k.return&&k.return()}finally{if(d)throw f;}}e.sort(function(a,b){return b.h-a.h});a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(c/.95)),a),h:Infinity}];d=b=0;f=!0;k=!1;g=void 0;try{for(var m=Cd(e),n;!(f=(n=m.next()).done);f=!0)for(var p=n.value,l=a.length-1;0<=l;l--){var r=a[l];if(!(p.w>r.w||p.h>r.h)){p.x=r.x;p.y=r.y;d=Math.max(d,p.y+p.h);b=Math.max(b,p.x+p.w);if(p.w===r.w&&p.h===r.h){var q=
a.pop();l<a.length&&(a[l]=q)}else p.h===r.h?(r.x+=p.w,r.w-=p.w):(p.w!==r.w&&a.push({x:r.x+p.w,y:r.y,w:r.w-p.w,h:p.h}),r.y+=p.h,r.h-=p.h);break}}}catch(t){k=!0,g=t}finally{try{!f&&m.return&&m.return()}finally{if(k)throw g;}}return{w:b,h:d,fill:c/(b*d)||0}}function af(e,c,a){a=Math.PI/180*(60*a+30);return[e.x+c*Math.cos(a),e.y+c*Math.sin(a)]}function bf(e,c,a){for(var b={},d=[],f=e.length,k=c/2/Math.sin(Math.PI/3),g=1.5*k,h=1,m=0;m<f;++m){var n=e[m].geometry.coordinates;a&&(n=a(n));var p=+n[0],l=+n[1];
if(!isNaN(p)&&!isNaN(l)){n=Math.round(l/=g);var r=Math.round(p=p/c-(n&1)/2),q=l-n;if(1<3*Math.abs(q)){var t=p-r,S=r+(p<r?-1:1)/2,N=n+(l<n?-1:1);p-=S;l-=N;t*t+q*q>p*p+l*l&&(r=S+(n&1?1:-1)/2,n=N)}q=r+"-"+n;(t=b[q])?(t.count+=e[m].count||1,h=Math.max(h,t.count)):(b[q]={center:{x:(r+(n&1)/2)*c,y:n*g},count:e[m].count||1},d.push(b[q]))}}d.max=h;d.r=k;return d}function X(e){this.options=e=e||{};e.colors=e.colors||["rgba(0,192,73,0.99609375)","rgba(242,48,48,0.99609375)","rgba(255,159,25,0.99609375)"];var c=
e.colors;this.drawTogether=!0;this.parseColors(c);this.tileSize=256;this.ratio=window.devicePixelRatio;this.cache={};e.getTileUrl&&(this.getTileUrl=e.getTileUrl);this._loadCount={}}function cf(e){var c=e/2,a=e+c,b=new rc(2*a,2*a),d=b.getContext("2d");d.shadowBlur=c;d.shadowColor="black";d.shadowOffsetX=d.shadowOffsetY=1E4;d.beginPath();d.arc(a-1E4,a-1E4,e,0,2*Math.PI,!0);d.closePath();d.fill();return b}var Dd="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==
typeof global?global:"undefined"!==typeof self?self:{},Va=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e},df={}.hasOwnProperty,R=function(e,c){return df.call(e,c)},ef={}.toString,tb=function(e){return ef.call(e).slice(8,-1)},Ed=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==tb(e)?e.split(""):Object(e)},Fa=function(e){return Ed(Va(e))},ff=Math.ceil,gf=Math.floor,Ac=function(e){return isNaN(e=+e)?0:(0<e?gf:ff)(e)},hf=Math.min,Fd=function(e){return 0<
e?hf(Ac(e),9007199254740991):0},jf=Math.max,kf=Math.min,W=H(function(e){e=e.exports={version:"2.6.5"};"number"==typeof __e&&(__e=e)}),ma=H(function(e){e=e.exports="undefined"!=typeof window&&Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),ub=H(function(e){var c=ma["__core-js_shared__"]||(ma["__core-js_shared__"]={});(e.exports=function(a,b){return c[a]||(c[a]=void 0!==b?b:{})})("versions",[]).push({version:W.version,mode:"pure",
copyright:"\u00a9 2019 Denis Pushkarev (zloirock.ru)"})}),lf=0,mf=Math.random(),Tb=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++lf+mf).toString(36))},Gd=ub("keys"),Bc=function(e){return Gd[e]||(Gd[e]=Tb(e))},nf=function(e){return function(c,a,b){c=Fa(c);var d=Fd(c.length);b=Ac(b);b=0>b?jf(b+d,0):kf(b,d);if(e&&a!=a)for(;d>b;){if(a=c[b++],a!=a)return!0}else for(;d>b;b++)if((e||b in c)&&c[b]===a)return e||b||0;return!e&&-1}}(!1),of=Bc("IE_PROTO"),Hd=function(e,c){e=Fa(e);var a=0,b=[],d;
for(d in e)d!=of&&R(e,d)&&b.push(d);for(;c.length>a;)R(e,d=c[a++])&&(~nf(b,d)||b.push(d));return b},Ub="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),db=Object.keys||function(e){return Hd(e,Ub)},pf=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e},Vb=function(e,c,a){pf(e);if(void 0===c)return e;switch(a){case 1:return function(a){return e.call(c,a)};case 2:return function(a,d){return e.call(c,a,d)};case 3:return function(a,
d,f){return e.call(c,a,d,f)}}return function(){return e.apply(c,arguments)}},xa=function(e){return"object"===typeof e?null!==e:"function"===typeof e},ya=function(e){if(!xa(e))throw TypeError(e+" is not an object!");return e},Wa=function(e){try{return!!e()}catch(c){return!0}},Pa=!Wa(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),Wb=ma.document,Id=xa(Wb)&&xa(Wb.createElement),Jd=!Pa&&!Wa(function(){return 7!=Object.defineProperty(Id?Wb.createElement("div"):{},"a",
{get:function(){return 7}}).a}),vb=function(e,c){if(!xa(e))return e;var a,b;if(c&&"function"==typeof(a=e.toString)&&!xa(b=a.call(e))||"function"==typeof(a=e.valueOf)&&!xa(b=a.call(e))||!c&&"function"==typeof(a=e.toString)&&!xa(b=a.call(e)))return b;throw TypeError("Can't convert object to primitive value");},qf=Object.defineProperty,Ga={f:Pa?Object.defineProperty:function(e,c,a){ya(e);c=vb(c,!0);ya(a);if(Jd)try{return qf(e,c,a)}catch(b){}if("get"in a||"set"in a)throw TypeError("Accessors not supported!");
"value"in a&&(e[c]=a.value);return e}},Qa=function(e,c){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:c}},Xa=Pa?function(e,c,a){return Ga.f(e,c,Qa(1,a))}:function(e,c,a){e[c]=a;return e},ja=function(e,c,a){var b=e&ja.F,d=e&ja.G,f=e&ja.S,k=e&ja.P,g=e&ja.B,h=e&ja.W,m=d?W:W[c]||(W[c]={}),n=m.prototype;f=d?ma:f?ma[c]:(ma[c]||{}).prototype;var p;d&&(a=c);for(p in a)if(c=!b&&f&&void 0!==f[p],!c||!R(m,p)){var l=c?f[p]:a[p];m[p]=d&&"function"!=typeof f[p]?a[p]:g&&c?Vb(l,ma):h&&f[p]==
l?function(a){var b=function(b,d,h){if(this instanceof a){switch(arguments.length){case 0:return new a;case 1:return new a(b);case 2:return new a(b,d)}return new a(b,d,h)}return a.apply(this,arguments)};b.prototype=a.prototype;return b}(l):k&&"function"==typeof l?Vb(Function.call,l):l;k&&((m.virtual||(m.virtual={}))[p]=l,e&ja.R&&n&&!n[p]&&Xa(n,p,l))}};ja.F=1;ja.G=2;ja.S=4;ja.P=8;ja.B=16;ja.W=32;ja.U=64;ja.R=128;var O=ja,Xb=function(e,c){var a=(W.Object||{})[e]||Object[e],b={};b[e]=c(a);O(O.S+O.F*
Wa(function(){a(1)}),"Object",b)};Xb("keys",function(){return function(e){return db(Object(Va(e)))}});var rf=W.Object.keys,sf=H(function(e){e.exports={"default":rf,__esModule:!0}}),wa=K(sf),Cc=Object.getOwnPropertySymbols,Yb={}.propertyIsEnumerable,Zb=Object.assign,tf=!Zb||Wa(function(){var e={},c={},a=Symbol();e[a]=7;"abcdefghijklmnopqrst".split("").forEach(function(a){c[a]=a});return 7!=Zb({},e)[a]||"abcdefghijklmnopqrst"!=Object.keys(Zb({},c)).join("")})?function(e,c){for(var a=Object(Va(e)),b=
arguments.length,d=1,f=Cc,k=Yb;b>d;)for(var g=Ed(arguments[d++]),h=f?db(g).concat(f(g)):db(g),m=h.length,n=0,p;m>n;)k.call(g,p=h[n++])&&(a[p]=g[p]);return a}:Zb;O(O.S+O.F,"Object",{assign:tf});var uf=W.Object.assign,vf=H(function(e){e.exports={"default":uf,__esModule:!0}}),U=K(vf),Kd=Bc("IE_PROTO"),wf=Object.prototype,Ld=Object.getPrototypeOf||function(e){e=Object(Va(e));return R(e,Kd)?e[Kd]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?wf:
null};Xb("getPrototypeOf",function(){return function(e){return Ld(Object(Va(e)))}});var xf=W.Object.getPrototypeOf,wb=H(function(e){e.exports={"default":xf,__esModule:!0}}),I=K(wb),yf=H(function(e,c){c.__esModule=!0;c.default=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}}),E=K(yf);O(O.S+O.F*!Pa,"Object",{defineProperty:Ga.f});var zf=W.Object,Af=function(e,c,a){return zf.defineProperty(e,c,a)},La=H(function(e){e.exports={"default":Af,__esModule:!0}}),
Z=K(La),Bf=H(function(e,c){c.__esModule=!0;var a=La&&La.__esModule?La:{default:La};c.default=function(){function b(b,c){for(var d=0;d<c.length;d++){var f=c[d];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);(0,a.default)(b,f.key,f)}}return function(a,c,k){c&&b(a.prototype,c);k&&b(a,k);return a}}()}),F=K(Bf),Ma={},Cf=Pa?Object.defineProperties:function(e,c){ya(e);for(var a=db(c),b=a.length,d=0,f;b>d;)Ga.f(e,f=a[d++],c[f]);return e},Md=ma.document,Df=Md&&Md.documentElement,
Ef=Bc("IE_PROTO"),Dc=function(){},$b=function(){var e=Id?Wb.createElement("iframe"):{},c=Ub.length;e.style.display="none";Df.appendChild(e);e.src="javascript:";e=e.contentWindow.document;e.open();e.write("<script>document.F=Object\x3c/script>");e.close();for($b=e.F;c--;)delete $b.prototype[Ub[c]];return $b()},Ya=Object.create||function(e,c){if(null!==e){Dc.prototype=ya(e);var a=new Dc;Dc.prototype=null;a[Ef]=e}else a=$b();return void 0===c?a:Cf(a,c)},ka=H(function(e){var c=ub("wks"),a=ma.Symbol,b=
"function"==typeof a;(e.exports=function(d){return c[d]||(c[d]=b&&a[d]||(b?a:Tb)("Symbol."+d))}).store=c}),Ff=Ga.f,Nd=ka("toStringTag"),xb=function(e,c,a){e&&!R(e=a?e:e.prototype,Nd)&&Ff(e,Nd,{configurable:!0,value:c})},Od={};Xa(Od,ka("iterator"),function(){return this});var Gf=function(e,c,a){e.prototype=Ya(Od,{next:Qa(1,a)});xb(e,c+" Iterator")},Ec=ka("iterator"),Fc=!([].keys&&"next"in[].keys()),Hf=function(){return this},Pd=function(e,c,a,b,d,f,k){Gf(a,c,b);b=function(b){return!Fc&&b in n?n[b]:
function(){return new a(this,b)}};var g=c+" Iterator",h="values"==d,m=!1,n=e.prototype,p=n[Ec]||n["@@iterator"]||d&&n[d],l=p||b(d),r=d?h?b("entries"):l:void 0,q="Array"==c?n.entries||p:p,t;q&&(e=Ld(q.call(new e)),e!==Object.prototype&&e.next&&xb(e,g,!0));h&&p&&"values"!==p.name&&(m=!0,l=function(){return p.call(this)});k&&(Fc||m||!n[Ec])&&Xa(n,Ec,l);Ma[c]=l;Ma[g]=Hf;if(d){var S={values:h?l:b("values"),keys:f?l:b("keys"),entries:r};if(k)for(t in S)t in n||Xa(n,t,S[t]);else O(O.P+O.F*(Fc||m),c,S)}return S},
If=function(e){return function(c,a){c=String(Va(c));a=Ac(a);var b=c.length,d;if(0>a||a>=b)return e?"":void 0;var f=c.charCodeAt(a);return 55296>f||56319<f||a+1===b||56320>(d=c.charCodeAt(a+1))||57343<d?e?c.charAt(a):f:e?c.slice(a,a+2):(f-55296<<10)+(d-56320)+65536}}(!0);Pd(String,"String",function(e){this._t=String(e);this._i=0},function(){var e=this._t,c=this._i;if(c>=e.length)return{value:void 0,done:!0};e=If(e,c);this._i+=e.length;return{value:e,done:!1}});var ac=function(e,c){return{value:c,done:!!e}};
Pd(Array,"Array",function(e,c){this._t=Fa(e);this._i=0;this._k=c},function(){var e=this._t,c=this._k,a=this._i++;return!e||a>=e.length?(this._t=void 0,ac(1)):"keys"==c?ac(0,a):"values"==c?ac(0,e[a]):ac(0,[a,e[a]])},"values");Ma.Arguments=Ma.Array;for(var Qd=ka("toStringTag"),Rd="CSSRuleList CSSStyleDeclaration CSSValueList ClientRectList DOMRectList DOMStringList DOMTokenList DataTransferItemList FileList HTMLAllCollection HTMLCollection HTMLFormElement HTMLSelectElement MediaList MimeTypeArray NamedNodeMap NodeList PaintRequestList Plugin PluginArray SVGLengthList SVGNumberList SVGPathSegList SVGPointList SVGStringList SVGTransformList SourceBufferList StyleSheetList TextTrackCueList TextTrackList TouchList".split(" "),
Gc=0;Gc<Rd.length;Gc++){var Hc=Rd[Gc],Sd=ma[Hc],Ic=Sd&&Sd.prototype;Ic&&!Ic[Qd]&&Xa(Ic,Qd,Hc);Ma[Hc]=Ma.Array}var bc={f:ka},Jf=bc.f("iterator"),yb=H(function(e){e.exports={"default":Jf,__esModule:!0}});K(yb);var Td=H(function(e){var c=Tb("meta"),a=Ga.f,b=0,d=Object.isExtensible||function(){return!0},f=!Wa(function(){return d(Object.preventExtensions({}))}),k=function(d){a(d,c,{value:{i:"O"+ ++b,w:{}}})},g=e.exports={KEY:c,NEED:!1,fastKey:function(a,b){if(!xa(a))return"symbol"==typeof a?a:("string"==
typeof a?"S":"P")+a;if(!R(a,c)){if(!d(a))return"F";if(!b)return"E";k(a)}return a[c].i},getWeak:function(a,b){if(!R(a,c)){if(!d(a))return!0;if(!b)return!1;k(a)}return a[c].w},onFreeze:function(a){f&&g.NEED&&d(a)&&!R(a,c)&&k(a);return a}}}),Kf=Ga.f,Jc=function(e){var c=W.Symbol||(W.Symbol={});"_"==e.charAt(0)||e in c||Kf(c,e,{value:bc.f(e)})},Lf=Array.isArray||function(e){return"Array"==tb(e)},Mf=Ub.concat("length","prototype"),Ud=Object.getOwnPropertyNames||function(e){return Hd(e,Mf)},Vd=Ud,Nf={}.toString,
Wd="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Xd=function(e){if(Wd&&"[object Window]"==Nf.call(e))try{var c=Vd(e)}catch(a){c=Wd.slice()}else c=Vd(Fa(e));return c},Yd=Object.getOwnPropertyDescriptor,cc={f:Pa?Yd:function(e,c){e=Fa(e);c=vb(c,!0);if(Jd)try{return Yd(e,c)}catch(a){}if(R(e,c))return Qa(!Yb.call(e,c),e[c])}},Of=Td.KEY,Zd=cc.f,Za=Ga.f,$d=Xd,na=ma.Symbol,dc=ma.JSON,ec=dc&&dc.stringify,oa=ka("_hidden"),ae=ka("toPrimitive"),Pf={}.propertyIsEnumerable,
zb=ub("symbol-registry"),Na=ub("symbols"),Ab=ub("op-symbols"),za=Object.prototype,eb="function"==typeof na,Kc=ma.QObject,Lc=!Kc||!Kc.prototype||!Kc.prototype.findChild,Mc=Pa&&Wa(function(){return 7!=Ya(Za({},"a",{get:function(){return Za(this,"a",{value:7}).a}})).a})?function(e,c,a){var b=Zd(za,c);b&&delete za[c];Za(e,c,a);b&&e!==za&&Za(za,c,b)}:Za,be=function(e){var c=Na[e]=Ya(na.prototype);c._k=e;return c},Nc=eb&&"symbol"==typeof na.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof
na},fc=function(e,c,a){e===za&&fc(Ab,c,a);ya(e);c=vb(c,!0);ya(a);return R(Na,c)?(a.enumerable?(R(e,oa)&&e[oa][c]&&(e[oa][c]=!1),a=Ya(a,{enumerable:Qa(0,!1)})):(R(e,oa)||Za(e,oa,Qa(1,{})),e[oa][c]=!0),Mc(e,c,a)):Za(e,c,a)},ce=function(e,c){ya(e);var a=c=Fa(c),b=db(a),d=Cc;if(d){d=d(a);for(var f=Yb,k=0,g;d.length>k;)f.call(a,g=d[k++])&&b.push(g)}a=0;g=b.length;for(var h;g>a;)fc(e,h=b[a++],c[h]);return e},Qf=function(e){var c=Pf.call(this,e=vb(e,!0));return this===za&&R(Na,e)&&!R(Ab,e)?!1:c||!R(this,
e)||!R(Na,e)||R(this,oa)&&this[oa][e]?c:!0},de=function(e,c){e=Fa(e);c=vb(c,!0);if(e!==za||!R(Na,c)||R(Ab,c)){var a=Zd(e,c);!a||!R(Na,c)||R(e,oa)&&e[oa][c]||(a.enumerable=!0);return a}},ee=function(e){e=$d(Fa(e));for(var c=[],a=0,b;e.length>a;)R(Na,b=e[a++])||b==oa||b==Of||c.push(b);return c},fe=function(e){var c=e===za;e=$d(c?Ab:Fa(e));for(var a=[],b=0,d;e.length>b;)R(Na,d=e[b++])&&(c?R(za,d):1)&&a.push(Na[d]);return a};eb||(na=function(){if(this instanceof na)throw TypeError("Symbol is not a constructor!");
var e=Tb(0<arguments.length?arguments[0]:void 0),c=function(a){this===za&&c.call(Ab,a);R(this,oa)&&R(this[oa],e)&&(this[oa][e]=!1);Mc(this,e,Qa(1,a))};Pa&&Lc&&Mc(za,e,{configurable:!0,set:c});return be(e)},Xa(na.prototype,"toString",function(){return this._k}),cc.f=de,Ga.f=fc,Ud=Xd=ee,Yb=Qf,Cc=fe,bc.f=function(e){return be(ka(e))});O(O.G+O.W+O.F*!eb,{Symbol:na});for(var ge="hasInstance isConcatSpreadable iterator match replace search species split toPrimitive toStringTag unscopables".split(" "),he=
0;ge.length>he;)ka(ge[he++]);for(var ie=db(ka.store),je=0;ie.length>je;)Jc(ie[je++]);O(O.S+O.F*!eb,"Symbol",{"for":function(e){return R(zb,e+="")?zb[e]:zb[e]=na(e)},keyFor:function(e){if(!Nc(e))throw TypeError(e+" is not a symbol!");for(var c in zb)if(zb[c]===e)return c},useSetter:function(){Lc=!0},useSimple:function(){Lc=!1}});O(O.S+O.F*!eb,"Object",{create:function(e,c){return void 0===c?Ya(e):ce(Ya(e),c)},defineProperty:fc,defineProperties:ce,getOwnPropertyDescriptor:de,getOwnPropertyNames:ee,
getOwnPropertySymbols:fe});dc&&O(O.S+O.F*(!eb||Wa(function(){var e=na();return"[null]"!=ec([e])||"{}"!=ec({a:e})||"{}"!=ec(Object(e))})),"JSON",{stringify:function(e){for(var c=[e],a=1,b;arguments.length>a;)c.push(arguments[a++]);b=a=c[1];if((xa(a)||void 0!==e)&&!Nc(e))return Lf(a)||(a=function(a,c){"function"==typeof b&&(c=b.call(this,a,c));if(!Nc(c))return c}),c[1]=a,ec.apply(dc,c)}});na.prototype[ae]||Xa(na.prototype,ae,na.prototype.valueOf);xb(na,"Symbol");xb(Math,"Math",!0);xb(ma.JSON,"JSON",
!0);Jc("asyncIterator");Jc("observable");var Rf=W.Symbol,Bb=H(function(e){e.exports={"default":Rf,__esModule:!0}}),ke=K(Bb),fb=H(function(e,c){c.__esModule=!0;e=yb&&yb.__esModule?yb:{default:yb};var a=Bb&&Bb.__esModule?Bb:{default:Bb},b="function"===typeof a.default&&"symbol"===typeof e.default?function(a){return typeof a}:function(b){return b&&"function"===typeof a.default&&b.constructor===a.default&&b!==a.default.prototype?"symbol":typeof b};c.default="function"===typeof a.default&&"symbol"===b(e.default)?
function(a){return"undefined"===typeof a?"undefined":b(a)}:function(d){return d&&"function"===typeof a.default&&d.constructor===a.default&&d!==a.default.prototype?"symbol":"undefined"===typeof d?"undefined":b(d)}}),jc=K(fb),Sf=H(function(e,c){c.__esModule=!0;var a=fb&&fb.__esModule?fb:{default:fb};c.default=function(b,d){if(!b)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!d||"object"!==("undefined"===typeof d?"undefined":(0,a.default)(d))&&"function"!==
typeof d?b:d}}),M=K(Sf),Tf=cc.f;Xb("getOwnPropertyDescriptor",function(){return function(e,c){return Tf(Fa(e),c)}});var Uf=W.Object,Vf=function(e,c){return Uf.getOwnPropertyDescriptor(e,c)},Cb=H(function(e){e.exports={"default":Vf,__esModule:!0}}),Y=K(Cb),Wf=H(function(e,c){c.__esModule=!0;var a=wb&&wb.__esModule?wb:{default:wb},b=Cb&&Cb.__esModule?Cb:{default:Cb};c.default=function h(c,k,g){null===c&&(c=Function.prototype);var f=(0,b.default)(c,k);if(void 0===f){if(c=(0,a.default)(c),null!==c)return h(c,
k,g)}else{if("value"in f)return f.value;k=f.get;return void 0===k?void 0:k.call(g)}}}),Ra=K(Wf),Xf=Object.setPrototypeOf||("__proto__"in{}?function(e,c,a){try{a=Vb(Function.call,cc.f(Object.prototype,"__proto__").set,2),a(e,[]),c=!(e instanceof Array)}catch(b){c=!0}return function(b,d){ya(b);if(!xa(d)&&null!==d)throw TypeError(d+": can't set as prototype!");c?b.__proto__=d:a(b,d);return b}}({},!1):void 0);O(O.S,"Object",{setPrototypeOf:Xf});var Yf=W.Object.setPrototypeOf,le=H(function(e){e.exports=
{"default":Yf,__esModule:!0}});K(le);O(O.S,"Object",{create:Ya});var Zf=W.Object,$f=function(e,c){return Zf.create(e,c)},me=H(function(e){e.exports={"default":$f,__esModule:!0}}),ag=K(me),bg=H(function(e,c){function a(a){return a&&a.__esModule?a:{default:a}}c.__esModule=!0;var b=a(le),d=a(me),f=a(fb);c.default=function(a,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof c?"undefined":(0,f.default)(c)));a.prototype=
(0,d.default)(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(b.default?(0,b.default)(a,c):a.__proto__=c)}}),G=K(bg),cg=ka("toStringTag"),dg="Arguments"==tb(function(){return arguments}()),ne=function(e){var c;if(void 0===e)var a="Undefined";else{if(null===e)var b="Null";else{a:{var d=e=Object(e);try{b=d[cg];break a}catch(f){}b=void 0}b="string"==typeof(a=b)?a:dg?tb(e):"Object"==(c=tb(e))&&"function"==typeof e.callee?"Arguments":c}a=b}return a},eg=ka("iterator"),
fg=W.isIterable=function(e){e=Object(e);return void 0!==e[eg]||"@@iterator"in e||Ma.hasOwnProperty(ne(e))},Db=H(function(e){e.exports={"default":fg,__esModule:!0}});K(Db);var gg=ka("iterator"),oe=W.getIteratorMethod=function(e){if(void 0!=e)return e[gg]||e["@@iterator"]||Ma[ne(e)]},hg=W.getIterator=function(e){var c=oe(e);if("function"!=typeof c)throw TypeError(e+" is not iterable!");return ya(c.call(e))},Eb=H(function(e){e.exports={"default":hg,__esModule:!0}}),Cd=K(Eb),ig=H(function(e,c){c.__esModule=
!0;var a=Db&&Db.__esModule?Db:{default:Db},b=Eb&&Eb.__esModule?Eb:{default:Eb};c.default=function(){return function(d,c){if(Array.isArray(d))return d;if((0,a.default)(Object(d))){var k=[],f=!0,h=!1,e=void 0;try{for(var n=(0,b.default)(d),p;!(f=(p=n.next()).done)&&(k.push(p.value),!c||k.length!==c);f=!0);}catch(l){h=!0,e=l}finally{try{if(!f&&n["return"])n["return"]()}finally{if(h)throw e;}}return k}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}()}),Fb=K(ig),jg=ka("iterator"),
kg=Array.prototype,Oc=ka("iterator"),pe=!1;try{[7][Oc]()["return"]=function(){pe=!0}}catch(e){}O(O.S+O.F*!function(e,c){if(!c&&!pe)return!1;var a=!1;try{c=[7];var b=c[Oc]();b.next=function(){return{done:a=!0}};c[Oc]=function(){return b};e(c)}catch(d){}return a}(function(e){}),"Array",{from:function(e){var c=Object(Va(e)),a="function"==typeof this?this:Array,b=arguments.length,d=1<b?arguments[1]:void 0,f=void 0!==d,k=0,g=oe(c),h;f&&(d=Vb(d,2<b?arguments[2]:void 0,2));if(void 0!=g&&(a!=Array||void 0===
g||Ma.Array!==g&&kg[jg]!==g))for(c=g.call(c),a=new a;!(h=c.next()).done;k++){var m=a;b=k;if(f){g=c;var n=d;h=[h.value,k];try{var p=n(ya(h)[0],h[1])}catch(l){throw d=g["return"],void 0!==d&&ya(d.call(g)),l;}}else p=h.value;g=m;m=p;b in g?Ga.f(g,b,Qa(0,m)):g[b]=m}else for(p=Fd(c.length),a=new a(p);p>k;k++)b=a,g=k,m=f?d(c[k],k):c[k],g in b?Ga.f(b,g,Qa(0,m)):b[g]=m;a.length=k;return a}});var lg=W.Array.from,Gb=H(function(e){e.exports={"default":lg,__esModule:!0}});K(Gb);var mg=H(function(e,c){c.__esModule=
!0;var a=Gb&&Gb.__esModule?Gb:{default:Gb};c.default=function(b){if(Array.isArray(b)){for(var d=0,c=Array(b.length);d<b.length;d++)c[d]=b[d];return c}return(0,a.default)(b)}}),aa=K(mg),ng=Td.onFreeze;Xb("freeze",function(e){return function(c){return e&&xa(c)?e(ng(c)):c}});var og=W.Object.freeze,pg=H(function(e){e.exports={"default":og,__esModule:!0}}),$c=K(pg),qe=W.JSON||(W.JSON={stringify:JSON.stringify}),qg=function(e){return qe.stringify.apply(qe,arguments)},rg=H(function(e){e.exports={"default":qg,
__esModule:!0}}),Oe=K(rg),Aa={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],
darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,
105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,
250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],
mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,
112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,
192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Hb=H(function(e){var c=Array.prototype.concat,a=Array.prototype.slice,b=e.exports=function(b){for(var d=[],
k=0,g=b.length;k<g;k++){var h=b[k];var e=(e=h)&&"string"!==typeof e?e instanceof Array||Array.isArray(e)||0<=e.length&&(e.splice instanceof Function||Y(e,e.length-1)&&"String"!==e.constructor.name):!1;e?d=c.call(d,a.call(h)):d.push(h)}return d};b.wrap=function(a){return function(){return a(b(arguments))}}}),mb=H(function(e){function c(a,b,d){return Math.min(Math.max(b,a),d)}function a(a){a=a.toString(16).toUpperCase();return 2>a.length?"0"+a:a}var b={},d;for(d in Aa)Aa.hasOwnProperty(d)&&(b[Aa[d]]=
d);var f=e.exports={to:{},get:{}};f.get=function(a){switch(a.substring(0,3).toLowerCase()){case "hsl":a=f.get.hsl(a);var b="hsl";break;case "hwb":a=f.get.hwb(a);b="hwb";break;default:a=f.get.rgb(a),b="rgb"}return a?{model:b,value:a}:null};f.get.rgb=function(a){if(!a)return null;var b=/^#([a-f0-9]{3,4})$/i,d=/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,k=/^rgba?\(\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,
f=/(\D+)/,e=[0,0,0,1],l;if(l=a.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){b=l[2];l=l[1];for(a=0;3>a;a++)d=2*a,e[a]=parseInt(l.slice(d,d+2),16);b&&(e[3]=Math.round(parseInt(b,16)/255*100)/100)}else if(l=a.match(b)){l=l[1];b=l[3];for(a=0;3>a;a++)e[a]=parseInt(l[a]+l[a],16);b&&(e[3]=Math.round(parseInt(b+b,16)/255*100)/100)}else if(l=a.match(d)){for(a=0;3>a;a++)e[a]=parseInt(l[a+1],0);l[4]&&(e[3]=parseFloat(l[4]))}else if(l=a.match(k)){for(a=0;3>a;a++)e[a]=Math.round(2.55*parseFloat(l[a+1]));l[4]&&(e[3]=
parseFloat(l[4]))}else{if(l=a.match(f)){if("transparent"===l[1])return[0,0,0,0];e=Aa[l[1]];if(!e)return null;e[3]=1;return e}return null}for(a=0;3>a;a++)e[a]=c(e[a],0,255);e[3]=c(e[3],0,1);return e};f.get.hsl=function(a){if(!a)return null;var b=a.match(/^hsla?\(\s*([+-]?(?:\d*\.)?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(b){var d=parseFloat(b[4]);a=(parseFloat(b[1])+360)%360;var k=c(parseFloat(b[2]),0,100);b=c(parseFloat(b[3]),0,100);d=c(isNaN(d)?
1:d,0,1);return[a,k,b,d]}return null};f.get.hwb=function(a){if(!a)return null;var b=a.match(/^hwb\(\s*([+-]?\d*[\.]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(b){var d=parseFloat(b[4]);a=(parseFloat(b[1])%360+360)%360;var k=c(parseFloat(b[2]),0,100);b=c(parseFloat(b[3]),0,100);d=c(isNaN(d)?1:d,0,1);return[a,k,b,d]}return null};f.to.hex=function(){var b=Hb(arguments);return"#"+a(b[0])+a(b[1])+a(b[2])+(1>b[3]?a(Math.round(255*b[3])):"")};f.to.rgb=function(){var a=
Hb(arguments);return 4>a.length||1===a[3]?"rgb("+Math.round(a[0])+", "+Math.round(a[1])+", "+Math.round(a[2])+")":"rgba("+Math.round(a[0])+", "+Math.round(a[1])+", "+Math.round(a[2])+", "+a[3]+")"};f.to.rgb.percent=function(){var a=Hb(arguments),b=Math.round(a[0]/255*100),d=Math.round(a[1]/255*100),c=Math.round(a[2]/255*100);return 4>a.length||1===a[3]?"rgb("+b+"%, "+d+"%, "+c+"%)":"rgba("+b+"%, "+d+"%, "+c+"%, "+a[3]+")"};f.to.hsl=function(){var a=Hb(arguments);return 4>a.length||1===a[3]?"hsl("+
a[0]+", "+a[1]+"%, "+a[2]+"%)":"hsla("+a[0]+", "+a[1]+"%, "+a[2]+"%, "+a[3]+")"};f.to.hwb=function(){var a=Hb(arguments),b="";4<=a.length&&1!==a[3]&&(b=", "+a[3]);return"hwb("+a[0]+", "+a[1]+"%, "+a[2]+"%"+b+")"};f.to.keyword=function(a){return b[a.slice(0,3)]}}),$a=H(function(e){var c={};for(d in Aa)Aa.hasOwnProperty(d)&&(c[Aa[d]]=d);var a=e.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},
xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}},b;for(b in a)if(a.hasOwnProperty(b)){if(!("channels"in a[b]))throw Error("missing channels property: "+b);if(!("labels"in a[b]))throw Error("missing channel labels property: "+
b);if(a[b].labels.length!==a[b].channels)throw Error("channel and label counts mismatch: "+b);e=a[b].channels;var d=a[b].labels;delete a[b].channels;delete a[b].labels;Object.defineProperty(a[b],"channels",{value:e});Object.defineProperty(a[b],"labels",{value:d})}a.rgb.hsl=function(a){var b=a[0]/255,d=a[1]/255,c=a[2]/255;a=Math.min(b,d,c);var f=Math.max(b,d,c),e=f-a,p;f===a?p=0:b===f?p=(d-c)/e:d===f?p=2+(c-b)/e:c===f&&(p=4+(b-d)/e);p=Math.min(60*p,360);0>p&&(p+=360);b=(a+f)/2;return[p,100*(f===a?
0:.5>=b?e/(f+a):e/(2-f-a)),100*b]};a.rgb.hsv=function(a){var b,d=a[0]/255,c=a[1]/255,f=a[2]/255,e=Math.max(d,c,f);var p=e-Math.min(d,c,f);if(0===p)var l=b=0;else{b=p/e;a=(e-d)/6/p+.5;var r=(e-c)/6/p+.5;p=(e-f)/6/p+.5;d===e?l=p-r:c===e?l=1/3+a-p:f===e&&(l=2/3+r-a);0>l?l+=1:1<l&&--l}return[360*l,100*b,100*e]};a.rgb.hwb=function(b){var d=b[0],c=b[1],h=b[2];b=a.rgb.hsl(b)[0];var f=1/255*Math.min(d,Math.min(c,h));h=1-1/255*Math.max(d,Math.max(c,h));return[b,100*f,100*h]};a.rgb.cmyk=function(a){var b=a[0]/
255,d=a[1]/255;a=a[2]/255;var c=Math.min(1-b,1-d,1-a);return[100*((1-b-c)/(1-c)||0),100*((1-d-c)/(1-c)||0),100*((1-a-c)/(1-c)||0),100*c]};a.rgb.keyword=function(a){var b=c[a];if(b)return b;b=Infinity;var d;for(d in Aa)if(Aa.hasOwnProperty(d)){var h=Aa[d];h=Math.pow(a[0]-h[0],2)+Math.pow(a[1]-h[1],2)+Math.pow(a[2]-h[2],2);if(h<b){b=h;var f=d}}return f};a.keyword.rgb=function(a){return Aa[a]};a.rgb.xyz=function(a){var b=a[0]/255,d=a[1]/255;a=a[2]/255;b=.04045<b?Math.pow((b+.055)/1.055,2.4):b/12.92;
d=.04045<d?Math.pow((d+.055)/1.055,2.4):d/12.92;a=.04045<a?Math.pow((a+.055)/1.055,2.4):a/12.92;return[100*(.4124*b+.3576*d+.1805*a),100*(.2126*b+.7152*d+.0722*a),100*(.0193*b+.1192*d+.9505*a)]};a.rgb.lab=function(b){var d=a.rgb.xyz(b);b=d[0];var c=d[1];d=d[2];b/=95.047;c/=100;d/=108.883;b=.008856<b?Math.pow(b,1/3):7.787*b+16/116;c=.008856<c?Math.pow(c,1/3):7.787*c+16/116;d=.008856<d?Math.pow(d,1/3):7.787*d+16/116;return[116*c-16,500*(b-c),200*(c-d)]};a.hsl.rgb=function(a){var b=a[0]/360,d=a[1]/100;
a=a[2]/100;if(0===d){var c=255*a;return[c,c,c]}d=.5>a?a*(1+d):a+d-a*d;a=2*a-d;var e=[0,0,0];for(var f=0;3>f;f++)c=b+1/3*-(f-1),0>c&&c++,1<c&&c--,c=1>6*c?a+6*(d-a)*c:1>2*c?d:2>3*c?a+(d-a)*(2/3-c)*6:a,e[f]=255*c;return e};a.hsl.hsv=function(a){var b=a[0],d=a[1]/100;a=a[2]/100;var c=d,e=Math.max(a,.01);a*=2;d*=1>=a?a:2-a;c*=1>=e?e:2-e;return[b,100*(0===a?2*c/(e+c):2*d/(a+d)),(a+d)/2*100]};a.hsv.rgb=function(a){var b=a[0]/60,d=a[1]/100;a=a[2]/100;var c=Math.floor(b)%6,e=b-Math.floor(b);b=255*a*(1-d);
var f=255*a*(1-d*e);d=255*a*(1-d*(1-e));a*=255;switch(c){case 0:return[a,d,b];case 1:return[f,a,b];case 2:return[b,a,d];case 3:return[b,f,a];case 4:return[d,b,a];case 5:return[a,b,f]}};a.hsv.hsl=function(a){var b=a[0],d=a[1]/100;a=a[2]/100;var c=Math.max(a,.01);var e=(2-d)*c;c=d*c/(1>=e?e:2-e)||0;return[b,100*c,(2-d)*a/2*100]};a.hwb.rgb=function(a){var b=a[0]/360,d=a[1]/100;a=a[2]/100;var c=d+a;1<c&&(d/=c,a/=c);c=Math.floor(6*b);a=1-a;b=6*b-c;0!==(c&1)&&(b=1-b);b=d+b*(a-d);switch(c){default:case 6:case 0:c=
a;var e=b;break;case 1:c=b;e=a;break;case 2:c=d;e=a;d=b;break;case 3:c=d;e=b;d=a;break;case 4:c=b;e=d;d=a;break;case 5:c=a,e=d,d=b}return[255*c,255*e,255*d]};a.cmyk.rgb=function(a){var b=a[3]/100;return[255*(1-Math.min(1,a[0]/100*(1-b)+b)),255*(1-Math.min(1,a[1]/100*(1-b)+b)),255*(1-Math.min(1,a[2]/100*(1-b)+b))]};a.xyz.rgb=function(a){var b=a[0]/100,d=a[1]/100,c=a[2]/100;a=3.2406*b+-1.5372*d+-.4986*c;var e=-.9689*b+1.8758*d+.0415*c;b=.0557*b+-.204*d+1.057*c;a=.0031308<a?1.055*Math.pow(a,1/2.4)-.055:
12.92*a;e=.0031308<e?1.055*Math.pow(e,1/2.4)-.055:12.92*e;b=.0031308<b?1.055*Math.pow(b,1/2.4)-.055:12.92*b;a=Math.min(Math.max(0,a),1);e=Math.min(Math.max(0,e),1);b=Math.min(Math.max(0,b),1);return[255*a,255*e,255*b]};a.xyz.lab=function(a){var b=a[0],d=a[1];a=a[2];b/=95.047;d/=100;a/=108.883;b=.008856<b?Math.pow(b,1/3):7.787*b+16/116;d=.008856<d?Math.pow(d,1/3):7.787*d+16/116;a=.008856<a?Math.pow(a,1/3):7.787*a+16/116;return[116*d-16,500*(b-d),200*(d-a)]};a.lab.xyz=function(a){var b=a[1],d=a[2];
a=(a[0]+16)/116;b=b/500+a;d=a-d/200;var c=Math.pow(a,3),e=Math.pow(b,3),f=Math.pow(d,3);return[95.047*(.008856<e?e:(b-16/116)/7.787),100*(.008856<c?c:(a-16/116)/7.787),108.883*(.008856<f?f:(d-16/116)/7.787)]};a.lab.lch=function(a){var b=a[0],d=a[1];a=a[2];var c=360*Math.atan2(a,d)/2/Math.PI;0>c&&(c+=360);return[b,Math.sqrt(d*d+a*a),c]};a.lch.lab=function(a){var b=a[0],d=a[1];a=a[2]/360*2*Math.PI;return[b,d*Math.cos(a),d*Math.sin(a)]};a.rgb.ansi16=function(b){var d=b[0],c=b[1],h=b[2],e=1 in arguments?
arguments[1]:a.rgb.hsv(b)[2];e=Math.round(e/50);if(0===e)return 30;d=30+(Math.round(h/255)<<2|Math.round(c/255)<<1|Math.round(d/255));2===e&&(d+=60);return d};a.hsv.ansi16=function(b){return a.rgb.ansi16(a.hsv.rgb(b),b[2])};a.rgb.ansi256=function(a){var b=a[0],d=a[1];a=a[2];return b===d&&d===a?8>b?16:248<b?231:Math.round((b-8)/247*24)+232:16+36*Math.round(b/255*5)+6*Math.round(d/255*5)+Math.round(a/255*5)};a.ansi16.rgb=function(a){var b=a%10;if(0===b||7===b)return 50<a&&(b+=3.5),b=b/10.5*255,[b,b,
b];a=.5*(~~(50<a)+1);return[(b&1)*a*255,(b>>1&1)*a*255,(b>>2&1)*a*255]};a.ansi256.rgb=function(a){if(232<=a){var b=10*(a-232)+8;return[b,b,b]}a-=16;b=Math.floor(a/36)/5*255;var d=Math.floor((a%=36)/6)/5*255;return[b,d,a%6/5*255]};a.rgb.hex=function(a){a=(((Math.round(a[0])&255)<<16)+((Math.round(a[1])&255)<<8)+(Math.round(a[2])&255)).toString(16).toUpperCase();return"000000".substring(a.length)+a};a.hex.rgb=function(a){a=a.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!a)return[0,0,0];var b=a[0];
3===a[0].length&&(b=b.split("").map(function(a){return a+a}).join(""));a=parseInt(b,16);return[a>>16&255,a>>8&255,a&255]};a.rgb.hcg=function(a){var b=a[0]/255,d=a[1]/255;a=a[2]/255;var c=Math.max(Math.max(b,d),a),e=Math.min(Math.min(b,d),a),f=c-e;return[(0>=f?0:c===b?(d-a)/f%6:c===d?2+(a-b)/f:(b-d)/f+8)/6%1*360,100*f,100*(1>f?e/(1-f):0)]};a.hsl.hcg=function(a){var b=a[1]/100,d=a[2]/100,c=0;b=.5>d?2*b*d:2*b*(1-d);1>b&&(c=(d-.5*b)/(1-b));return[a[0],100*b,100*c]};a.hsv.hcg=function(a){var b=a[2]/100,
d=a[1]/100*b,c=0;1>d&&(c=(b-d)/(1-d));return[a[0],100*d,100*c]};a.hcg.rgb=function(a){var b=a[1]/100,d=a[2]/100;if(0===b)return[255*d,255*d,255*d];var c=[0,0,0];a=a[0]/360%1*6;var e=a%1,f=1-e;switch(Math.floor(a)){case 0:c[0]=1;c[1]=e;c[2]=0;break;case 1:c[0]=f;c[1]=1;c[2]=0;break;case 2:c[0]=0;c[1]=1;c[2]=e;break;case 3:c[0]=0;c[1]=f;c[2]=1;break;case 4:c[0]=e;c[1]=0;c[2]=1;break;default:c[0]=1,c[1]=0,c[2]=f}d*=1-b;return[255*(b*c[0]+d),255*(b*c[1]+d),255*(b*c[2]+d)]};a.hcg.hsv=function(a){var b=
a[1]/100,d=b+a[2]/100*(1-b),c=0;0<d&&(c=b/d);return[a[0],100*c,100*d]};a.hcg.hsl=function(a){var b=a[1]/100,d=a[2]/100*(1-b)+.5*b,c=0;0<d&&.5>d?c=b/(2*d):.5<=d&&1>d&&(c=b/(2*(1-d)));return[a[0],100*c,100*d]};a.hcg.hwb=function(a){var b=a[1]/100,d=b+a[2]/100*(1-b);return[a[0],100*(d-b),100*(1-d)]};a.hwb.hcg=function(a){var b=1-a[2]/100,d=b-a[1]/100,c=0;1>d&&(c=(b-d)/(1-d));return[a[0],100*d,100*c]};a.apple.rgb=function(a){return[a[0]/65535*255,a[1]/65535*255,a[2]/65535*255]};a.rgb.apple=function(a){return[a[0]/
255*65535,a[1]/255*65535,a[2]/255*65535]};a.gray.rgb=function(a){return[a[0]/100*255,a[0]/100*255,a[0]/100*255]};a.gray.hsl=a.gray.hsv=function(a){return[0,0,a[0]]};a.gray.hwb=function(a){return[0,100,a[0]]};a.gray.cmyk=function(a){return[0,0,0,a[0]]};a.gray.lab=function(a){return[a[0],0,0]};a.gray.hex=function(a){a=Math.round(a[0]/100*255)&255;a=((a<<16)+(a<<8)+a).toString(16).toUpperCase();return"000000".substring(a.length)+a};a.rgb.gray=function(a){return[(a[0]+a[1]+a[2])/3/255*100]}}),sg=function(e){for(var c=
{},a=wa($a),b=a.length,d=0;d<b;d++)c[a[d]]={distance:-1,parent:null};a=[e];for(c[e].distance=0;a.length;){e=a.pop();b=wa($a[e]);d=b.length;for(var f=0;f<d;f++){var k=b[f],g=c[k];-1===g.distance&&(g.distance=c[e].distance+1,g.parent=e,a.unshift(k))}}a={};e=wa(c);b=e.length;for(d=0;d<b;d++){var h=e[d];if(null!==c[h].parent){f=h;k=c;g=[k[h].parent,h];var m=$a[k[h].parent][h];for(h=k[h].parent;k[h].parent;)g.unshift(k[h].parent),m=Le($a[k[h].parent][h],m),h=k[h].parent;m.conversion=g;a[f]=m}}return a},
gb={};wa($a).forEach(function(e){gb[e]={};Object.defineProperty(gb[e],"channels",{value:$a[e].channels});Object.defineProperty(gb[e],"labels",{value:$a[e].labels});var c=sg(e);wa(c).forEach(function(a){var b=c[a];gb[e][a]=Ne(b);gb[e][a].raw=Me(b)})});var qa=gb,kc=[].slice,Zc=["keyword","gray","hex"],mc={};wa(qa).forEach(function(e){mc[kc.call(qa[e].labels).sort().join("")]=e});var Mb={};ba.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(e){var c=
this.model in mb.to?this:this.rgb();c=c.round("number"===typeof e?e:1);e=1===c.valpha?c.color:c.color.concat(this.valpha);return mb.to[c.model](e)},percentString:function(e){e=this.rgb().round("number"===typeof e?e:1);e=1===e.valpha?e.color:e.color.concat(this.valpha);return mb.to.rgb.percent(e)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var e={},c=qa[this.model].channels,a=qa[this.model].labels,b=0;b<c;b++)e[a[b]]=this.color[b];
1!==this.valpha&&(e.alpha=this.valpha);return e},unitArray:function(){var e=this.rgb().color;e[0]/=255;e[1]/=255;e[2]/=255;1!==this.valpha&&e.push(this.valpha);return e},unitObject:function(){var e=this.rgb().object();e.r/=255;e.g/=255;e.b/=255;1!==this.valpha&&(e.alpha=this.valpha);return e},round:function(e){e=Math.max(e||0,0);return new ba(this.color.map(Pe(e)).concat(this.valpha),this.model)},alpha:function(e){return arguments.length?new ba(this.color.concat(Math.max(0,Math.min(1,e))),this.model):
this.valpha},red:V("rgb",0,ca(255)),green:V("rgb",1,ca(255)),blue:V("rgb",2,ca(255)),hue:V(["hsl","hsv","hsl","hwb","hcg"],0,function(e){return(e%360+360)%360}),saturationl:V("hsl",1,ca(100)),lightness:V("hsl",2,ca(100)),saturationv:V("hsv",1,ca(100)),value:V("hsv",2,ca(100)),chroma:V("hcg",1,ca(100)),gray:V("hcg",2,ca(100)),white:V("hwb",1,ca(100)),wblack:V("hwb",2,ca(100)),cyan:V("cmyk",0,ca(100)),magenta:V("cmyk",1,ca(100)),yellow:V("cmyk",2,ca(100)),black:V("cmyk",3,ca(100)),x:V("xyz",0,ca(100)),
y:V("xyz",1,ca(100)),z:V("xyz",2,ca(100)),l:V("lab",0,ca(100)),a:V("lab",1),b:V("lab",2),keyword:function(e){return arguments.length?new ba(e):qa[this.model].keyword(this.color)},hex:function(e){return arguments.length?new ba(e):mb.to.hex(this.rgb().round().color)},rgbNumber:function(){var e=this.rgb().color;return(e[0]&255)<<16|(e[1]&255)<<8|e[2]&255},luminosity:function(){for(var e=this.rgb().color,c=[],a=0;a<e.length;a++){var b=e[a]/255;c[a]=.03928>=b?b/12.92:Math.pow((b+.055)/1.055,2.4)}return.2126*
c[0]+.7152*c[1]+.0722*c[2]},contrast:function(e){var c=this.luminosity();e=e.luminosity();return c>e?(c+.05)/(e+.05):(e+.05)/(c+.05)},level:function(e){e=this.contrast(e);return 7.1<=e?"AAA":4.5<=e?"AA":""},isDark:function(){var e=this.rgb().color;return 128>(299*e[0]+587*e[1]+114*e[2])/1E3},isLight:function(){return!this.isDark()},negate:function(){for(var e=this.rgb(),c=0;3>c;c++)e.color[c]=255-e.color[c];return e},lighten:function(e){var c=this.hsl();c.color[2]+=c.color[2]*e;return c},darken:function(e){var c=
this.hsl();c.color[2]-=c.color[2]*e;return c},saturate:function(e){var c=this.hsl();c.color[1]+=c.color[1]*e;return c},desaturate:function(e){var c=this.hsl();c.color[1]-=c.color[1]*e;return c},whiten:function(e){var c=this.hwb();c.color[1]+=c.color[1]*e;return c},blacken:function(e){var c=this.hwb();c.color[2]+=c.color[2]*e;return c},grayscale:function(){var e=this.rgb().color;e=.3*e[0]+.59*e[1]+.11*e[2];return ba.rgb(e,e,e)},fade:function(e){return this.alpha(this.valpha-this.valpha*e)},opaquer:function(e){return this.alpha(this.valpha+
this.valpha*e)},rotate:function(e){var c=this.hsl(),a=c.color[0];a=(a+e)%360;c.color[0]=0>a?360+a:a;return c},mix:function(e,c){if(!e||!e.rgb)throw Error('Argument to "mix" was not a Color instance, but rather an instance of '+("undefined"===typeof e?"undefined":jc(e)));e=e.rgb();var a=this.rgb();c=void 0===c?.5:c;var b=2*c-1,d=e.alpha()-a.alpha();b=((-1===b*d?b:(b+d)/(1+b*d))+1)/2;d=1-b;return ba.rgb(b*e.red()+d*a.red(),b*e.green()+d*a.green(),b*e.blue()+d*a.blue(),e.alpha()*c+a.alpha()*(1-c))}};
wa(qa).forEach(function(e){if(-1===Zc.indexOf(e)){var c=qa[e].channels;ba.prototype[e]=function(){if(this.model===e)return new ba(this);if(arguments.length)return new ba(arguments,e);var a="number"===typeof arguments[c]?c:this.valpha;var b=qa[this.model][e].raw(this.color);b=Array.isArray(b)?b:[b];return new ba(b.concat(a),e)};ba[e]=function(a){"number"===typeof a&&(a=lc(kc.call(arguments),c));return new ba(a,e)}}});ad(ra,{EARTHRADIUS:6370996.81,MCBAND:[1.289059486E7,8362377.87,5591021,3481989.83,
1678043.12,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1.410526172116255E-8,8.98305509648872E-6,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,1.73379812E7],[-7.435856389565537E-9,8.983055097726239E-6,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,1.026014486E7],[-3.030883460898826E-8,8.98305509983578E-6,.30071316287616,59.74293618442277,7.357984074871,
-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552E-8,8.983055099779535E-6,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437E-9,8.983055096812155E-6,6.995724062E-5,23.10934304144901,-2.3663490511E-4,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878E-9,8.983055095805407E-6,-3.068298E-8,7.47137025468032,-3.53937994E-6,
-.02145144861037,-1.234426596E-5,1.0322952773E-4,-3.23890364E-6,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[8.277824516172526E-4,111320.7020463578,6.477955746671607E8,-4.082003173641316E9,1.077490566351142E10,-1.517187553151559E10,1.205306533862167E10,-5.124939663577472E9,9.133119359512032E8,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-2.339375119931662E7,
7.968221547186455E7,-1.159649932797253E8,9.723671115602145E7,-4.366194633752821E7,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-3.441963504368392E-4,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-3.218135878613132E-4,111320.7020701615,.00369383431289,
823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],getDistanceByMC:function(e,c){if(!e||!c)return 0;e=this.convertMC2LL(e);if(!e)return 0;var a=this.toRadians(e.lng);e=this.toRadians(e.lat);c=this.convertMC2LL(c);if(!c)return 0;var b=this.toRadians(c.lng);c=this.toRadians(c.lat);return this.getDistance(a,b,e,c)},getDistanceByLL:function(e,c){if(!e||!c)return 0;e.lng=this.getLoop(e.lng,-180,180);e.lat=this.getRange(e.lat,-74,74);c.lng=this.getLoop(c.lng,
-180,180);c.lat=this.getRange(c.lat,-74,74);var a=this.toRadians(e.lng);var b=this.toRadians(e.lat);e=this.toRadians(c.lng);c=this.toRadians(c.lat);return this.getDistance(a,e,b,c)},convertMC2LL:function(e){if(null===e||void 0===e)return new Ca(0,0);if(180>e.lng&&-180<e.lng&&90>e.lat&&-90<e.lat)return e;var c=new Ca(Math.abs(e.lng),Math.abs(e.lat));for(var a=0;a<this.MCBAND.length;a++)if(c.lat>=this.MCBAND[a]){var b=this.MC2LL[a];break}e=this.convertor(e,b);return e=new Ca(e.lng.toFixed(6),e.lat.toFixed(6))},
convertLL2MC:function(e){if(null===e||void 0===e)return new Ca(0,0);if(180<e.lng||-180>e.lng||90<e.lat||-90>e.lat)return e;e.lng=this.getLoop(e.lng,-180,180);e.lat=this.getRange(e.lat,-74,74);var c=new Ca(e.lng,e.lat);for(var a=0;a<this.LLBAND.length;a++)if(c.lat>=this.LLBAND[a]){var b=this.LL2MC[a];break}if(!b)for(a=0;a<this.LLBAND.length;a++)if(c.lat<=-this.LLBAND[a]){b=this.LL2MC[a];break}e=this.convertor(e,b);return e=new Ca(Number(e.lng.toFixed(2)),Number(e.lat.toFixed(2)))},convertor:function(e,
c){if(e&&c){var a=c[0]+c[1]*Math.abs(e.lng),b=Math.abs(e.lat)/c[9];c=c[2]+c[3]*b+c[4]*b*b+c[5]*b*b*b+c[6]*b*b*b*b+c[7]*b*b*b*b*b+c[8]*b*b*b*b*b*b;a*=0>e.lng?-1:1;c*=0>e.lat?-1:1;return new Ca(a,c)}},getDistance:function(e,c,a,b){return this.EARTHRADIUS*Math.acos(Math.sin(a)*Math.sin(b)+Math.cos(a)*Math.cos(b)*Math.cos(c-e))},toRadians:function(e){return Math.PI*e/180},toDegrees:function(e){return 180*e/Math.PI},getRange:function(e,c,a){null!=c&&(e=Math.max(e,c));null!=a&&(e=Math.min(e,a));return e},
getLoop:function(e,c,a){for(;e>a;)e-=a-c;for(;e<c;)e+=a-c;return e}});ad(ra.prototype,{lngLatToMercator:function(e){return ra.convertLL2MC(e)},lngLatToPoint:function(e){e=ra.convertLL2MC(e);return new bd(e.lng,e.lat)},mercatorToLngLat:function(e){return ra.convertMC2LL(e)},pointToLngLat:function(e){e=new Ca(e.x,e.y);return ra.convertMC2LL(e)},pointToPixel:function(e,c,a,b,d){if(e)return e=this.lngLatToMercator(e,d),c=this.getZoomUnits(c),new bd(Math.round((e.lng-a.lng)/c+b.width/2),Math.round((a.lat-
e.lat)/c+b.height/2))},pixelToPoint:function(e,c,a,b,d){if(e)return c=this.getZoomUnits(c),e=new Ca(a.lng+c*(e.x-b.width/2),a.lat-c*(e.y-b.height/2)),this.mercatorToLngLat(e,d)},getZoomUnits:function(e){return Math.pow(2,18-e)}});ia.prototype.setMax=function(e){this.max=e||100};ia.prototype.setMin=function(e){this.min=e||0};ia.prototype.setMaxSize=function(e){this.maxSize=e||35};ia.prototype.setMinSize=function(e){this.minSize=e||0};ia.prototype.initPalette=function(){var e=this.gradient,c=this.paletteCtx=
(new rc(256,1)).getContext("2d"),a=c.createLinearGradient(0,0,256,1);wa(e).forEach(function(b){a.addColorStop(parseFloat(b),e[b])});c.fillStyle=a;c.fillRect(0,0,256,1);c.imageData=c.getImageData(0,0,256,1).data};ia.prototype.getColor=function(e){e=this.getImageData(e);return"rgba("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]/256+")"};ia.prototype.getImageData=function(e){var c=this.paletteCtx.imageData;if(void 0===e)return c;var a=this.max,b=this.min;e>a&&(e=a);e<b&&(e=b);e=4*Math.floor((e-b)/(a-b)*255);return[c[e],
c[e+1],c[e+2],c[e+3]]};ia.prototype.getSize=function(e){var c=this.max,a=this.min,b=this.maxSize,d=this.minSize;e>c&&(e=c);e<a&&(e=a);return d+(e-a)/(c-a)*(b-d)};Ha.prototype._initialize=function(){this.v0=this._normalizaCoord(this.options.start);this.v3=this._normalizaCoord(this.options.end);this.v1=this._getControlPoint(this.v0,this.v3,4);this.v2=this._getControlPoint(this.v3,this.v0,5);this.v0[2]||(this.v0[2]=0);this.v3[2]||(this.v3[2]=0)};Ha.prototype.setOptions=function(e){this.options=e||{};
this._initialize()};Ha.prototype.getPoints=function(e){void 0===e&&(e=20);for(var c=[],a=0;a<=e;a++)c.push(this._getPoint(a/e));return c};Ha.prototype._normalizaCoord=function(e){if(!e)return[];e=ra.convertLL2MC({lng:Number(e[0]),lat:Number(e[1])});return[e.lng,e.lat]};Ha.prototype._getControlPoint=function(e,c){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return[].concat(aa(this._getQuarter(e,c)),[this._getDistance(e,c)/a])};Ha.prototype._getQuarter=function(e,c){return[(3*e[0]+
c[0])/4,(3*e[1]+c[1])/4]};Ha.prototype._getDistance=function(e,c){return Math.sqrt(Math.pow(e[0]-c[0],2)+Math.pow(e[1]-c[1],2))};Ha.prototype._getPoint=function(e){var c=[],a=this.v0,b=this.v1,d=this.v2,f=this.v3;c.push(sc(e,a[0],b[0],d[0],f[0]),sc(e,a[1],b[1],d[1],f[1]),sc(e,a[2],b[2],d[2],f[2]));return c};Oa.prototype._initialize=function(){this.points=this.options.points||this.options.point||[];this.greatCirclePoints=[];for(var e=[],c=0;c<this.points.length;c++){var a=this._normalizaCoord(this.points[c]);
a&&e.push(a)}this.points=e};Oa.prototype.setOptions=function(e){this.options=e||{};this._initialize()};Oa.prototype.getPoints=function(){if(0===this.greatCirclePoints.length)for(var e=0;e<this.points.length-1;e++)this._calcGreatCirclePoints(this.points[e],this.points[e+1]);return this.greatCirclePoints};Oa.prototype._normalizaCoord=function(e){if(!e)return null;e instanceof Array&&(e={lng:Number(e[0]),lat:Number(e[1])});var c=ra.convertLL2MC(e);e=ra.convertMC2LL(e);c.latLng=e;return c};Oa.prototype._calcGreatCirclePoints=
function(e,c){var a=e.latLng,b=c.latLng;if(!qc(a.lng,b.lng)||!qc(a.lat,b.lat)){var d=ra.getDistance(fa(a.lng),fa(a.lat),fa(b.lng),fa(b.lat));if(!(25E4>d)){d=Math.round(d/15E4);var f=this._calcAngularDistance(a,b);this.greatCirclePoints.push([e.lng,e.lat]);for(var k=0;k<d;k++){var g=this._calcMiddlePoint(a,b,k/d,f);g=ra.convertLL2MC(g);var h=cd(g,e);30037726<h&&(g.lng=g.lng<e.lng?g.lng+this.WORLD_SIZE_MC:g.lng-this.WORLD_SIZE_MC);this.greatCirclePoints.push([g.lng,g.lat]);e=g}h=cd(c,e);30037726<h&&
(c.lng=c.lng<e.lng?c.lng+this.WORLD_SIZE_MC:c.lng-this.WORLD_SIZE_MC);this.greatCirclePoints.push([c.lng,c.lat])}}};Oa.prototype._calcAngularDistance=function(e,c){var a=fa(e.lat),b=fa(c.lat);e=fa(e.lng);c=fa(c.lng);return Math.acos(Math.sin(a)*Math.sin(b)+Math.cos(a)*Math.cos(b)*Math.cos(Math.abs(c-e)))};Oa.prototype._calcMiddlePoint=function(e,c,a,b){var d=c.lat,f=e.lng;c=c.lng;e=fa(e.lat);d=fa(d);f=fa(f);var k=fa(c);c=Math.sin((1-a)*b)/Math.sin(b);b=Math.sin(a*b)/Math.sin(b);a=c*Math.cos(e)*Math.cos(f)+
b*Math.cos(d)*Math.cos(k);f=c*Math.cos(e)*Math.sin(f)+b*Math.cos(d)*Math.sin(k);e=Math.atan2(c*Math.sin(e)+b*Math.sin(d),Math.sqrt(Math.pow(a,2)+Math.pow(f,2)));return new Ca(nc(Math.atan2(f,a)),nc(e))};var Pc=function(){function e(c){E(this,e);this.options=this.getCommonDefaultOptions();this.options=U(this.options,this.getDefaultOptions());this.autoUpdate=!1;this.options=U(this.options,c);this.options.data&&(this.data=this.options.data)}F(e,[{key:"getCommonDefaultOptions",value:function(){return{}}},
{key:"getDefaultOptions",value:function(){return{}}},{key:"initialize",value:function(c){}},{key:"destroy",value:function(){this.onDestroy&&this.onDestroy()}},{key:"render",value:function(){}},{key:"setData",value:function(c,a){a=a||{};this.data=c;this.onDataChanged&&this.onDataChanged(this.getData());this.onChanged&&this.onChanged(this.getOptions(),this.getData());!1!==a.autoRender&&this.webglLayer&&this.webglLayer.render()}},{key:"getData",value:function(){return this.data||[]}},{key:"setOptions",
value:function(c){c=c||{};var a=U({},this.getOptions());U(this.options,c);this.onOptionsChanged&&this.onOptionsChanged(this.getOptions(),a);this.onChanged&&this.onChanged(this.getOptions(),this.getData());c.data?this.setData(c.data):this.webglLayer&&this.webglLayer.render()}},{key:"getOptions",value:function(){return this.options||{}}},{key:"onOptionsChanged",value:function(c,a){}},{key:"onDataChanged",value:function(c){}},{key:"onChanged",value:function(c,a){}},{key:"onDestroy",value:function(){}},
{key:"lnglatToMercator",value:function(c,a){}},{key:"setWebglLayer",value:function(c){this.webglLayer=c}},{key:"getWebglLayer",value:function(){return this.webglLayer}},{key:"isRequestAnimation",value:function(){return this.autoUpdate}}]);return e}(),Q=function(){function e(c,a,b){E(this,e);this.options=a;this.gl=c;b&&(this.map=b.map);b=this.getVertexShader(a.vertexShader);var d=this.getFragmentShader(a.fragmentShader);a=c.createShader(c.VERTEX_SHADER);c.shaderSource(a,b);c.compileShader(a);c.getShaderParameter(a,
c.COMPILE_STATUS)?(b=c.createShader(c.FRAGMENT_SHADER),c.shaderSource(b,d),c.compileShader(b),c.getShaderParameter(b,c.COMPILE_STATUS)?(d=c.createProgram(),c.attachShader(d,a),c.attachShader(d,b),c.deleteShader(a),c.deleteShader(b),c.linkProgram(d),c.getProgramParameter(d,c.LINK_STATUS)?a=d:(a="Shader program failed to link.  The error log is:"+c.getProgramInfoLog(d),console.error(a),a=-1)):(a="Fragment shader failed to compile.  The error log is:"+c.getShaderInfoLog(b),console.error(a),a=-1)):(a=
"Vertex shader failed to compile.  The error log is:"+c.getShaderInfoLog(a),console.error(a),a=-1);a=this.program=a;b={};d=c.getProgramParameter(a,c.ACTIVE_ATTRIBUTES);for(var f=0;f<d;f++){var k=c.getActiveAttrib(a,f);b[k.name]=c.getAttribLocation(a,k.name)}f={};k={};for(var g=c.getProgramParameter(a,c.ACTIVE_UNIFORMS),h=0;h<g;h++){var m=c.getActiveUniform(a,h);f[m.name]=c.getUniformLocation(a,m.name);k[m.name]=m.type}this.parameter=c={attributes:b,numAttributes:d,uniformsType:k,uniforms:f};this.attributes=
c.attributes;this.uniforms=c.uniforms;this.parameter=c}F(e,[{key:"getVertexShader",value:function(c){var a="";this.map&&"cesium"===this.map.type&&(a="#define LOG_DEPTH\n");a+="#ifdef LOG_DEPTH\nvarying float v_depthFromNearPlusOne;\n#endif\nuniform vec2 MAPV_resolution;\n#if defined(PICK)\nuniform bool uIsPickRender;attribute vec3 aPickColor;uniform vec3 uPickedColor;varying vec4 vPickColor;uniform bool uEnablePicked;bool mapvIsPicked(){return uEnablePicked&&aPickColor==uPickedColor;}\n#endif\nvoid afterMain(){\n#if defined(LOG_DEPTH)\nv_depthFromNearPlusOne=(gl_Position.w-0.1)+1.0;gl_Position.z=clamp(gl_Position.z/gl_Position.w,-1.0,1.0)*gl_Position.w;\n#endif\n#if defined(PICK)\nvPickColor=vec4(aPickColor,0.0);if(mapvIsPicked()){vPickColor.a=1.0;}\n#endif\n}";
c=this.getDefines()+a+c;c=c.replace("void main","void originMain");return c+"void main() {originMain(); afterMain();}"}},{key:"getFragmentShader",value:function(c){var a="";this.map&&"cesium"===this.map.type&&(a="#define LOG_DEPTH\n");a+="#if defined(LOG_DEPTH)\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;uniform vec2 MAPV_resolution;\n#if defined(PICK)\nuniform bool uIsPickRender;varying vec4 vPickColor;bool mapvIsPicked(){return vPickColor.a==1.0;}\n#endif\n#if defined(LOG_DEPTH)\nuniform float oneOverLog2FarDepthFromNearPlusOne;uniform float farDepthFromNearPlusOne;varying float v_depthFromNearPlusOne;void writeLogDepth(float depth){if(depth<=0.9999999||depth>farDepthFromNearPlusOne){discard;}gl_FragDepthEXT=log2(depth)*oneOverLog2FarDepthFromNearPlusOne;}\n#endif\nvoid afterMain(){\n#if defined(PICK)\nif(uIsPickRender){gl_FragColor=vec4(vPickColor.rgb,1.0);return;}\n#endif\n#if defined(LOG_DEPTH)\nwriteLogDepth(v_depthFromNearPlusOne);\n#endif\n}";
c=this.getDefines()+a+c;c=c.replace("void main","void originMain");return c+"void main() {originMain(); afterMain();}"}},{key:"getDefines",value:function(){var c="",a=this.options.defines;if(a)for(var b=0;b<a.length;b++)c+="#define "+a[b]+"\n";return c}},{key:"use",value:function(c,a){this.gl=c;c.useProgram(this.program);this.map&&"cesium"===this.map.type&&this.setUniforms({oneOverLog2FarDepthFromNearPlusOne:this.map.map.scene.context._us._oneOverLog2FarDepthFromNearPlusOne,farDepthFromNearPlusOne:this.map.map.scene.context._us._farDepthFromNearPlusOne});
this.uniforms.MAPV_resolution&&this.setUniforms({MAPV_resolution:[c.canvas.width,c.canvas.height]})}},{key:"setUniform",value:function(c,a){var b=this.gl,d=this.uniforms[c];if(d)switch(this.parameter.uniformsType[c]){case b.FLOAT:b.uniform1f(d,a);break;case b.FLOAT_VEC2:b.uniform2f(d,a[0],a[1]);break;case b.FLOAT_VEC3:b.uniform3f(d,a[0],a[1],a[2]);break;case b.FLOAT_VEC4:b.uniform4f(d,a[0],a[1],a[2],a[3]);break;case b.SAMPLER_2D:case b.SAMPLER_CUBE:b.activeTexture(b["TEXTURE"+this.textureIndex]);
b.uniform1i(d,this.textureIndex);b.bindTexture(b.TEXTURE_2D,a);this.textureIndex++;break;case b.INT:case b.BOOL:b.uniform1i(d,a);break;case b.INT_VEC2:case b.BOOL_VEC2:b.uniform2i(d,a[0],a[1]);break;case b.INT_VEC3:case b.BOOL_VEC3:b.uniform3i(d,a[0],a[1],a[2]);break;case b.INT_VEC4:case b.BOOL_VEC4:b.uniform4i(d,a[0],a[1],a[2],a[3]);break;case b.FLOAT_MAT2:b.uniformMatrix2fv(d,!1,a);break;case b.FLOAT_MAT3:b.uniformMatrix3fv(d,!1,a);break;case b.FLOAT_MAT4:b.uniformMatrix4fv(d,!1,a);break;default:console.error("Unrecognized uniform type: "+
c)}else console.warn("Unrecognized uniform type: "+c)}},{key:"setUniforms",value:function(c){this.textureIndex=0;for(var a in c)this.setUniform(a,c[a])}}]);return e}(),re=function(){function e(c){E(this,e);this.options=c;this.gl=c.gl;this.savedState=[];this.currentState=this.getCurrentState()}F(e,[{key:"setDefaultState",value:function(){this.setState()}},{key:"getDefaultState",value:function(){return{blend:!1,depthTest:!1,cullFace:!1,depthMask:!0,stencilTest:!1}}},{key:"getCurrentState",value:function(){var c=
this.gl;return{blend:c.getParameter(c.BLEND),stencilTest:c.getParameter(c.STENCIL_TEST),depthTest:c.getParameter(c.DEPTH_TEST),cullFace:c.getParameter(c.CULL_FACE),depthMask:c.getParameter(c.DEPTH_WRITEMASK)}}},{key:"save",value:function(){this.savedState.push(this.getCurrentState())}},{key:"restore",value:function(){var c=this.savedState.pop();this.setState(c)}},{key:"setState",value:function(c){var a=this.gl,b=this.getCurrentState();c=U(this.getDefaultState(),c);c.blend!==b.blend&&(c.blend?a.enable(a.BLEND):
a.disable(a.BLEND));c.depthTest!==b.depthTest&&(c.depthTest?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST));c.cullFace!==b.cullFace&&(c.cullFace?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE));c.depthMask!==b.depthMask&&(c.depthMask?a.depthMask(!0):a.depthMask(!1));this.currentState=c}}]);return e}(),L=function(){function e(c){E(this,e);this.options=c;this.gl=c.gl;this.buffer=this.gl.createBuffer();c.data&&this.updateData(c.data)}F(e,[{key:"updateData",value:function(c){var a=this.options,b=this.gl;
this.bind();b.bufferData(b[a.target],c,b[a.usage])}},{key:"bind",value:function(c){c=c||this.gl;c.bindBuffer(c[this.options.target],this.buffer)}},{key:"unBind",value:function(c){c=c||this.gl;c.bindBuffer(c[this.options.target],null)}},{key:"destroy",value:function(){this.buffer=null}}]);return e}(),tg={BYTE:1,UNSIGNED_BYTE:1,SHORT:2,UNSIGNED_SHORT:2,FLOAT:4},sa=function(){function e(c){E(this,e);this.options=c;this.attributes=c.attributes;this.gl=c.gl;this.program=c.program;for(c=this.stride=0;c<
this.attributes.length;c++)this.stride+=tg[this.attributes[c].type]*this.attributes[c].size}F(e,[{key:"setVertexAttribPointers",value:function(){for(var c=this.gl,a=this.program,b=0;b<this.attributes.length;b++){var d=this.attributes[b],e=a.attributes[d.name];void 0!==e&&(d.buffer.bind(c),c.vertexAttribPointer(e,d.size,c[d.type],d.normalize||!1,void 0!==d.stride?d.stride:this.stride,d.offset),c.enableVertexAttribArray(e))}}},{key:"bind",value:function(){this.setVertexAttribPointers()}},{key:"destroy",
value:function(){}}]);return e}(),pa=function d(c,a,b){E(this,d);a=a||c.canvas.width;b=b||c.canvas.height;var f=c.createFramebuffer(),k=c.createTexture();c.bindTexture(c.TEXTURE_2D,k);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,a,b,0,c.RGBA,c.UNSIGNED_BYTE,null);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);f.texture=
k;var g=c.createRenderbuffer();c.bindRenderbuffer(c.RENDERBUFFER,g);c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,a,b);f.depthBuffer=g;c.bindFramebuffer(c.FRAMEBUFFER,f);c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,k,0);c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,g);a=c.checkFramebufferStatus(c.FRAMEBUFFER);c.FRAMEBUFFER_COMPLETE===a&&(c.bindFramebuffer(c.FRAMEBUFFER,null),c.bindTexture(c.TEXTURE_2D,null),c.bindRenderbuffer(c.RENDERBUFFER,
null),this.framebuffer=f)},gc=function(){function c(a){E(this,c);this.options={};U(this.options,a);this.vertex=[-1,1,0,-1,-1,0,1,1,0,1,1,0,-1,-1,0,1,-1,0];this.sampleCoord=[0,1,0,0,1,1,1,1,0,0,1,0]}F(c,[{key:"getOptions",value:function(){return this.options}},{key:"onResize",value:function(a){}},{key:"render",value:function(a){var b=a.gl;a=a.texture;var d=this.programSample;b.useProgram(d.program);var c=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,c);var k=[-1,-1,0,-1,1,0,1,1,0,1,1,0,-1,-1,0,1,-1,
0];b.bufferData(b.ARRAY_BUFFER,new Float32Array(k),b.STATIC_DRAW);b.enableVertexAttribArray(d.attributes.aPos);b.vertexAttribPointer(d.attributes.aPos,3,b.FLOAT,!1,0,0);c=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,c);b.bufferData(b.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,1,1,1,0,0,1,0]),b.STATIC_DRAW);b.enableVertexAttribArray(d.attributes.aTextureCoord);b.vertexAttribPointer(d.attributes.aTextureCoord,2,b.FLOAT,!1,0,0);b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,a);b.uniform1i(d.uniforms.uSampler,
0);b.drawArrays(b.TRIANGLES,0,k.length/3)}}]);return c}(),ug=function(c){function a(b){E(this,a);return M(this,(a.__proto__||I(a)).call(this,b))}G(a,c);F(a,[{key:"getProgram",value:function(a){this.programSample||(this.programSample=new Q(a,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;varying vec2 vTextureCoord;void main(){float fStep=1.0/512.0;vec4 sample11=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample12=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t+1.0*fStep));vec4 sample13=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample21=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t));vec4 sample22=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t));vec4 sample23=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t));vec4 sample31=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 sample32=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t-1.0*fStep));vec4 sample33=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 blurSample=(sample11+sample12+sample13+sample21+2.0*sample22+sample23+sample31+sample32+sample33)/10.0;gl_FragColor=blurSample;}"}),
this.vertexBuffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.sampleBuffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexBuffer.updateData(new Float32Array(this.vertex)),this.sampleBuffer.updateData(new Float32Array(this.sampleCoord)),this.vertexArray=new sa({gl:a,program:this.programSample,attributes:[{stride:12,name:"aPos",buffer:this.vertexBuffer,size:3,type:"FLOAT",offset:0},{stride:8,name:"aTextureCoord",buffer:this.sampleBuffer,size:2,type:"FLOAT",offset:0}]}));
return this.programSample}},{key:"render",value:function(a){var b=a.gl;a=a.texture;b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);var c=this.getProgram(b);c.use(b);this.vertexArray.bind();b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,a);b.uniform1i(c.uniforms.uSampler,1);b.drawArrays(b.TRIANGLES,0,this.vertex.length/3)}}]);return a}(gc),vg=function(c){function a(b){E(this,a);return M(this,(a.__proto__||I(a)).call(this,b))}G(a,c);F(a,[{key:"getProgram",value:function(a){this.programBright||
(this.programBright=new Q(a,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform float threshold;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(uSampler,vTextureCoord);vec4 lightColor=max(vec4(0.0),(color-(1.0-threshold)/5.0));float brightness=dot(color.rgb,vec3(0.2126,0.7152,0.0722));if(brightness>threshold){color=lightColor;}else{color=vec4(0.0);}gl_FragColor=color;}"}));
this.programBloom||(this.programBloom=new Q(a,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform bool isVertical;uniform vec2 canvasSize;uniform float blurSize;uniform float devicePixelRatio;varying vec2 vTextureCoord;void main(){float weight[10];weight[0]=0.2270270270;weight[1]=0.1945945946;weight[2]=0.1216216216;weight[3]=0.1135135135;weight[4]=0.0972972973;weight[5]=0.0608108108;weight[6]=0.0540540541;weight[7]=0.0270270270;weight[8]=0.0162162162;weight[9]=0.0081081081;vec2 offset=vec2(blurSize/canvasSize.x,blurSize/canvasSize.y)*devicePixelRatio;vec4 result=texture2D(uSampler,vTextureCoord)*weight[0];if(isVertical){for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(0.0,offset.y*float(i)))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(0.0,offset.y*float(i)))*weight[i];}}else{for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(offset.x*float(i),0.0))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(offset.x*float(i),0.0))*weight[i];}}gl_FragColor=result;}"}));
this.programResult||(this.programResult=new Q(a,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D originalTexture;uniform sampler2D bloomTexture;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(originalTexture,vTextureCoord);vec4 bloomColor=texture2D(bloomTexture,vTextureCoord);color+=bloomColor;gl_FragColor=color;}"}));
return{programBright:this.programBright,programBloom:this.programBloom,programResult:this.programResult}}},{key:"onResize",value:function(a){this.collectBrightBuffer=new pa(a);this.bloomBuffer=new pa(a)}},{key:"getExtraFbo",value:function(a){this.collectBrightBuffer||(this.collectBrightBuffer=new pa(a));this.bloomBuffer||(this.bloomBuffer=new pa(a));return{collectBrightBuffer:this.collectBrightBuffer.framebuffer,bloomBuffer:this.bloomBuffer.framebuffer}}},{key:"render",value:function(a){var b=a.gl,
c=a.texture;a=a.fbo;var k=this.getOptions();b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);var g=this.getProgram(b),h=g.programBright,m=g.programBloom;g=g.programResult;var n=this.getExtraFbo(b),p=n.collectBrightBuffer;n=n.bloomBuffer;var l=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,l);b.bufferData(b.ARRAY_BUFFER,new Float32Array(this.vertex),b.STATIC_DRAW);b.enableVertexAttribArray(h.attributes.aPos);b.vertexAttribPointer(h.attributes.aPos,3,b.FLOAT,!1,0,0);b.enableVertexAttribArray(m.attributes.aPos);
b.vertexAttribPointer(m.attributes.aPos,3,b.FLOAT,!1,0,0);b.enableVertexAttribArray(g.attributes.aPos);b.vertexAttribPointer(g.attributes.aPos,3,b.FLOAT,!1,0,0);l=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,l);b.bufferData(b.ARRAY_BUFFER,new Float32Array(this.sampleCoord),b.STATIC_DRAW);b.enableVertexAttribArray(h.attributes.aTextureCoord);b.vertexAttribPointer(h.attributes.aTextureCoord,2,b.FLOAT,!1,0,0);b.enableVertexAttribArray(m.attributes.aTextureCoord);b.vertexAttribPointer(m.attributes.aTextureCoord,
2,b.FLOAT,!1,0,0);b.enableVertexAttribArray(g.attributes.aTextureCoord);b.vertexAttribPointer(g.attributes.aTextureCoord,2,b.FLOAT,!1,0,0);b.useProgram(h.program);b.bindFramebuffer(b.FRAMEBUFFER,p);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,c);b.uniform1i(h.uniforms.uSampler,1);b.uniform1f(h.uniforms.threshold,k.threshold||0);b.drawArrays(b.TRIANGLES,0,this.vertex.length/3);b.useProgram(m.program);b.bindFramebuffer(b.FRAMEBUFFER,
n);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,p.texture);b.uniform1i(m.uniforms.uSampler,1);b.uniform1i(m.uniforms.isVertical,!0);b.uniform1f(m.uniforms.blurSize,k.blurSize||2);b.uniform1f(m.uniforms.devicePixelRatio,window.devicePixelRatio);b.uniform2fv(m.uniforms.canvasSize,[b.canvas.width,b.canvas.height]);b.drawArrays(b.TRIANGLES,0,this.vertex.length/3);b.useProgram(m.program);b.bindFramebuffer(b.FRAMEBUFFER,p);b.clearColor(0,
0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,n.texture);b.uniform1i(m.uniforms.uSampler,1);b.uniform1i(m.uniforms.isVertical,!1);b.uniform1f(m.uniforms.blurSize,k.blurSize||2);b.uniform1f(m.uniforms.devicePixelRatio,window.devicePixelRatio);b.uniform2fv(m.uniforms.canvasSize,[b.canvas.width,b.canvas.height]);b.drawArrays(b.TRIANGLES,0,this.vertex.length/3);b.useProgram(g.program);b.bindFramebuffer(b.FRAMEBUFFER,a);b.clearColor(0,0,0,
0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,c);b.uniform1i(g.uniforms.originalTexture,1);b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,p.texture);b.uniform1i(g.uniforms.bloomTexture,0);b.drawArrays(b.TRIANGLES,0,this.vertex.length/3);b.bindBuffer(b.ARRAY_BUFFER,null);b.useProgram(null)}}]);return a}(gc),wg=function(c){function a(b){E(this,a);return M(this,(a.__proto__||I(a)).call(this,b))}G(a,c);F(a,[{key:"getProgram",value:function(a){this.programBright||
(this.programBright=new Q(a,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform float threshold;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(uSampler,vTextureCoord);vec4 lightColor=max(vec4(0.0),(color-threshold));gl_FragColor=lightColor;}"}));this.programBloom||(this.programBloom=new Q(a,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",
fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform bool isVertical;uniform vec2 canvasSize;uniform float blurSize;uniform float devicePixelRatio;varying vec2 vTextureCoord;void main(){float weight[10];weight[0]=0.2270270270;weight[1]=0.1945945946;weight[2]=0.1216216216;weight[3]=0.1135135135;weight[4]=0.0972972973;weight[5]=0.0608108108;weight[6]=0.0540540541;weight[7]=0.0270270270;weight[8]=0.0162162162;weight[9]=0.0081081081;vec2 offset=vec2(blurSize/canvasSize.x,blurSize/canvasSize.y)*devicePixelRatio;vec4 result=texture2D(uSampler,vTextureCoord)*weight[0];if(isVertical){for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(0.0,offset.y*float(i)))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(0.0,offset.y*float(i)))*weight[i];}}else{for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(offset.x*float(i),0.0))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(offset.x*float(i),0.0))*weight[i];}}gl_FragColor=result;}"}));
this.programResult||(this.programResult=new Q(a,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D originalTexture;uniform sampler2D bloomTexture;uniform float toneScale;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(originalTexture,vTextureCoord)*toneScale;vec4 bloomColor=texture2D(bloomTexture,vTextureCoord);color+=bloomColor;gl_FragColor=color;}"}));
return{programBright:this.programBright,programBloom:this.programBloom,programResult:this.programResult}}},{key:"onResize",value:function(a){this.collectBrightBuffer=new pa(a);this.bloomBuffer=new pa(a)}},{key:"getExtraFbo",value:function(a){this.collectBrightBuffer||(this.collectBrightBuffer=new pa(a));this.bloomBuffer||(this.bloomBuffer=new pa(a));return{collectBrightBuffer:this.collectBrightBuffer.framebuffer,bloomBuffer:this.bloomBuffer.framebuffer}}},{key:"render",value:function(a){var b=a.gl,
c=a.texture;a=a.fbo;var k=this.getOptions(),g="clarity"in k?k.clarity:1;g=Math.max(0,g);g=Math.min(1,g);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);var h=this.getProgram(b),m=h.programBright,n=h.programBloom;h=h.programResult;var p=this.getExtraFbo(b),l=p.collectBrightBuffer;p=p.bloomBuffer;var r=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,r);b.bufferData(b.ARRAY_BUFFER,new Float32Array(this.vertex),b.STATIC_DRAW);b.enableVertexAttribArray(m.attributes.aPos);b.vertexAttribPointer(m.attributes.aPos,
3,b.FLOAT,!1,0,0);b.enableVertexAttribArray(n.attributes.aPos);b.vertexAttribPointer(n.attributes.aPos,3,b.FLOAT,!1,0,0);b.enableVertexAttribArray(h.attributes.aPos);b.vertexAttribPointer(h.attributes.aPos,3,b.FLOAT,!1,0,0);r=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,r);b.bufferData(b.ARRAY_BUFFER,new Float32Array(this.sampleCoord),b.STATIC_DRAW);b.enableVertexAttribArray(m.attributes.aTextureCoord);b.vertexAttribPointer(m.attributes.aTextureCoord,2,b.FLOAT,!1,0,0);b.enableVertexAttribArray(n.attributes.aTextureCoord);
b.vertexAttribPointer(n.attributes.aTextureCoord,2,b.FLOAT,!1,0,0);b.enableVertexAttribArray(h.attributes.aTextureCoord);b.vertexAttribPointer(h.attributes.aTextureCoord,2,b.FLOAT,!1,0,0);b.useProgram(m.program);b.bindFramebuffer(b.FRAMEBUFFER,l);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,c);b.uniform1i(m.uniforms.uSampler,1);b.uniform1f(m.uniforms.threshold,k.threshold||0);b.drawArrays(b.TRIANGLES,0,this.vertex.length/
3);b.useProgram(n.program);b.bindFramebuffer(b.FRAMEBUFFER,p);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,l.texture);b.uniform1i(n.uniforms.uSampler,1);b.uniform1i(n.uniforms.isVertical,!0);b.uniform1f(n.uniforms.blurSize,k.blurSize||2);b.uniform1f(n.uniforms.devicePixelRatio,window.devicePixelRatio);b.uniform2fv(n.uniforms.canvasSize,[b.canvas.width,b.canvas.height]);b.drawArrays(b.TRIANGLES,0,this.vertex.length/3);b.useProgram(n.program);
b.bindFramebuffer(b.FRAMEBUFFER,l);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,p.texture);b.uniform1i(n.uniforms.uSampler,1);b.uniform1i(n.uniforms.isVertical,!1);b.uniform1f(n.uniforms.blurSize,k.blurSize||2);b.uniform1f(n.uniforms.devicePixelRatio,window.devicePixelRatio);b.uniform2fv(n.uniforms.canvasSize,[b.canvas.width,b.canvas.height]);b.drawArrays(b.TRIANGLES,0,this.vertex.length/3);b.useProgram(h.program);b.bindFramebuffer(b.FRAMEBUFFER,
a);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,c);b.uniform1i(h.uniforms.originalTexture,1);b.uniform1f(h.uniforms.toneScale,g);b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,l.texture);b.uniform1i(h.uniforms.bloomTexture,0);b.drawArrays(b.TRIANGLES,0,this.vertex.length/3);b.bindBuffer(b.ARRAY_BUFFER,null);b.useProgram(null)}}]);return a}(gc),xg=function(c){function a(b){E(this,a);return M(this,(a.__proto__||I(a)).call(this,
b))}G(a,c);F(a,[{key:"getProgram",value:function(a){this.programSample||(this.programSample=new Q(a,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform vec2 canvasSize;varying vec2 vTextureCoord;void main(){float fStep=1.0/312.0;vec4 sample11=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample12=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t+1.0*fStep));vec4 sample13=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample21=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t));vec4 sample22=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t));vec4 sample23=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t));vec4 sample31=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 sample32=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t-1.0*fStep));vec4 sample33=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 blurSample=(sample11+sample12+sample13+sample21+2.0*sample22+sample23+sample31+sample32+sample33)/10.0;float desX=abs((gl_FragCoord.x-canvasSize.x/2.0)/(canvasSize.x/2.0));float desY=abs((gl_FragCoord.y-canvasSize.y/2.0)/(canvasSize.y/2.0));float factor=max(desX,desY);gl_FragColor=(sample22*(1.0-factor)+blurSample*factor);}"}));
return this.programSample}},{key:"render",value:function(a){var b=a.gl;a=a.texture;var c=this.getProgram(b);b.useProgram(c.program);var k=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,k);b.bufferData(b.ARRAY_BUFFER,new Float32Array(this.vertex),b.STATIC_DRAW);b.enableVertexAttribArray(c.attributes.aPos);b.vertexAttribPointer(c.attributes.aPos,3,b.FLOAT,!1,0,0);k=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,k);b.bufferData(b.ARRAY_BUFFER,new Float32Array(this.sampleCoord),b.STATIC_DRAW);b.enableVertexAttribArray(c.attributes.aTextureCoord);
b.vertexAttribPointer(c.attributes.aTextureCoord,2,b.FLOAT,!1,0,0);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,a);b.uniform1i(c.uniforms.uSampler,1);b.uniform2fv(c.uniforms.canvasSize,[b.canvas.width,b.canvas.height]);b.drawArrays(b.TRIANGLES,0,this.vertex.length/3)}}]);return a}(gc),se=function(){function c(a){E(this,c);this.gl=a;this.effects=[];this.initFbo()}F(c,[{key:"addEffect",value:function(a){this.effects.push(a)}},{key:"removeEffect",value:function(a){}},{key:"setEffects",value:function(a){this.effects=
a}},{key:"onResize",value:function(){this.initFbo();var a=this.gl,b=this.effects;if(b&&1<b.length)for(var d=1;d<b.length;d++){var c=b[d];c.onResize&&c.onResize(a)}}},{key:"initFbo",value:function(){var a=this.gl;this.fbo=[new pa(a),new pa(a)]}},{key:"render",value:function(){var a=this.gl,b=this.effects;if(b&&0<b.length)for(var d={},c=0;c<b.length;c++){var k=this.fbo[c%2].framebuffer;c===b.length-1&&(k=null);a.bindFramebuffer(a.FRAMEBUFFER,k);var g=[0,0,0,0];a.clearColor(g[0],g[1],g[2],g[3]);a.clear(a.COLOR_BUFFER_BIT|
a.DEPTH_BUFFER_BIT);b[c].render({isPickRender:!1,gl:a,texture:d.texture,fbo:k});d=k}}}]);return c}(),da=function(c){function a(b){E(this,a);b=M(this,(a.__proto__||I(a)).call(this,b));b.pickedColor=[-1,-1,-1];return b}G(a,c);F(a,[{key:"getCommonDefaultOptions",value:function(){return{repeat:!1,enablePicked:!1,autoSelect:!0,selectedIndex:-1,selectedColor:"rgba(20, 20, 200, 1.0)"}}},{key:"commonInitialize",value:function(a){var b=this.getOptions();this.gl=a;b.enablePicked&&(this.pickBuffer=new L({gl:a,
target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}))}},{key:"getCommonAttributes",value:function(){var a=[];this.getOptions().enablePicked&&a.push({name:"aPickColor",buffer:this.pickBuffer,size:3,type:"FLOAT",stride:12,offset:0});return a}},{key:"normizedColor",value:function(a){var b=a;a instanceof Array||(b=ba(a).unitArray());void 0===b[3]&&(b[3]=1);return b}},{key:"normizedPoint",value:function(a){if(!a||!a[0]||!a[1])return[0,0,0];var b=this.getPointOffset(),c=Number(a[0]),k=Number(a[1]);-180<=c&&180>=
c&&-90<=k&&90>=k&&(k=this.webglLayer.map.lnglatToMercator(c,k),c=k[0],k=k[1]);var g=Number(a[2])||0;this.webglLayer&&"cesium"===this.webglLayer.options.mapType&&window.Cesium?(c=this.convertLngLat([c,k]),g=window.Cesium.Cartesian3.fromDegrees(c[0],c[1],g),c=g.x,k=g.y,g=g.z):this.webglLayer&&"bmapgl"===this.webglLayer.options.mapType&&"B_EARTH_MAP"===this.webglLayer.map.map.mapType&&(c=this.convertLngLat([c,k]),g=this.webglLayer.map.map.getEarth().scene.fromLatLngToXYZ({lng:c[0],lat:c[1]}),c=g.x,k=
g.y,g=g.z);return 3<a.length?[c-b[0],k-b[1],g].concat(aa(a.slice(3))):[c-b[0],k-b[1],g]}},{key:"convertLngLat",value:function(a){return[a[0]/2.003750834E7*180,180/Math.PI*(2*Math.atan(Math.exp(a[1]/2.003750834E7*180*Math.PI/180))-Math.PI/2)]}},{key:"getPointOffset",value:function(){var a=[0,0],d=this.getOptions();this.webglLayer&&this.webglLayer.options.pointOffset?a=this.webglLayer.options.pointOffset:d.pointOffset&&(a=d.pointOffset);return a}},{key:"indexToRgb",value:function(a){a++;var b=Math.floor(a/
65536);a-=65536*b;var c=Math.floor(a/256);return[a-256*c,c,b]}},{key:"rgbToIndex",value:function(a){return a[0]+256*a[1]+65536*a[2]-1}},{key:"getCommonUniforms",value:function(a){a=a.isPickRender;var b=this.getOptions(),c={};if(b.enablePicked){var k=b.autoSelect?this.pickedColor:this.indexToRgb(b.selectedIndex||-1);c=U(c,{uSelectedColor:this.normizedColor(b.selectedColor),uEnablePicked:b.enablePicked,uPickedColor:k.map(function(a){return a/255}),uIsPickRender:!!a})}return c}},{key:"pick",value:function(a,
c){var b=this.gl;this.webglLayer.saveFramebuffer();this.webglLayer.bindFramebuffer(this.webglLayer.pickFBO);this.webglLayer.clear();this.render({gl:b,isPickRender:!0,matrix:this.webglLayer.matrix,projectionMatrix:this.webglLayer.projectionMatrix,viewMatrix:this.webglLayer.viewMatrix,orthoMatrix:this.webglLayer.orthoMatrix});var d=new Uint8Array(4);b.readPixels(a*window.devicePixelRatio,b.canvas.height-c*window.devicePixelRatio,1,1,b.RGBA,b.UNSIGNED_BYTE,d);a=this.rgbToIndex(d);this.pickedColor=[d[0],
d[1],d[2]];this.webglLayer.restoreFramebuffer();return{dataIndex:a,dataItem:this.data[a]}}},{key:"setGLState",value:function(a){this.webglLayer.stateManager.setState(a)}},{key:"addMultipleCoords",value:function(a,d,c){if(!this.options.repeat||!this.webglLayer||"bmapgl"!==this.webglLayer.options.mapType||"B_EARTH_MAP"===this.webglLayer.map.map.mapType)return[a];var b=this.webglLayer.map.map;d=d||b.getZoom();var g=c?b.worldSize(d):4.007545274461451E7;d=function(a){return[[a[0]-g,a[1],a[2]||0],[a[0]+
g,a[1],a[2]||0]]};if(a instanceof Array&&!(a[0]instanceof Array))return d=d(a),d=Fb(d,2),[a,d[0],d[1]];c=[];b=[];for(var h=0;h<a.length;h++){var m=d(a[h]);m=Fb(m,2);var f=m[1];c.push(m[0]);b.push(f)}return[a,c,b]}}]);return a}(Pc),Ba=H(function(c,a){Object.defineProperty(a,"__esModule",{value:!0});a.setMatrixArrayType=function(b){a.ARRAY_TYPE=d=b};a.toRadian=function(a){return a*f};a.equals=function(a,c){return Math.abs(a-c)<=b*Math.max(1,Math.abs(a),Math.abs(c))};a.RANDOM=a.ARRAY_TYPE=a.EPSILON=
void 0;var b=1E-6;a.EPSILON=b;var d="undefined"!==typeof Float32Array?Float32Array:Array;a.ARRAY_TYPE=d;a.RANDOM=Math.random;var f=Math.PI/180});K(Ba);var te=H(function(c,a){function b(a,b,c){var d=b[0],h=b[1],k=b[2];b=b[3];var l=c[0],g=c[1],f=c[2];c=c[3];a[0]=d*l+k*g;a[1]=h*l+b*g;a[2]=d*f+k*c;a[3]=h*f+b*c;return a}function d(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];return a}Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){var a=new f.ARRAY_TYPE(4);f.ARRAY_TYPE!=
Float32Array&&(a[1]=0,a[2]=0);a[0]=1;a[3]=1;return a};a.clone=function(a){var b=new f.ARRAY_TYPE(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a};a.fromValues=function(a,b,c,d){var h=new f.ARRAY_TYPE(4);h[0]=a;h[1]=b;h[2]=c;h[3]=d;return h};a.set=function(a,b,c,d,f){a[0]=b;a[1]=c;a[2]=d;a[3]=f;return a};a.transpose=function(a,b){if(a===b){var c=b[1];a[1]=b[2];a[2]=
c}else a[0]=b[0],a[1]=b[2],a[2]=b[1],a[3]=b[3];return a};a.invert=function(a,b){var c=b[0],d=b[1],k=b[2];b=b[3];var g=c*b-k*d;if(!g)return null;g=1/g;a[0]=b*g;a[1]=-d*g;a[2]=-k*g;a[3]=c*g;return a};a.adjoint=function(a,b){var c=b[0];a[0]=b[3];a[1]=-b[1];a[2]=-b[2];a[3]=c;return a};a.determinant=function(a){return a[0]*a[3]-a[2]*a[1]};a.multiply=b;a.rotate=function(a,b,c){var d=b[0],h=b[1],k=b[2];b=b[3];var l=Math.sin(c);c=Math.cos(c);a[0]=d*c+k*l;a[1]=h*c+b*l;a[2]=d*-l+k*c;a[3]=h*-l+b*c;return a};
a.scale=function(a,b,c){var d=b[1],h=b[2],k=b[3],l=c[0];c=c[1];a[0]=b[0]*l;a[1]=d*l;a[2]=h*c;a[3]=k*c;return a};a.fromRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=c;a[2]=-c;a[3]=b;return a};a.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=b[1];return a};a.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))};a.LDU=function(a,b,c,d){a[2]=d[2]/d[0];
c[0]=d[0];c[1]=d[1];c[3]=d[3]-a[2]*c[1];return[a,b,c]};a.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];return a};a.subtract=d;a.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]};a.equals=function(a,b){var c=a[0],d=a[1],k=a[2];a=a[3];var g=b[0],l=b[1],r=b[2];b=b[3];return Math.abs(c-g)<=f.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(d-l)<=f.EPSILON*Math.max(1,Math.abs(d),Math.abs(l))&&Math.abs(k-r)<=f.EPSILON*Math.max(1,
Math.abs(k),Math.abs(r))&&Math.abs(a-b)<=f.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};a.multiplyScalar=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;return a};a.multiplyScalarAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;a[3]=b[3]+c[3]*d;return a};a.sub=a.mul=void 0;var f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Z&&Y?Y(a,c):{};d.get||d.set?Z(b,c,d):b[c]=a[c]}b.default=
a;return b}(Ba);a.mul=b;a.sub=d});K(te);var ue=H(function(c,a){function b(a,b,c){var d=b[0],h=b[1],k=b[2],l=b[3],f=b[4];b=b[5];var g=c[0],t=c[1],S=c[2],N=c[3],x=c[4];c=c[5];a[0]=d*g+k*t;a[1]=h*g+l*t;a[2]=d*S+k*N;a[3]=h*S+l*N;a[4]=d*x+k*c+f;a[5]=h*x+l*c+b;return a}function d(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];a[4]=b[4]-c[4];a[5]=b[5]-c[5];return a}Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){var a=new f.ARRAY_TYPE(6);f.ARRAY_TYPE!=Float32Array&&
(a[1]=0,a[2]=0,a[4]=0,a[5]=0);a[0]=1;a[3]=1;return a};a.clone=function(a){var b=new f.ARRAY_TYPE(6);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];return b};a.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a};a.fromValues=function(a,b,c,d,n,p){var h=new f.ARRAY_TYPE(6);h[0]=a;h[1]=b;h[2]=c;h[3]=d;h[4]=n;h[5]=p;return h};a.set=function(a,b,c,d,f,p,l){a[0]=b;a[1]=c;a[2]=d;a[3]=
f;a[4]=p;a[5]=l;return a};a.invert=function(a,b){var c=b[0],d=b[1],k=b[2],f=b[3],l=b[4];b=b[5];var g=c*f-d*k;if(!g)return null;g=1/g;a[0]=f*g;a[1]=-d*g;a[2]=-k*g;a[3]=c*g;a[4]=(k*b-f*l)*g;a[5]=(d*l-c*b)*g;return a};a.determinant=function(a){return a[0]*a[3]-a[1]*a[2]};a.multiply=b;a.rotate=function(a,b,c){var d=b[0],h=b[1],k=b[2],l=b[3],f=b[4];b=b[5];var g=Math.sin(c);c=Math.cos(c);a[0]=d*c+k*g;a[1]=h*c+l*g;a[2]=d*-g+k*c;a[3]=h*-g+l*c;a[4]=f;a[5]=b;return a};a.scale=function(a,b,c){var d=b[1],h=b[2],
k=b[3],l=b[4],f=b[5],g=c[0];c=c[1];a[0]=b[0]*g;a[1]=d*g;a[2]=h*c;a[3]=k*c;a[4]=l;a[5]=f;return a};a.translate=function(a,b,c){var d=b[0],h=b[1],k=b[2],l=b[3],f=b[4];b=b[5];var g=c[0];c=c[1];a[0]=d;a[1]=h;a[2]=k;a[3]=l;a[4]=d*g+k*c+f;a[5]=h*g+l*c+b;return a};a.fromRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=c;a[2]=-c;a[3]=b;a[4]=0;a[5]=0;return a};a.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=b[1];a[4]=0;a[5]=0;return a};a.fromTranslation=function(a,b){a[0]=1;a[1]=
0;a[2]=0;a[3]=1;a[4]=b[0];a[5]=b[1];return a};a.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)};a.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];a[4]=b[4]+c[4];a[5]=b[5]+c[5];return a};a.subtract=d;a.multiplyScalar=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=
b[4]*c;a[5]=b[5]*c;return a};a.multiplyScalarAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;a[3]=b[3]+c[3]*d;a[4]=b[4]+c[4]*d;a[5]=b[5]+c[5]*d;return a};a.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]};a.equals=function(a,b){var c=a[0],d=a[1],k=a[2],g=a[3],l=a[4];a=a[5];var r=b[0],q=b[1],t=b[2],S=b[3],N=b[4];b=b[5];return Math.abs(c-r)<=f.EPSILON*Math.max(1,Math.abs(c),Math.abs(r))&&Math.abs(d-q)<=f.EPSILON*
Math.max(1,Math.abs(d),Math.abs(q))&&Math.abs(k-t)<=f.EPSILON*Math.max(1,Math.abs(k),Math.abs(t))&&Math.abs(g-S)<=f.EPSILON*Math.max(1,Math.abs(g),Math.abs(S))&&Math.abs(l-N)<=f.EPSILON*Math.max(1,Math.abs(l),Math.abs(N))&&Math.abs(a-b)<=f.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};a.sub=a.mul=void 0;var f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Z&&Y?Y(a,c):{};d.get||d.set?Z(b,c,d):b[c]=a[c]}b.default=a;return b}(Ba);
a.mul=b;a.sub=d});K(ue);var Qc=H(function(c,a){function b(a,b,c){var d=b[0],h=b[1],f=b[2],l=b[3],k=b[4],g=b[5],t=b[6],S=b[7];b=b[8];var N=c[0],x=c[1],u=c[2],A=c[3],y=c[4],z=c[5],B=c[6],C=c[7];c=c[8];a[0]=N*d+x*l+u*t;a[1]=N*h+x*k+u*S;a[2]=N*f+x*g+u*b;a[3]=A*d+y*l+z*t;a[4]=A*h+y*k+z*S;a[5]=A*f+y*g+z*b;a[6]=B*d+C*l+c*t;a[7]=B*h+C*k+c*S;a[8]=B*f+C*g+c*b;return a}function d(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];a[4]=b[4]-c[4];a[5]=b[5]-c[5];a[6]=b[6]-c[6];a[7]=b[7]-c[7];a[8]=
b[8]-c[8];return a}Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){var a=new f.ARRAY_TYPE(9);f.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0);a[0]=1;a[4]=1;a[8]=1;return a};a.fromMat4=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[4];a[4]=b[5];a[5]=b[6];a[6]=b[8];a[7]=b[9];a[8]=b[10];return a};a.clone=function(a){var b=new f.ARRAY_TYPE(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.copy=function(a,
b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a};a.fromValues=function(a,b,c,d,n,p,l,r,q){var h=new f.ARRAY_TYPE(9);h[0]=a;h[1]=b;h[2]=c;h[3]=d;h[4]=n;h[5]=p;h[6]=l;h[7]=r;h[8]=q;return h};a.set=function(a,b,c,d,f,p,l,r,q,t){a[0]=b;a[1]=c;a[2]=d;a[3]=f;a[4]=p;a[5]=l;a[6]=r;a[7]=q;a[8]=t;return a};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],
f=b[5];a[1]=b[3];a[2]=b[6];a[3]=c;a[5]=b[7];a[6]=d;a[7]=f}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a};a.invert=function(a,b){var c=b[0],d=b[1],f=b[2],k=b[3],l=b[4],r=b[5],g=b[6],t=b[7];b=b[8];var S=b*l-r*t,N=-b*k+r*g,x=t*k-l*g,u=c*S+d*N+f*x;if(!u)return null;u=1/u;a[0]=S*u;a[1]=(-b*d+f*t)*u;a[2]=(r*d-f*l)*u;a[3]=N*u;a[4]=(b*c-f*g)*u;a[5]=(-r*c+f*k)*u;a[6]=x*u;a[7]=(-t*c+d*g)*u;a[8]=(l*c-d*k)*u;return a};a.adjoint=function(a,b){var c=b[0],
d=b[1],f=b[2],k=b[3],l=b[4],r=b[5],g=b[6],t=b[7];b=b[8];a[0]=l*b-r*t;a[1]=f*t-d*b;a[2]=d*r-f*l;a[3]=r*g-k*b;a[4]=c*b-f*g;a[5]=f*k-c*r;a[6]=k*t-l*g;a[7]=d*g-c*t;a[8]=c*l-d*k;return a};a.determinant=function(a){var b=a[3],c=a[4],d=a[5],f=a[6],k=a[7],l=a[8];return a[0]*(l*c-d*k)+a[1]*(-l*b+d*f)+a[2]*(k*b-c*f)};a.multiply=b;a.translate=function(a,b,c){var d=b[0],h=b[1],f=b[2],l=b[3],r=b[4],k=b[5],t=b[6],g=b[7];b=b[8];var N=c[0];c=c[1];a[0]=d;a[1]=h;a[2]=f;a[3]=l;a[4]=r;a[5]=k;a[6]=N*d+c*l+t;a[7]=N*h+
c*r+g;a[8]=N*f+c*k+b;return a};a.rotate=function(a,b,c){var d=b[0],h=b[1],f=b[2],l=b[3],r=b[4],k=b[5],t=b[6],g=b[7];b=b[8];var N=Math.sin(c);c=Math.cos(c);a[0]=c*d+N*l;a[1]=c*h+N*r;a[2]=c*f+N*k;a[3]=c*l-N*d;a[4]=c*r-N*h;a[5]=c*k-N*f;a[6]=t;a[7]=g;a[8]=b;return a};a.scale=function(a,b,c){var d=c[0];c=c[1];a[0]=d*b[0];a[1]=d*b[1];a[2]=d*b[2];a[3]=c*b[3];a[4]=c*b[4];a[5]=c*b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a};a.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=b[0];
a[7]=b[1];a[8]=1;return a};a.fromRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=c;a[2]=0;a[3]=-c;a[4]=b;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=b[1];a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat2d=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=0;a[3]=b[2];a[4]=b[3];a[5]=0;a[6]=b[4];a[7]=b[5];a[8]=1;return a};a.fromQuat=function(a,b){var c=b[0],d=b[1],f=b[2];b=b[3];var g=c+c,l=d+d,r=f+f;c*=g;var q=d*g;d*=l;var t=f*g,k=f*l;
f*=r;g*=b;l*=b;b*=r;a[0]=1-d-f;a[3]=q-b;a[6]=t+l;a[1]=q+b;a[4]=1-c-f;a[7]=k-g;a[2]=t-l;a[5]=k+g;a[8]=1-c-d;return a};a.normalFromMat4=function(a,b){var c=b[0],d=b[1],f=b[2],k=b[3],l=b[4],r=b[5],q=b[6],t=b[7],g=b[8],N=b[9],x=b[10],u=b[11],A=b[12],y=b[13],z=b[14];b=b[15];var B=c*r-d*l,C=c*q-f*l,J=c*t-k*l,D=d*q-f*r,v=d*t-k*r,P=f*t-k*q,w=g*y-N*A,E=g*z-x*A;g=g*b-u*A;var F=N*z-x*y;N=N*b-u*y;x=x*b-u*z;u=B*x-C*N+J*F+D*g-v*E+P*w;if(!u)return null;u=1/u;a[0]=(r*x-q*N+t*F)*u;a[1]=(q*g-l*x-t*E)*u;a[2]=(l*N-r*
g+t*w)*u;a[3]=(f*N-d*x-k*F)*u;a[4]=(c*x-f*g+k*E)*u;a[5]=(d*g-c*N-k*w)*u;a[6]=(y*P-z*v+b*D)*u;a[7]=(z*J-A*P-b*C)*u;a[8]=(A*v-y*J+b*B)*u;return a};a.projection=function(a,b,c){a[0]=2/b;a[1]=0;a[2]=0;a[3]=0;a[4]=-2/c;a[5]=0;a[6]=-1;a[7]=1;a[8]=1;return a};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],
2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};a.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];a[4]=b[4]+c[4];a[5]=b[5]+c[5];a[6]=b[6]+c[6];a[7]=b[7]+c[7];a[8]=b[8]+c[8];return a};a.subtract=d;a.multiplyScalar=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;a[8]=b[8]*c;return a};a.multiplyScalarAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;a[3]=b[3]+c[3]*d;a[4]=
b[4]+c[4]*d;a[5]=b[5]+c[5]*d;a[6]=b[6]+c[6]*d;a[7]=b[7]+c[7]*d;a[8]=b[8]+c[8]*d;return a};a.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]};a.equals=function(a,b){var c=a[0],d=a[1],g=a[2],k=a[3],l=a[4],r=a[5],q=a[6],t=a[7];a=a[8];var S=b[0],N=b[1],x=b[2],u=b[3],A=b[4],y=b[5],z=b[6],B=b[7];b=b[8];return Math.abs(c-S)<=f.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(d-N)<=f.EPSILON*Math.max(1,
Math.abs(d),Math.abs(N))&&Math.abs(g-x)<=f.EPSILON*Math.max(1,Math.abs(g),Math.abs(x))&&Math.abs(k-u)<=f.EPSILON*Math.max(1,Math.abs(k),Math.abs(u))&&Math.abs(l-A)<=f.EPSILON*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(r-y)<=f.EPSILON*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(q-z)<=f.EPSILON*Math.max(1,Math.abs(q),Math.abs(z))&&Math.abs(t-B)<=f.EPSILON*Math.max(1,Math.abs(t),Math.abs(B))&&Math.abs(a-b)<=f.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};a.sub=a.mul=void 0;var f=function(a){if(a&&
a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Z&&Y?Y(a,c):{};d.get||d.set?Z(b,c,d):b[c]=a[c]}b.default=a;return b}(Ba);a.mul=b;a.sub=d});K(Qc);var Rc=H(function(c,a){function b(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}function d(a,b,c){var d=b[0],h=b[1],f=b[2],m=b[3],t=b[4],g=b[5],k=b[6],n=b[7],u=b[8],A=b[9],y=b[10],z=b[11],B=b[12],C=b[13],J=b[14];
b=b[15];var D=c[0],v=c[1],P=c[2],w=c[3];a[0]=D*d+v*t+P*u+w*B;a[1]=D*h+v*g+P*A+w*C;a[2]=D*f+v*k+P*y+w*J;a[3]=D*m+v*n+P*z+w*b;D=c[4];v=c[5];P=c[6];w=c[7];a[4]=D*d+v*t+P*u+w*B;a[5]=D*h+v*g+P*A+w*C;a[6]=D*f+v*k+P*y+w*J;a[7]=D*m+v*n+P*z+w*b;D=c[8];v=c[9];P=c[10];w=c[11];a[8]=D*d+v*t+P*u+w*B;a[9]=D*h+v*g+P*A+w*C;a[10]=D*f+v*k+P*y+w*J;a[11]=D*m+v*n+P*z+w*b;D=c[12];v=c[13];P=c[14];w=c[15];a[12]=D*d+v*t+P*u+w*B;a[13]=D*h+v*g+P*A+w*C;a[14]=D*f+v*k+P*y+w*J;a[15]=D*m+v*n+P*z+w*b;return a}function f(a,b,c){var d=
b[0],h=b[1],f=b[2],m=b[3],t=d+d,g=h+h,k=f+f;b=d*t;var n=d*g;d*=k;var u=h*g;h*=k;f*=k;t*=m;g*=m;m*=k;a[0]=1-(u+f);a[1]=n+m;a[2]=d-g;a[3]=0;a[4]=n-m;a[5]=1-(b+f);a[6]=h+t;a[7]=0;a[8]=d+g;a[9]=h-t;a[10]=1-(b+u);a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a}function k(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];a[4]=b[4]-c[4];a[5]=b[5]-c[5];a[6]=b[6]-c[6];a[7]=b[7]-c[7];a[8]=b[8]-c[8];a[9]=b[9]-c[9];a[10]=b[10]-c[10];a[11]=b[11]-c[11];a[12]=b[12]-c[12];a[13]=b[13]-c[13];
a[14]=b[14]-c[14];a[15]=b[15]-c[15];return a}Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){var a=new g.ARRAY_TYPE(16);g.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0);a[0]=1;a[5]=1;a[10]=1;a[15]=1;return a};a.clone=function(a){var b=new g.ARRAY_TYPE(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];
b[15]=a[15];return b};a.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};a.fromValues=function(a,b,c,d,l,f,q,t,k,N,x,u,A,y,z,B){var h=new g.ARRAY_TYPE(16);h[0]=a;h[1]=b;h[2]=c;h[3]=d;h[4]=l;h[5]=f;h[6]=q;h[7]=t;h[8]=k;h[9]=N;h[10]=x;h[11]=u;h[12]=A;h[13]=y;h[14]=z;h[15]=B;return h};a.set=function(a,b,c,d,l,f,q,t,g,k,x,u,A,y,z,B,C){a[0]=b;a[1]=c;a[2]=
d;a[3]=l;a[4]=f;a[5]=q;a[6]=t;a[7]=g;a[8]=k;a[9]=x;a[10]=u;a[11]=A;a[12]=y;a[13]=z;a[14]=B;a[15]=C;return a};a.identity=b;a.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],h=b[3],f=b[6],m=b[7],t=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=c;a[6]=b[9];a[7]=b[13];a[8]=d;a[9]=f;a[11]=b[14];a[12]=h;a[13]=m;a[14]=t}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a};
a.invert=function(a,b){var c=b[0],d=b[1],h=b[2],f=b[3],m=b[4],t=b[5],g=b[6],k=b[7],x=b[8],u=b[9],A=b[10],y=b[11],z=b[12],B=b[13],C=b[14];b=b[15];var J=c*t-d*m,D=c*g-h*m,v=c*k-f*m,P=d*g-h*t,w=d*k-f*t,E=h*k-f*g,F=x*B-u*z,H=x*C-A*z,I=x*b-y*z,K=u*C-A*B,L=u*b-y*B,M=A*b-y*C,G=J*M-D*L+v*K+P*I-w*H+E*F;if(!G)return null;G=1/G;a[0]=(t*M-g*L+k*K)*G;a[1]=(h*L-d*M-f*K)*G;a[2]=(B*E-C*w+b*P)*G;a[3]=(A*w-u*E-y*P)*G;a[4]=(g*I-m*M-k*H)*G;a[5]=(c*M-h*I+f*H)*G;a[6]=(C*v-z*E-b*D)*G;a[7]=(x*E-A*v+y*D)*G;a[8]=(m*L-t*I+
k*F)*G;a[9]=(d*I-c*L-f*F)*G;a[10]=(z*w-B*v+b*J)*G;a[11]=(u*v-x*w-y*J)*G;a[12]=(t*H-m*K-g*F)*G;a[13]=(c*K-d*H+h*F)*G;a[14]=(B*D-z*P-C*J)*G;a[15]=(x*P-u*D+A*J)*G;return a};a.adjoint=function(a,b){var c=b[0],d=b[1],h=b[2],f=b[3],q=b[4],t=b[5],m=b[6],g=b[7],k=b[8],u=b[9],A=b[10],y=b[11],z=b[12],B=b[13],C=b[14];b=b[15];a[0]=t*(A*b-y*C)-u*(m*b-g*C)+B*(m*y-g*A);a[1]=-(d*(A*b-y*C)-u*(h*b-f*C)+B*(h*y-f*A));a[2]=d*(m*b-g*C)-t*(h*b-f*C)+B*(h*g-f*m);a[3]=-(d*(m*y-g*A)-t*(h*y-f*A)+u*(h*g-f*m));a[4]=-(q*(A*b-y*
C)-k*(m*b-g*C)+z*(m*y-g*A));a[5]=c*(A*b-y*C)-k*(h*b-f*C)+z*(h*y-f*A);a[6]=-(c*(m*b-g*C)-q*(h*b-f*C)+z*(h*g-f*m));a[7]=c*(m*y-g*A)-q*(h*y-f*A)+k*(h*g-f*m);a[8]=q*(u*b-y*B)-k*(t*b-g*B)+z*(t*y-g*u);a[9]=-(c*(u*b-y*B)-k*(d*b-f*B)+z*(d*y-f*u));a[10]=c*(t*b-g*B)-q*(d*b-f*B)+z*(d*g-f*t);a[11]=-(c*(t*y-g*u)-q*(d*y-f*u)+k*(d*g-f*t));a[12]=-(q*(u*C-A*B)-k*(t*C-m*B)+z*(t*A-m*u));a[13]=c*(u*C-A*B)-k*(d*C-h*B)+z*(d*A-h*u);a[14]=-(c*(t*C-m*B)-q*(d*C-h*B)+z*(d*m-h*t));a[15]=c*(t*A-m*u)-q*(d*A-h*u)+k*(d*m-h*t);return a};
a.determinant=function(a){var b=a[0],c=a[1],d=a[2],h=a[3],f=a[4],q=a[5],t=a[6],g=a[7],k=a[8],x=a[9],u=a[10],A=a[11],y=a[12],z=a[13],B=a[14];a=a[15];return(b*q-c*f)*(u*a-A*B)-(b*t-d*f)*(x*a-A*z)+(b*g-h*f)*(x*B-u*z)+(c*t-d*q)*(k*a-A*y)-(c*g-h*q)*(k*B-u*y)+(d*g-h*t)*(k*z-x*y)};a.multiply=d;a.translate=function(a,b,c){var d=c[0],h=c[1];c=c[2];if(b===a)a[12]=b[0]*d+b[4]*h+b[8]*c+b[12],a[13]=b[1]*d+b[5]*h+b[9]*c+b[13],a[14]=b[2]*d+b[6]*h+b[10]*c+b[14],a[15]=b[3]*d+b[7]*h+b[11]*c+b[15];else{var f=b[0];var q=
b[1];var t=b[2];var m=b[3];var g=b[4];var k=b[5];var u=b[6];var n=b[7];var y=b[8];var z=b[9];var B=b[10];var C=b[11];a[0]=f;a[1]=q;a[2]=t;a[3]=m;a[4]=g;a[5]=k;a[6]=u;a[7]=n;a[8]=y;a[9]=z;a[10]=B;a[11]=C;a[12]=f*d+g*h+y*c+b[12];a[13]=q*d+k*h+z*c+b[13];a[14]=t*d+u*h+B*c+b[14];a[15]=m*d+n*h+C*c+b[15]}return a};a.scale=function(a,b,c){var d=c[0],h=c[1];c=c[2];a[0]=b[0]*d;a[1]=b[1]*d;a[2]=b[2]*d;a[3]=b[3]*d;a[4]=b[4]*h;a[5]=b[5]*h;a[6]=b[6]*h;a[7]=b[7]*h;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*
c;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};a.rotate=function(a,b,c,d){var h=d[0],f=d[1];d=d[2];var q=Math.sqrt(h*h+f*f+d*d);if(q<g.EPSILON)return null;q=1/q;h*=q;f*=q;d*=q;var t=Math.sin(c);var m=Math.cos(c);var k=1-m;c=b[0];q=b[1];var n=b[2];var u=b[3];var p=b[4];var y=b[5];var z=b[6];var B=b[7];var C=b[8];var J=b[9];var D=b[10];var v=b[11];var P=h*h*k+m;var w=f*h*k+d*t;var E=d*h*k-f*t;var F=h*f*k-d*t;var G=f*f*k+m;var H=d*f*k+h*t;var I=h*d*k+f*t;h=f*d*k-h*t;f=d*d*k+m;a[0]=c*P+p*
w+C*E;a[1]=q*P+y*w+J*E;a[2]=n*P+z*w+D*E;a[3]=u*P+B*w+v*E;a[4]=c*F+p*G+C*H;a[5]=q*F+y*G+J*H;a[6]=n*F+z*G+D*H;a[7]=u*F+B*G+v*H;a[8]=c*I+p*h+C*f;a[9]=q*I+y*h+J*f;a[10]=n*I+z*h+D*f;a[11]=u*I+B*h+v*f;b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);return a};a.rotateX=function(a,b,c){var d=Math.sin(c);c=Math.cos(c);var h=b[4],f=b[5],q=b[6],t=b[7],g=b[8],k=b[9],m=b[10],u=b[11];b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[4]=h*c+g*d;a[5]=f*c+
k*d;a[6]=q*c+m*d;a[7]=t*c+u*d;a[8]=g*c-h*d;a[9]=k*c-f*d;a[10]=m*c-q*d;a[11]=u*c-t*d;return a};a.rotateY=function(a,b,c){var d=Math.sin(c);c=Math.cos(c);var h=b[0],f=b[1],q=b[2],t=b[3],g=b[8],k=b[9],m=b[10],u=b[11];b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=h*c-g*d;a[1]=f*c-k*d;a[2]=q*c-m*d;a[3]=t*c-u*d;a[8]=h*d+g*c;a[9]=f*d+k*c;a[10]=q*d+m*c;a[11]=t*d+u*c;return a};a.rotateZ=function(a,b,c){var d=Math.sin(c);c=Math.cos(c);var f=b[0],h=b[1],
q=b[2],t=b[3],g=b[4],k=b[5],m=b[6],u=b[7];b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=f*c+g*d;a[1]=h*c+k*d;a[2]=q*c+m*d;a[3]=t*c+u*d;a[4]=g*c-f*d;a[5]=k*c-h*d;a[6]=m*c-q*d;a[7]=u*c-t*d;return a};a.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};a.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b[1];
a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=b[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.fromRotation=function(a,b,c){var d=c[0],f=c[1];c=c[2];var h=Math.sqrt(d*d+f*f+c*c);if(h<g.EPSILON)return null;h=1/h;d*=h;f*=h;c*=h;h=Math.sin(b);b=Math.cos(b);var q=1-b;a[0]=d*d*q+b;a[1]=f*d*q+c*h;a[2]=c*d*q-f*h;a[3]=0;a[4]=d*f*q-c*h;a[5]=f*f*q+b;a[6]=c*f*q+d*h;a[7]=0;a[8]=d*c*q+f*h;a[9]=f*c*q-d*h;a[10]=c*c*q+b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.fromXRotation=function(a,b){var c=Math.sin(b);
b=Math.cos(b);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=c;a[7]=0;a[8]=0;a[9]=-c;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.fromYRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=0;a[2]=-c;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=c;a[9]=0;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.fromZRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=c;a[2]=0;a[3]=0;a[4]=-c;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=
0;a[15]=1;return a};a.fromRotationTranslation=f;a.fromQuat2=function(a,b){var c=new g.ARRAY_TYPE(3),d=-b[0],l=-b[1],h=-b[2],q=b[3],t=b[4],k=b[5],m=b[6],x=b[7],u=d*d+l*l+h*h+q*q;0<u?(c[0]=2*(t*q+x*d+k*h-m*l)/u,c[1]=2*(k*q+x*l+m*d-t*h)/u,c[2]=2*(m*q+x*h+t*l-k*d)/u):(c[0]=2*(t*q+x*d+k*h-m*l),c[1]=2*(k*q+x*l+m*d-t*h),c[2]=2*(m*q+x*h+t*l-k*d));f(a,b,c);return a};a.getTranslation=function(a,b){a[0]=b[12];a[1]=b[13];a[2]=b[14];return a};a.getScaling=function(a,b){var c=b[0],d=b[1],f=b[2],h=b[4],q=b[5],t=
b[6],g=b[8],k=b[9];b=b[10];a[0]=Math.sqrt(c*c+d*d+f*f);a[1]=Math.sqrt(h*h+q*q+t*t);a[2]=Math.sqrt(g*g+k*k+b*b);return a};a.getRotation=function(a,b){var c=b[0]+b[5]+b[10];0<c?(c=2*Math.sqrt(c+1),a[3]=.25*c,a[0]=(b[6]-b[9])/c,a[1]=(b[8]-b[2])/c,a[2]=(b[1]-b[4])/c):b[0]>b[5]&&b[0]>b[10]?(c=2*Math.sqrt(1+b[0]-b[5]-b[10]),a[3]=(b[6]-b[9])/c,a[0]=.25*c,a[1]=(b[1]+b[4])/c,a[2]=(b[8]+b[2])/c):b[5]>b[10]?(c=2*Math.sqrt(1+b[5]-b[0]-b[10]),a[3]=(b[8]-b[2])/c,a[0]=(b[1]+b[4])/c,a[1]=.25*c,a[2]=(b[6]+b[9])/c):
(c=2*Math.sqrt(1+b[10]-b[0]-b[5]),a[3]=(b[1]-b[4])/c,a[0]=(b[8]+b[2])/c,a[1]=(b[6]+b[9])/c,a[2]=.25*c);return a};a.fromRotationTranslationScale=function(a,b,c,d){var f=b[0],h=b[1],q=b[2],t=b[3],g=f+f,k=h+h,m=q+q;b=f*g;var u=f*k;f*=m;var n=h*k;h*=m;q*=m;g*=t;k*=t;t*=m;m=d[0];var p=d[1];d=d[2];a[0]=(1-(n+q))*m;a[1]=(u+t)*m;a[2]=(f-k)*m;a[3]=0;a[4]=(u-t)*p;a[5]=(1-(b+q))*p;a[6]=(h+g)*p;a[7]=0;a[8]=(f+k)*d;a[9]=(h-g)*d;a[10]=(1-(b+n))*d;a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a};a.fromRotationTranslationScaleOrigin=
function(a,b,c,d,f){var l=b[0],h=b[1],t=b[2],g=b[3],k=l+l,m=h+h,u=t+t;b=l*k;var n=l*m,p=l*u;l=h*m;h*=u;var z=t*u;t=g*k;m*=g;var B=g*u,C=d[0],J=d[1];u=d[2];d=f[0];g=f[1];f=f[2];k=(1-(l+z))*C;var D=(n+B)*C;C*=p-m;n=(n-B)*J;z=(1-(b+z))*J;J*=h+t;p=(p+m)*u;h=(h-t)*u;b=(1-(b+l))*u;a[0]=k;a[1]=D;a[2]=C;a[3]=0;a[4]=n;a[5]=z;a[6]=J;a[7]=0;a[8]=p;a[9]=h;a[10]=b;a[11]=0;a[12]=c[0]+d-(k*d+n*g+p*f);a[13]=c[1]+g-(D*d+z*g+h*f);a[14]=c[2]+f-(C*d+J*g+b*f);a[15]=1;return a};a.fromQuat=function(a,b){var c=b[0],d=b[1],
f=b[2];b=b[3];var h=c+c,q=d+d,t=f+f;c*=h;var g=d*h;d*=q;var k=f*h,m=f*q;f*=t;h*=b;q*=b;b*=t;a[0]=1-d-f;a[1]=g+b;a[2]=k-q;a[3]=0;a[4]=g-b;a[5]=1-c-f;a[6]=m+h;a[7]=0;a[8]=k+q;a[9]=m-h;a[10]=1-c-d;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.frustum=function(a,b,c,d,f,g,q){var l=1/(c-b),h=1/(f-d),r=1/(g-q);a[0]=2*g*l;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*g*h;a[6]=0;a[7]=0;a[8]=(c+b)*l;a[9]=(f+d)*h;a[10]=(q+g)*r;a[11]=-1;a[12]=0;a[13]=0;a[14]=q*g*2*r;a[15]=0;return a};a.perspective=function(a,b,c,
d,f){b=1/Math.tan(b/2);a[0]=b/c;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[11]=-1;a[12]=0;a[13]=0;a[15]=0;null!=f&&Infinity!==f?(c=1/(d-f),a[10]=(f+d)*c,a[14]=2*f*d*c):(a[10]=-1,a[14]=-2*d);return a};a.perspectiveFromFieldOfView=function(a,b,c,d){var f=Math.tan(b.upDegrees*Math.PI/180),h=Math.tan(b.downDegrees*Math.PI/180),g=Math.tan(b.leftDegrees*Math.PI/180);b=Math.tan(b.rightDegrees*Math.PI/180);var t=2/(g+b),k=2/(f+h);a[0]=t;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=k;a[6]=0;a[7]=
0;a[8]=-((g-b)*t*.5);a[9]=(f-h)*k*.5;a[10]=d/(c-d);a[11]=-1;a[12]=0;a[13]=0;a[14]=d*c/(c-d);a[15]=0;return a};a.ortho=function(a,b,c,d,f,g,q){var l=1/(b-c),h=1/(d-f),r=1/(g-q);a[0]=-2*l;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*h;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*r;a[11]=0;a[12]=(b+c)*l;a[13]=(f+d)*h;a[14]=(q+g)*r;a[15]=1;return a};a.lookAt=function(a,c,d,f){var l=c[0],h=c[1];c=c[2];var q=f[0];var t=f[1];var k=f[2];var m=d[0];f=d[1];var x=d[2];if(Math.abs(l-m)<g.EPSILON&&Math.abs(h-f)<g.EPSILON&&Math.abs(c-
x)<g.EPSILON)return b(a);d=l-m;f=h-f;m=c-x;var u=1/Math.sqrt(d*d+f*f+m*m);d*=u;f*=u;m*=u;x=t*m-k*f;k=k*d-q*m;q=q*f-t*d;(u=Math.sqrt(x*x+k*k+q*q))?(u=1/u,x*=u,k*=u,q*=u):q=k=x=0;t=f*q-m*k;var A=m*x-d*q;var n=d*k-f*x;(u=Math.sqrt(t*t+A*A+n*n))?(u=1/u,t*=u,A*=u,n*=u):n=A=t=0;a[0]=x;a[1]=t;a[2]=d;a[3]=0;a[4]=k;a[5]=A;a[6]=f;a[7]=0;a[8]=q;a[9]=n;a[10]=m;a[11]=0;a[12]=-(x*l+k*h+q*c);a[13]=-(t*l+A*h+n*c);a[14]=-(d*l+f*h+m*c);a[15]=1;return a};a.targetTo=function(a,b,c,d){var f=b[0],h=b[1];b=b[2];var g=d[0],
t=d[1],k=d[2];d=f-c[0];var m=h-c[1];c=b-c[2];var x=d*d+m*m+c*c;0<x&&(x=1/Math.sqrt(x),d*=x,m*=x,c*=x);var u=t*c-k*m;k=k*d-g*c;g=g*m-t*d;x=u*u+k*k+g*g;0<x&&(x=1/Math.sqrt(x),u*=x,k*=x,g*=x);a[0]=u;a[1]=k;a[2]=g;a[3]=0;a[4]=m*g-c*k;a[5]=c*u-d*g;a[6]=d*k-m*u;a[7]=0;a[8]=d;a[9]=m;a[10]=c;a[11]=0;a[12]=f;a[13]=h;a[14]=b;a[15]=1;return a};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+
", "+a[14]+", "+a[15]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};a.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];a[4]=b[4]+c[4];a[5]=b[5]+c[5];a[6]=b[6]+c[6];a[7]=b[7]+c[7];a[8]=b[8]+c[8];a[9]=
b[9]+c[9];a[10]=b[10]+c[10];a[11]=b[11]+c[11];a[12]=b[12]+c[12];a[13]=b[13]+c[13];a[14]=b[14]+c[14];a[15]=b[15]+c[15];return a};a.subtract=k;a.multiplyScalar=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*c;a[12]=b[12]*c;a[13]=b[13]*c;a[14]=b[14]*c;a[15]=b[15]*c;return a};a.multiplyScalarAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;a[3]=b[3]+c[3]*d;a[4]=
b[4]+c[4]*d;a[5]=b[5]+c[5]*d;a[6]=b[6]+c[6]*d;a[7]=b[7]+c[7]*d;a[8]=b[8]+c[8]*d;a[9]=b[9]+c[9]*d;a[10]=b[10]+c[10]*d;a[11]=b[11]+c[11]*d;a[12]=b[12]+c[12]*d;a[13]=b[13]+c[13]*d;a[14]=b[14]+c[14]*d;a[15]=b[15]+c[15]*d;return a};a.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]};a.equals=function(a,
b){var c=a[0],d=a[1],f=a[2],h=a[3],k=a[4],t=a[5],S=a[6],m=a[7],x=a[8],u=a[9],A=a[10],y=a[11],z=a[12],B=a[13],C=a[14];a=a[15];var J=b[0],D=b[1],v=b[2],w=b[3],E=b[4],F=b[5],G=b[6],H=b[7],I=b[8],K=b[9],L=b[10],M=b[11],O=b[12],Q=b[13],R=b[14];b=b[15];return Math.abs(c-J)<=g.EPSILON*Math.max(1,Math.abs(c),Math.abs(J))&&Math.abs(d-D)<=g.EPSILON*Math.max(1,Math.abs(d),Math.abs(D))&&Math.abs(f-v)<=g.EPSILON*Math.max(1,Math.abs(f),Math.abs(v))&&Math.abs(h-w)<=g.EPSILON*Math.max(1,Math.abs(h),Math.abs(w))&&
Math.abs(k-E)<=g.EPSILON*Math.max(1,Math.abs(k),Math.abs(E))&&Math.abs(t-F)<=g.EPSILON*Math.max(1,Math.abs(t),Math.abs(F))&&Math.abs(S-G)<=g.EPSILON*Math.max(1,Math.abs(S),Math.abs(G))&&Math.abs(m-H)<=g.EPSILON*Math.max(1,Math.abs(m),Math.abs(H))&&Math.abs(x-I)<=g.EPSILON*Math.max(1,Math.abs(x),Math.abs(I))&&Math.abs(u-K)<=g.EPSILON*Math.max(1,Math.abs(u),Math.abs(K))&&Math.abs(A-L)<=g.EPSILON*Math.max(1,Math.abs(A),Math.abs(L))&&Math.abs(y-M)<=g.EPSILON*Math.max(1,Math.abs(y),Math.abs(M))&&Math.abs(z-
O)<=g.EPSILON*Math.max(1,Math.abs(z),Math.abs(O))&&Math.abs(B-Q)<=g.EPSILON*Math.max(1,Math.abs(B),Math.abs(Q))&&Math.abs(C-R)<=g.EPSILON*Math.max(1,Math.abs(C),Math.abs(R))&&Math.abs(a-b)<=g.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};a.sub=a.mul=void 0;var g=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Z&&Y?Y(a,c):{};d.get||d.set?Z(b,c,d):b[c]=a[c]}b.default=a;return b}(Ba);a.mul=d;a.sub=k});K(Rc);var Sc=H(function(c,
a){function b(){var a=new q.ARRAY_TYPE(3);q.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0);return a}function d(a){var b=a[0],c=a[1];a=a[2];return Math.sqrt(b*b+c*c+a*a)}function f(a,b,c){var d=new q.ARRAY_TYPE(3);d[0]=a;d[1]=b;d[2]=c;return d}function k(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];return a}function g(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*c[2];return a}function h(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];return a}function m(a,b){var c=b[0]-a[0],d=b[1]-a[1];
a=b[2]-a[2];return Math.sqrt(c*c+d*d+a*a)}function n(a,b){var c=b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return c*c+d*d+a*a}function p(a){var b=a[0],c=a[1];a=a[2];return b*b+c*c+a*a}function l(a,b){var c=b[0],d=b[1],f=b[2];c=c*c+d*d+f*f;0<c&&(c=1/Math.sqrt(c));a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;return a}function r(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}Object.defineProperty(a,"__esModule",{value:!0});a.create=b;a.clone=function(a){var b=new q.ARRAY_TYPE(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.length=
d;a.fromValues=f;a.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a};a.set=function(a,b,c,d){a[0]=b;a[1]=c;a[2]=d;return a};a.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];return a};a.subtract=k;a.multiply=g;a.divide=h;a.ceil=function(a,b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);a[2]=Math.ceil(b[2]);return a};a.floor=function(a,b){a[0]=Math.floor(b[0]);a[1]=Math.floor(b[1]);a[2]=Math.floor(b[2]);return a};a.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],
c[1]);a[2]=Math.min(b[2],c[2]);return a};a.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);return a};a.round=function(a,b){a[0]=Math.round(b[0]);a[1]=Math.round(b[1]);a[2]=Math.round(b[2]);return a};a.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;return a};a.scaleAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;return a};a.distance=m;a.squaredDistance=n;a.squaredLength=p;a.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];
a[2]=-b[2];return a};a.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];a[2]=1/b[2];return a};a.normalize=l;a.dot=r;a.cross=function(a,b,c){var d=b[0],f=b[1];b=b[2];var l=c[0],g=c[1];c=c[2];a[0]=f*c-b*g;a[1]=b*l-d*c;a[2]=d*g-f*l;return a};a.lerp=function(a,b,c,d){var f=b[0],l=b[1];b=b[2];a[0]=f+d*(c[0]-f);a[1]=l+d*(c[1]-l);a[2]=b+d*(c[2]-b);return a};a.hermite=function(a,b,c,d,f,l){var g=l*l,k=g*(2*l-3)+1,h=g*(l-2)+l,q=g*(l-1);l=g*(3-2*l);a[0]=b[0]*k+c[0]*h+d[0]*q+f[0]*l;a[1]=b[1]*k+c[1]*h+d[1]*q+f[1]*
l;a[2]=b[2]*k+c[2]*h+d[2]*q+f[2]*l;return a};a.bezier=function(a,b,c,d,f,l){var g=1-l,k=g*g,h=l*l,q=k*g;k*=3*l;g*=3*h;l*=h;a[0]=b[0]*q+c[0]*k+d[0]*g+f[0]*l;a[1]=b[1]*q+c[1]*k+d[1]*g+f[1]*l;a[2]=b[2]*q+c[2]*k+d[2]*g+f[2]*l;return a};a.random=function(a,b){b=b||1;var c=2*q.RANDOM()*Math.PI,d=2*q.RANDOM()-1,f=Math.sqrt(1-d*d)*b;a[0]=Math.cos(c)*f;a[1]=Math.sin(c)*f;a[2]=d*b;return a};a.transformMat4=function(a,b,c){var d=b[0],f=b[1];b=b[2];var l=c[3]*d+c[7]*f+c[11]*b+c[15];l=l||1;a[0]=(c[0]*d+c[4]*f+
c[8]*b+c[12])/l;a[1]=(c[1]*d+c[5]*f+c[9]*b+c[13])/l;a[2]=(c[2]*d+c[6]*f+c[10]*b+c[14])/l;return a};a.transformMat3=function(a,b,c){var d=b[0],f=b[1];b=b[2];a[0]=d*c[0]+f*c[3]+b*c[6];a[1]=d*c[1]+f*c[4]+b*c[7];a[2]=d*c[2]+f*c[5]+b*c[8];return a};a.transformQuat=function(a,b,c){var d=c[0],f=c[1],l=c[2],g=b[0],k=b[1];b=b[2];var h=f*b-l*k,q=l*g-d*b,r=d*k-f*g;c=2*c[3];a[0]=g+h*c+2*(f*r-l*q);a[1]=k+q*c+2*(l*h-d*r);a[2]=b+r*c+2*(d*q-f*h);return a};a.rotateX=function(a,b,c,d){var f=[],l=[];f[0]=b[0]-c[0];
f[1]=b[1]-c[1];f[2]=b[2]-c[2];l[0]=f[0];l[1]=f[1]*Math.cos(d)-f[2]*Math.sin(d);l[2]=f[1]*Math.sin(d)+f[2]*Math.cos(d);a[0]=l[0]+c[0];a[1]=l[1]+c[1];a[2]=l[2]+c[2];return a};a.rotateY=function(a,b,c,d){var f=[],l=[];f[0]=b[0]-c[0];f[1]=b[1]-c[1];f[2]=b[2]-c[2];l[0]=f[2]*Math.sin(d)+f[0]*Math.cos(d);l[1]=f[1];l[2]=f[2]*Math.cos(d)-f[0]*Math.sin(d);a[0]=l[0]+c[0];a[1]=l[1]+c[1];a[2]=l[2]+c[2];return a};a.rotateZ=function(a,b,c,d){var f=[],l=[];f[0]=b[0]-c[0];f[1]=b[1]-c[1];f[2]=b[2]-c[2];l[0]=f[0]*Math.cos(d)-
f[1]*Math.sin(d);l[1]=f[0]*Math.sin(d)+f[1]*Math.cos(d);l[2]=f[2];a[0]=l[0]+c[0];a[1]=l[1]+c[1];a[2]=l[2]+c[2];return a};a.angle=function(a,b){a=f(a[0],a[1],a[2]);b=f(b[0],b[1],b[2]);l(a,a);l(b,b);b=r(a,b);return 1<b?0:-1>b?Math.PI:Math.acos(b)};a.zero=function(a){a[0]=0;a[1]=0;a[2]=0;return a};a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};a.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]};a.equals=function(a,b){var c=a[0],d=a[1];a=a[2];var f=b[0],l=b[1];b=b[2];
return Math.abs(c-f)<=q.EPSILON*Math.max(1,Math.abs(c),Math.abs(f))&&Math.abs(d-l)<=q.EPSILON*Math.max(1,Math.abs(d),Math.abs(l))&&Math.abs(a-b)<=q.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};a.forEach=a.sqrLen=a.len=a.sqrDist=a.dist=a.div=a.mul=a.sub=void 0;var q=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Z&&Y?Y(a,c):{};d.get||d.set?Z(b,c,d):b[c]=a[c]}b.default=a;return b}(Ba);a.sub=k;a.mul=g;a.div=h;a.dist=m;a.sqrDist=
n;a.len=d;a.sqrLen=p;c=function(){var a=b();return function(b,c,d,f,l,g){c||(c=3);d||(d=0);for(f=f?Math.min(f*c+d,b.length):b.length;d<f;d+=c)a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],l(a,a,g),b[d]=a[0],b[d+1]=a[1],b[d+2]=a[2];return b}}();a.forEach=c});K(Sc);var Tc=H(function(c,a){function b(){var a=new p.ARRAY_TYPE(4);p.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0);return a}function d(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];return a}function f(a,b,c){a[0]=b[0]*c[0];
a[1]=b[1]*c[1];a[2]=b[2]*c[2];a[3]=b[3]*c[3];return a}function k(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];a[3]=b[3]/c[3];return a}function g(a,b){var c=b[0]-a[0],d=b[1]-a[1],f=b[2]-a[2];a=b[3]-a[3];return Math.sqrt(c*c+d*d+f*f+a*a)}function h(a,b){var c=b[0]-a[0],d=b[1]-a[1],f=b[2]-a[2];a=b[3]-a[3];return c*c+d*d+f*f+a*a}function m(a){var b=a[0],c=a[1],d=a[2];a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)}function n(a){var b=a[0],c=a[1],d=a[2];a=a[3];return b*b+c*c+d*d+a*a}Object.defineProperty(a,
"__esModule",{value:!0});a.create=b;a.clone=function(a){var b=new p.ARRAY_TYPE(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.fromValues=function(a,b,c,d){var f=new p.ARRAY_TYPE(4);f[0]=a;f[1]=b;f[2]=c;f[3]=d;return f};a.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a};a.set=function(a,b,c,d,f){a[0]=b;a[1]=c;a[2]=d;a[3]=f;return a};a.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];return a};a.subtract=d;a.multiply=f;a.divide=k;a.ceil=function(a,
b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);a[2]=Math.ceil(b[2]);a[3]=Math.ceil(b[3]);return a};a.floor=function(a,b){a[0]=Math.floor(b[0]);a[1]=Math.floor(b[1]);a[2]=Math.floor(b[2]);a[3]=Math.floor(b[3]);return a};a.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);a[2]=Math.min(b[2],c[2]);a[3]=Math.min(b[3],c[3]);return a};a.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);a[3]=Math.max(b[3],c[3]);return a};a.round=function(a,b){a[0]=
Math.round(b[0]);a[1]=Math.round(b[1]);a[2]=Math.round(b[2]);a[3]=Math.round(b[3]);return a};a.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;return a};a.scaleAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;a[3]=b[3]+c[3]*d;return a};a.distance=g;a.squaredDistance=h;a.length=m;a.squaredLength=n;a.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=-b[3];return a};a.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];a[2]=1/b[2];a[3]=1/b[3];return a};
a.normalize=function(a,b){var c=b[0],d=b[1],f=b[2];b=b[3];var l=c*c+d*d+f*f+b*b;0<l&&(l=1/Math.sqrt(l));a[0]=c*l;a[1]=d*l;a[2]=f*l;a[3]=b*l;return a};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};a.cross=function(a,b,c,d){var f=c[0]*d[1]-c[1]*d[0],l=c[0]*d[2]-c[2]*d[0],g=c[0]*d[3]-c[3]*d[0],k=c[1]*d[2]-c[2]*d[1],h=c[1]*d[3]-c[3]*d[1];c=c[2]*d[3]-c[3]*d[2];d=b[0];var q=b[1],r=b[2];b=b[3];a[0]=q*c-r*h+b*k;a[1]=-(d*c)+r*g-b*l;a[2]=d*h-q*g+b*f;a[3]=-(d*k)+q*l-r*f;return a};a.lerp=
function(a,b,c,d){var f=b[0],l=b[1],g=b[2];b=b[3];a[0]=f+d*(c[0]-f);a[1]=l+d*(c[1]-l);a[2]=g+d*(c[2]-g);a[3]=b+d*(c[3]-b);return a};a.random=function(a,b){b=b||1;do{var c=2*p.RANDOM()-1;var d=2*p.RANDOM()-1;var f=c*c+d*d}while(1<=f);do{var l=2*p.RANDOM()-1;var g=2*p.RANDOM()-1;var k=l*l+g*g}while(1<=k);f=Math.sqrt((1-f)/k);a[0]=b*c;a[1]=b*d;a[2]=b*l*f;a[3]=b*g*f;return a};a.transformMat4=function(a,b,c){var d=b[0],f=b[1],l=b[2];b=b[3];a[0]=c[0]*d+c[4]*f+c[8]*l+c[12]*b;a[1]=c[1]*d+c[5]*f+c[9]*l+c[13]*
b;a[2]=c[2]*d+c[6]*f+c[10]*l+c[14]*b;a[3]=c[3]*d+c[7]*f+c[11]*l+c[15]*b;return a};a.transformQuat=function(a,b,c){var d=b[0],f=b[1],l=b[2],g=c[0],k=c[1],h=c[2];c=c[3];var q=c*d+k*l-h*f,r=c*f+h*d-g*l,m=c*l+g*f-k*d;d=-g*d-k*f-h*l;a[0]=q*c+d*-g+r*-h-m*-k;a[1]=r*c+d*-k+m*-g-q*-h;a[2]=m*c+d*-h+q*-k-r*-g;a[3]=b[3];return a};a.zero=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};a.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===
b[1]&&a[2]===b[2]&&a[3]===b[3]};a.equals=function(a,b){var c=a[0],d=a[1],f=a[2];a=a[3];var l=b[0],g=b[1],k=b[2];b=b[3];return Math.abs(c-l)<=p.EPSILON*Math.max(1,Math.abs(c),Math.abs(l))&&Math.abs(d-g)<=p.EPSILON*Math.max(1,Math.abs(d),Math.abs(g))&&Math.abs(f-k)<=p.EPSILON*Math.max(1,Math.abs(f),Math.abs(k))&&Math.abs(a-b)<=p.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};a.forEach=a.sqrLen=a.len=a.sqrDist=a.dist=a.div=a.mul=a.sub=void 0;var p=function(a){if(a&&a.__esModule)return a;var b={};if(null!=
a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Z&&Y?Y(a,c):{};d.get||d.set?Z(b,c,d):b[c]=a[c]}b.default=a;return b}(Ba);a.sub=d;a.mul=f;a.div=k;a.dist=g;a.sqrDist=h;a.len=m;a.sqrLen=n;c=function(){var a=b();return function(b,c,d,f,l,g){c||(c=4);d||(d=0);for(f=f?Math.min(f*c+d,b.length):b.length;d<f;d+=c)a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],a[3]=b[d+3],l(a,a,g),b[d]=a[0],b[d+1]=a[1],b[d+2]=a[2],b[d+3]=a[3];return b}}();a.forEach=c});K(Tc);var Uc=H(function(c,a){function b(a){if(a&&
a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Z&&Y?Y(a,c):{};d.get||d.set?Z(b,c,d):b[c]=a[c]}b.default=a;return b}function d(){var a=new m.ARRAY_TYPE(4);m.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0);a[3]=1;return a}function f(a,b,c){c*=.5;var d=Math.sin(c);a[0]=d*b[0];a[1]=d*b[1];a[2]=d*b[2];a[3]=Math.cos(c);return a}function k(a,b,c){var d=b[0],f=b[1],l=b[2];b=b[3];var g=c[0],k=c[1],h=c[2];c=c[3];a[0]=d*c+b*g+f*h-l*k;a[1]=f*c+b*
k+l*g-d*h;a[2]=l*c+b*h+d*k-f*g;a[3]=b*c-d*g-f*k-l*h;return a}function g(a,b,c,d){var f=b[0],l=b[1],g=b[2];b=b[3];var k=c[0],h=c[1],q=c[2];c=c[3];var r=f*k+l*h+g*q+b*c;0>r&&(r=-r,k=-k,h=-h,q=-q,c=-c);if(1-r>m.EPSILON){var t=Math.acos(r);var n=Math.sin(t);r=Math.sin((1-d)*t)/n;d=Math.sin(d*t)/n}else r=1-d;a[0]=r*f+d*k;a[1]=r*l+d*h;a[2]=r*g+d*q;a[3]=r*b+d*c;return a}function h(a,b){var c=b[0]+b[4]+b[8];if(0<c)c=Math.sqrt(c+1),a[3]=.5*c,c=.5/c,a[0]=(b[5]-b[7])*c,a[1]=(b[6]-b[2])*c,a[2]=(b[1]-b[3])*c;
else{var d=0;b[4]>b[0]&&(d=1);b[8]>b[3*d+d]&&(d=2);var f=(d+1)%3,l=(d+2)%3;c=Math.sqrt(b[3*d+d]-b[3*f+f]-b[3*l+l]+1);a[d]=.5*c;c=.5/c;a[3]=(b[3*f+l]-b[3*l+f])*c;a[f]=(b[3*f+d]+b[3*d+f])*c;a[l]=(b[3*l+d]+b[3*d+l])*c}return a}Object.defineProperty(a,"__esModule",{value:!0});a.create=d;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=f;a.getAxisAngle=function(a,b){var c=2*Math.acos(b[3]),d=Math.sin(c/2);d>m.EPSILON?(a[0]=b[0]/d,a[1]=b[1]/d,a[2]=b[2]/d):(a[0]=1,a[1]=0,a[2]=
0);return c};a.multiply=k;a.rotateX=function(a,b,c){c*=.5;var d=b[0],f=b[1],l=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=d*c+b*g;a[1]=f*c+l*g;a[2]=l*c-f*g;a[3]=b*c-d*g;return a};a.rotateY=function(a,b,c){c*=.5;var d=b[0],f=b[1],l=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=d*c-l*g;a[1]=f*c+b*g;a[2]=l*c+d*g;a[3]=b*c-f*g;return a};a.rotateZ=function(a,b,c){c*=.5;var d=b[0],f=b[1],l=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=d*c+f*g;a[1]=f*c-d*g;a[2]=l*c+b*g;a[3]=b*c-l*g;return a};a.calculateW=
function(a,b){var c=b[0],d=b[1];b=b[2];a[0]=c;a[1]=d;a[2]=b;a[3]=Math.sqrt(Math.abs(1-c*c-d*d-b*b));return a};a.slerp=g;a.random=function(a){var b=m.RANDOM(),c=m.RANDOM(),d=m.RANDOM(),f=Math.sqrt(1-b);b=Math.sqrt(b);a[0]=f*Math.sin(2*Math.PI*c);a[1]=f*Math.cos(2*Math.PI*c);a[2]=b*Math.sin(2*Math.PI*d);a[3]=b*Math.cos(2*Math.PI*d);return a};a.invert=function(a,b){var c=b[0],d=b[1],f=b[2];b=b[3];var l=c*c+d*d+f*f+b*b;l=l?1/l:0;a[0]=-c*l;a[1]=-d*l;a[2]=-f*l;a[3]=b*l;return a};a.conjugate=function(a,
b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=b[3];return a};a.fromMat3=h;a.fromEuler=function(a,b,c,d){var f=.5*Math.PI/180;b*=f;c*=f;d*=f;f=Math.sin(b);b=Math.cos(b);var l=Math.sin(c);c=Math.cos(c);var g=Math.sin(d);d=Math.cos(d);a[0]=f*c*d-b*l*g;a[1]=b*l*d+f*c*g;a[2]=b*c*g-f*l*d;a[3]=b*c*d+f*l*g;return a};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};a.setAxes=a.sqlerp=a.rotationTo=a.equals=a.exactEquals=a.normalize=a.sqrLen=a.squaredLength=a.len=a.length=a.lerp=a.dot=a.scale=
a.mul=a.add=a.set=a.copy=a.fromValues=a.clone=void 0;var m=b(Ba),n=b(Qc),p=b(Sc);c=b(Tc);a.clone=c.clone;a.fromValues=c.fromValues;a.copy=c.copy;a.set=c.set;a.add=c.add;a.mul=k;a.scale=c.scale;a.dot=c.dot;a.lerp=c.lerp;var l=c.length;a.length=l;a.len=l;l=c.squaredLength;a.squaredLength=l;a.sqrLen=l;var r=c.normalize;a.normalize=r;a.exactEquals=c.exactEquals;a.equals=c.equals;c=function(){var a=p.create(),b=p.fromValues(1,0,0),c=p.fromValues(0,1,0);return function(d,l,g){var k=p.dot(l,g);if(-.999999>
k)return p.cross(a,b,l),1E-6>p.len(a)&&p.cross(a,c,l),p.normalize(a,a),f(d,a,Math.PI),d;if(.999999<k)return d[0]=0,d[1]=0,d[2]=0,d[3]=1,d;p.cross(a,l,g);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=1+k;return r(d,d)}}();a.rotationTo=c;c=function(){var a=d(),b=d();return function(c,d,f,l,k,h){g(a,d,k,h);g(b,f,l,h);g(c,a,b,2*h*(1-h));return c}}();a.sqlerp=c;c=function(){var a=n.create();return function(b,c,d,f){a[0]=d[0];a[3]=d[1];a[6]=d[2];a[1]=f[0];a[4]=f[1];a[7]=f[2];a[2]=-c[0];a[5]=-c[1];a[8]=-c[2];return r(b,
h(b,a))}}();a.setAxes=c});K(Uc);var ve=H(function(c,a){function b(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Z&&Y?Y(a,c):{};d.get||d.set?Z(b,c,d):b[c]=a[c]}b.default=a;return b}function d(a,b,c){var d=.5*c[0],f=.5*c[1];c=.5*c[2];var l=b[0],g=b[1],k=b[2];b=b[3];a[0]=l;a[1]=g;a[2]=k;a[3]=b;a[4]=d*b+f*k-c*g;a[5]=f*b+c*l-d*k;a[6]=c*b+d*g-f*l;a[7]=-d*l-f*g-c*k;return a}function f(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=
b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];return a}function k(a,b,c){var d=b[0],f=b[1],l=b[2],g=b[3],k=c[4],h=c[5],r=c[6],q=c[7],m=b[4],n=b[5],p=b[6];b=b[7];var D=c[0],v=c[1],w=c[2];c=c[3];a[0]=d*c+g*D+f*w-l*v;a[1]=f*c+g*v+l*D-d*w;a[2]=l*c+g*w+d*v-f*D;a[3]=g*c-d*D-f*v-l*w;a[4]=d*q+g*k+f*r-l*h+m*c+b*D+n*w-p*v;a[5]=f*q+g*h+l*k-d*r+n*c+b*v+p*D-m*w;a[6]=l*q+g*r+d*h-f*k+p*c+b*w+m*v-n*D;a[7]=g*q-d*k-f*h-l*r+b*c-m*D-n*v-p*w;return a}Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){var a=new g.ARRAY_TYPE(8);
g.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[4]=0,a[5]=0,a[6]=0,a[7]=0);a[3]=1;return a};a.clone=function(a){var b=new g.ARRAY_TYPE(8);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];return b};a.fromValues=function(a,b,c,d,f,k,h,u){var l=new g.ARRAY_TYPE(8);l[0]=a;l[1]=b;l[2]=c;l[3]=d;l[4]=f;l[5]=k;l[6]=h;l[7]=u;return l};a.fromRotationTranslationValues=function(a,b,c,d,f,k,h){var l=new g.ARRAY_TYPE(8);l[0]=a;l[1]=b;l[2]=c;l[3]=d;f*=.5;k*=.5;h*=.5;l[4]=f*d+k*
c-h*b;l[5]=k*d+h*a-f*c;l[6]=h*d+f*b-k*a;l[7]=-f*a-k*b-h*c;return l};a.fromRotationTranslation=d;a.fromTranslation=function(a,b){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=.5*b[0];a[5]=.5*b[1];a[6]=.5*b[2];a[7]=0;return a};a.fromRotation=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=0;a[5]=0;a[6]=0;a[7]=0;return a};a.fromMat4=function(a,b){var c=h.create();m.getRotation(c,b);var f=new g.ARRAY_TYPE(3);m.getTranslation(f,b);d(a,c,f);return a};a.copy=f;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=
1;a[4]=0;a[5]=0;a[6]=0;a[7]=0;return a};a.set=function(a,b,c,d,f,g,k,h,m){a[0]=b;a[1]=c;a[2]=d;a[3]=f;a[4]=g;a[5]=k;a[6]=h;a[7]=m;return a};a.getDual=function(a,b){a[0]=b[4];a[1]=b[5];a[2]=b[6];a[3]=b[7];return a};a.setDual=function(a,b){a[4]=b[0];a[5]=b[1];a[6]=b[2];a[7]=b[3];return a};a.getTranslation=function(a,b){var c=b[4],d=b[5],f=b[6],g=b[7],l=-b[0],k=-b[1],h=-b[2];b=b[3];a[0]=2*(c*b+g*l+d*h-f*k);a[1]=2*(d*b+g*k+f*l-c*h);a[2]=2*(f*b+g*h+c*k-d*l);return a};a.translate=function(a,b,c){var d=
b[0],f=b[1],g=b[2],l=b[3],k=.5*c[0],h=.5*c[1];c=.5*c[2];var r=b[4],m=b[5],q=b[6];b=b[7];a[0]=d;a[1]=f;a[2]=g;a[3]=l;a[4]=l*k+f*c-g*h+r;a[5]=l*h+g*k-d*c+m;a[6]=l*c+d*h-f*k+q;a[7]=-d*k-f*h-g*c+b;return a};a.rotateX=function(a,b,c){var d=-b[0],f=-b[1],g=-b[2],l=b[3],k=b[4],r=b[5],m=b[6],q=b[7],n=k*l+q*d+r*g-m*f,p=r*l+q*f+m*d-k*g,J=m*l+q*g+k*f-r*d;k=q*l-k*d-r*f-m*g;h.rotateX(a,b,c);d=a[0];f=a[1];g=a[2];l=a[3];a[4]=n*l+k*d+p*g-J*f;a[5]=p*l+k*f+J*d-n*g;a[6]=J*l+k*g+n*f-p*d;a[7]=k*l-n*d-p*f-J*g;return a};
a.rotateY=function(a,b,c){var d=-b[0],f=-b[1],g=-b[2],k=b[3],l=b[4],m=b[5],r=b[6],q=b[7],n=l*k+q*d+m*g-r*f,p=m*k+q*f+r*d-l*g,J=r*k+q*g+l*f-m*d;l=q*k-l*d-m*f-r*g;h.rotateY(a,b,c);d=a[0];f=a[1];g=a[2];k=a[3];a[4]=n*k+l*d+p*g-J*f;a[5]=p*k+l*f+J*d-n*g;a[6]=J*k+l*g+n*f-p*d;a[7]=l*k-n*d-p*f-J*g;return a};a.rotateZ=function(a,b,c){var d=-b[0],f=-b[1],g=-b[2],k=b[3],l=b[4],m=b[5],r=b[6],q=b[7],n=l*k+q*d+m*g-r*f,p=m*k+q*f+r*d-l*g,J=r*k+q*g+l*f-m*d;l=q*k-l*d-m*f-r*g;h.rotateZ(a,b,c);d=a[0];f=a[1];g=a[2];k=
a[3];a[4]=n*k+l*d+p*g-J*f;a[5]=p*k+l*f+J*d-n*g;a[6]=J*k+l*g+n*f-p*d;a[7]=l*k-n*d-p*f-J*g;return a};a.rotateByQuatAppend=function(a,b,c){var d=c[0],f=c[1],g=c[2];c=c[3];var k=b[0],l=b[1],h=b[2],m=b[3];a[0]=k*c+m*d+l*g-h*f;a[1]=l*c+m*f+h*d-k*g;a[2]=h*c+m*g+k*f-l*d;a[3]=m*c-k*d-l*f-h*g;k=b[4];l=b[5];h=b[6];m=b[7];a[4]=k*c+m*d+l*g-h*f;a[5]=l*c+m*f+h*d-k*g;a[6]=h*c+m*g+k*f-l*d;a[7]=m*c-k*d-l*f-h*g;return a};a.rotateByQuatPrepend=function(a,b,c){var d=b[0],f=b[1],g=b[2];b=b[3];var k=c[0],l=c[1],h=c[2],
m=c[3];a[0]=d*m+b*k+f*h-g*l;a[1]=f*m+b*l+g*k-d*h;a[2]=g*m+b*h+d*l-f*k;a[3]=b*m-d*k-f*l-g*h;k=c[4];l=c[5];h=c[6];m=c[7];a[4]=d*m+b*k+f*h-g*l;a[5]=f*m+b*l+g*k-d*h;a[6]=g*m+b*h+d*l-f*k;a[7]=b*m-d*k-f*l-g*h;return a};a.rotateAroundAxis=function(a,b,c,d){if(Math.abs(d)<g.EPSILON)return f(a,b);var k=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);d*=.5;var l=Math.sin(d),h=l*c[0]/k,m=l*c[1]/k;c=l*c[2]/k;d=Math.cos(d);k=b[0];l=b[1];var r=b[2],q=b[3];a[0]=k*d+q*h+l*c-r*m;a[1]=l*d+q*m+r*h-k*c;a[2]=r*d+q*c+k*m-l*h;
a[3]=q*d-k*h-l*m-r*c;k=b[4];l=b[5];r=b[6];b=b[7];a[4]=k*d+b*h+l*c-r*m;a[5]=l*d+b*m+r*h-k*c;a[6]=r*d+b*c+k*m-l*h;a[7]=b*d-k*h-l*m-r*c;return a};a.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];a[4]=b[4]+c[4];a[5]=b[5]+c[5];a[6]=b[6]+c[6];a[7]=b[7]+c[7];return a};a.multiply=k;a.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;return a};a.lerp=function(a,b,c,d){var f=1-d;0>n(b,c)&&(d=-d);a[0]=b[0]*f+
c[0]*d;a[1]=b[1]*f+c[1]*d;a[2]=b[2]*f+c[2]*d;a[3]=b[3]*f+c[3]*d;a[4]=b[4]*f+c[4]*d;a[5]=b[5]*f+c[5]*d;a[6]=b[6]*f+c[6]*d;a[7]=b[7]*f+c[7]*d;return a};a.invert=function(a,b){var c=p(b);a[0]=-b[0]/c;a[1]=-b[1]/c;a[2]=-b[2]/c;a[3]=b[3]/c;a[4]=-b[4]/c;a[5]=-b[5]/c;a[6]=-b[6]/c;a[7]=b[7]/c;return a};a.conjugate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=b[3];a[4]=-b[4];a[5]=-b[5];a[6]=-b[6];a[7]=b[7];return a};a.normalize=function(a,b){var c=p(b);if(0<c){c=Math.sqrt(c);var d=b[0]/c,f=b[1]/c,g=
b[2]/c,k=b[3]/c,h=b[4],l=b[5],m=b[6];b=b[7];var r=d*h+f*l+g*m+k*b;a[0]=d;a[1]=f;a[2]=g;a[3]=k;a[4]=(h-d*r)/c;a[5]=(l-f*r)/c;a[6]=(m-g*r)/c;a[7]=(b-k*r)/c}return a};a.str=function(a){return"quat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+")"};a.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]};a.equals=function(a,b){var c=a[0],d=a[1],f=a[2],k=a[3],h=a[4],l=a[5],m=a[6];a=a[7];var r=
b[0],n=b[1],p=b[2],C=b[3],J=b[4],D=b[5],v=b[6];b=b[7];return Math.abs(c-r)<=g.EPSILON*Math.max(1,Math.abs(c),Math.abs(r))&&Math.abs(d-n)<=g.EPSILON*Math.max(1,Math.abs(d),Math.abs(n))&&Math.abs(f-p)<=g.EPSILON*Math.max(1,Math.abs(f),Math.abs(p))&&Math.abs(k-C)<=g.EPSILON*Math.max(1,Math.abs(k),Math.abs(C))&&Math.abs(h-J)<=g.EPSILON*Math.max(1,Math.abs(h),Math.abs(J))&&Math.abs(l-D)<=g.EPSILON*Math.max(1,Math.abs(l),Math.abs(D))&&Math.abs(m-v)<=g.EPSILON*Math.max(1,Math.abs(m),Math.abs(v))&&Math.abs(a-
b)<=g.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};a.sqrLen=a.squaredLength=a.len=a.length=a.dot=a.mul=a.setReal=a.getReal=void 0;var g=b(Ba),h=b(Uc),m=b(Rc);a.getReal=h.copy;a.setReal=h.copy;a.mul=k;var n=h.dot;a.dot=n;c=h.length;a.length=c;a.len=c;var p=h.squaredLength;a.squaredLength=p;a.sqrLen=p});K(ve);var we=H(function(c,a){function b(){var a=new p.ARRAY_TYPE(2);p.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0);return a}function d(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];return a}function f(a,b,c){a[0]=
b[0]*c[0];a[1]=b[1]*c[1];return a}function k(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];return a}function g(a,b){var c=b[0]-a[0];a=b[1]-a[1];return Math.sqrt(c*c+a*a)}function h(a,b){var c=b[0]-a[0];a=b[1]-a[1];return c*c+a*a}function m(a){var b=a[0];a=a[1];return Math.sqrt(b*b+a*a)}function n(a){var b=a[0];a=a[1];return b*b+a*a}Object.defineProperty(a,"__esModule",{value:!0});a.create=b;a.clone=function(a){var b=new p.ARRAY_TYPE(2);b[0]=a[0];b[1]=a[1];return b};a.fromValues=function(a,b){var c=new p.ARRAY_TYPE(2);
c[0]=a;c[1]=b;return c};a.copy=function(a,b){a[0]=b[0];a[1]=b[1];return a};a.set=function(a,b,c){a[0]=b;a[1]=c;return a};a.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];return a};a.subtract=d;a.multiply=f;a.divide=k;a.ceil=function(a,b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);return a};a.floor=function(a,b){a[0]=Math.floor(b[0]);a[1]=Math.floor(b[1]);return a};a.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);return a};a.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=
Math.max(b[1],c[1]);return a};a.round=function(a,b){a[0]=Math.round(b[0]);a[1]=Math.round(b[1]);return a};a.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;return a};a.scaleAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;return a};a.distance=g;a.squaredDistance=h;a.length=m;a.squaredLength=n;a.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];return a};a.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];return a};a.normalize=function(a,b){var c=b[0],d=b[1];c=c*c+d*d;0<c&&(c=1/Math.sqrt(c));a[0]=b[0]*
c;a[1]=b[1]*c;return a};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]};a.cross=function(a,b,c){b=b[0]*c[1]-b[1]*c[0];a[0]=a[1]=0;a[2]=b;return a};a.lerp=function(a,b,c,d){var f=b[0];b=b[1];a[0]=f+d*(c[0]-f);a[1]=b+d*(c[1]-b);return a};a.random=function(a,b){b=b||1;var c=2*p.RANDOM()*Math.PI;a[0]=Math.cos(c)*b;a[1]=Math.sin(c)*b;return a};a.transformMat2=function(a,b,c){var d=b[0];b=b[1];a[0]=c[0]*d+c[2]*b;a[1]=c[1]*d+c[3]*b;return a};a.transformMat2d=function(a,b,c){var d=b[0];b=b[1];a[0]=c[0]*d+
c[2]*b+c[4];a[1]=c[1]*d+c[3]*b+c[5];return a};a.transformMat3=function(a,b,c){var d=b[0];b=b[1];a[0]=c[0]*d+c[3]*b+c[6];a[1]=c[1]*d+c[4]*b+c[7];return a};a.transformMat4=function(a,b,c){var d=b[0];b=b[1];a[0]=c[0]*d+c[4]*b+c[12];a[1]=c[1]*d+c[5]*b+c[13];return a};a.rotate=function(a,b,c,d){var f=b[0]-c[0];b=b[1]-c[1];var g=Math.sin(d);d=Math.cos(d);a[0]=f*d-b*g+c[0];a[1]=f*g+b*d+c[1];return a};a.angle=function(a,b){var c=a[0];a=a[1];var d=b[0];b=b[1];var f=c*c+a*a;0<f&&(f=1/Math.sqrt(f));var g=d*
d+b*b;0<g&&(g=1/Math.sqrt(g));c=(c*d+a*b)*f*g;return 1<c?0:-1>c?Math.PI:Math.acos(c)};a.zero=function(a){a[0]=0;a[1]=0;return a};a.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};a.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]};a.equals=function(a,b){var c=a[0];a=a[1];var d=b[0];b=b[1];return Math.abs(c-d)<=p.EPSILON*Math.max(1,Math.abs(c),Math.abs(d))&&Math.abs(a-b)<=p.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};a.forEach=a.sqrLen=a.sqrDist=a.dist=a.div=a.mul=a.sub=a.len=void 0;var p=
function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Z&&Y?Y(a,c):{};d.get||d.set?Z(b,c,d):b[c]=a[c]}b.default=a;return b}(Ba);a.len=m;a.sub=d;a.mul=f;a.div=k;a.dist=g;a.sqrDist=h;a.sqrLen=n;c=function(){var a=b();return function(b,c,d,f,g,k){c||(c=2);d||(d=0);for(f=f?Math.min(f*c+d,b.length):b.length;d<f;d+=c)a[0]=b[d],a[1]=b[d+1],g(a,a,k),b[d]=a[0],b[d+1]=a[1];return b}}();a.forEach=c});K(we);var va=H(function(c,a){function b(a){if(a&&
a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Z&&Y?Y(a,c):{};d.get||d.set?Z(b,c,d):b[c]=a[c]}b.default=a;return b}Object.defineProperty(a,"__esModule",{value:!0});a.vec4=a.vec3=a.vec2=a.quat2=a.quat=a.mat4=a.mat3=a.mat2d=a.mat2=a.glMatrix=void 0;c=b(Ba);a.glMatrix=c;c=b(te);a.mat2=c;c=b(ue);a.mat2d=c;c=b(Qc);a.mat3=c;c=b(Rc);a.mat4=c;c=b(Uc);a.quat=c;c=b(ve);a.quat2=c;c=b(we);a.vec2=c;c=b(Sc);a.vec3=c;c=b(Tc);a.vec4=c});K(va);var hc=va.vec4,
Ib=va.vec3,yg=va.vec2,zg=va.quat2,Ag=va.quat,T=va.mat4,Bg=va.mat3,Cg=va.mat2d,Dg=va.mat2,Eg=va.glMatrix;nb.deviation=function(c,a,b,d){var f=a&&a.length,k=Math.abs(tc(c,0,f?a[0]*b:c.length,b));if(f){f=0;for(var g=a.length;f<g;f++)k-=Math.abs(tc(c,a[f]*b,f<g-1?a[f+1]*b:c.length,b))}for(f=a=0;f<d.length;f+=3){g=d[f]*b;var h=d[f+1]*b,m=d[f+2]*b;a+=Math.abs((c[g]-c[m])*(c[h+1]-c[g+1])-(c[g]-c[h])*(c[m+1]-c[g+1]))}return 0===k&&0===a?0:Math.abs((a-k)/k)};nb.flatten=function(c){for(var a=c[0][0].length,
b={vertices:[],holes:[],dimensions:a},d=0,f=0;f<c.length;f++){for(var k=0;k<c[f].length;k++)for(var g=0;g<a;g++)b.vertices.push(c[f][k][g]);0<f&&(d+=c[f-1].length,b.holes.push(d))}return b};nb.default=nb;var xe="undefined"===typeof ke?"__target":ke(),Ue=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,Nb=window.URL||window.webkitURL,hb=window.Worker;if(hb){var ye=id("self.onmessage = function () {}"),ze=new Uint8Array(1);try{if(/(?:Trident|Edge)\/(?:[567]|12)/i.test(navigator.userAgent))throw Error("Not available");
var Vc=new hb(ye);Vc.postMessage(ze,[ze.buffer])}catch(c){hb=null}finally{Nb.revokeObjectURL(ye),Vc&&Vc.terminate()}}var Fg=new function(c,a){return function(b){var d=this;if(a){if(hb&&!b)return b=(""+a).replace(/^function.+?{/,"").slice(0,-1),b=id(b),this[xe]=new hb(b),Nb.revokeObjectURL(b),this[xe];var f={postMessage:function(a){d.onmessage&&setTimeout(function(){return d.onmessage({data:a,target:f})})}};a.call(f);this.postMessage=function(a){setTimeout(function(){return f.onmessage({data:a,target:d})})};
this.isThisThread=!0}else return new hb(c)}}("./worker.js",function(c,a){}),Ae={window:1,windowAnimation:2,gradual:3,ripple:4,water:6},ic=function(c){function a(b,c){E(this,a);b=M(this,(a.__proto__||I(a)).call(this,b,c));b._isShow=!0;c=b.getOptions();if("windowAnimation"===c.style||"ripple"===c.style||0<c.riseTime)b.autoUpdate=!0;b.selectedColor=[-1,-1,-1];b.textureCache={};return b}G(a,c);F(a,[{key:"getDefaultOptions",value:function(){return{color:"rgba(50, 50, 230, 1.0)",opacity:.8,isTextureFull:!1,
topColor:"rgba(76, 76, 76, 76)",textureScale:1,useLight:!0,riseTime:0}}},{key:"initialize",value:function(a){this.gl=a;var b=this.getOptions();this.dataMgr=new Ta(this,this.gl);this.texture=null;this.isUseTexture=!1;var c=[];b.enablePicked&&c.push("PICK");b.texture&&c.push("USE_TEXTURE");this.program=new Q(this.gl,{vertexShader:"precision highp float;uniform vec4 uSelectedColor;attribute vec4 a_pos;attribute vec3 a_normal;attribute vec4 a_color;attribute vec4 a_pre_color;attribute float a_height;attribute float a_pre_height;\n#if defined(USE_TEXTURE)\nattribute vec2 a_texture_coord;\n#endif\nuniform mat4 u_proj_matrix;uniform mat4 u_mv_matrix;uniform mat4 u_normal_matrix;uniform vec3 u_side_light_dir;uniform bool u_use_lighting;uniform bool u_use_texture;uniform vec3 u_ripple_center;uniform float u_radius;uniform float style;uniform float alpha;uniform float time;uniform float dataTime;uniform float riseTime;uniform vec2 uMapCenter;uniform float uMapZoom;varying float v_height;varying vec4 v_color;varying vec3 v_position;varying vec2 v_texture_coord;const vec3 point_color=vec3(0.06,0.06,0.06);const vec3 light_color=vec3(0.53,0.53,0.53);const vec3 light_color_2=vec3(0.4,0.4,0.4);const vec3 uAmbientColor=vec3(0.8,0.8,0.8);const vec3 uLightingDirection=vec3(0.0,1.0,1.0);const vec3 uDirectionalColor=vec3(1.0,1.0,1.0);float getTransitionValue(float pre_value,float to_value,float dataTime,float riseTime){float result=0.0;if(pre_value==to_value){result=to_value;}else{if(riseTime>0.0&&dataTime<riseTime){result=(pre_value+(to_value-pre_value)*(dataTime/riseTime));}else{result=to_value;}}return result;}void main(){vec4 pos=a_pos;pos.z=pos.z+pos.w*getTransitionValue(a_pre_height,a_height,dataTime,riseTime);v_position=pos.xyz;v_height=a_height;\n#if defined(USE_TEXTURE)\nif(u_use_texture){v_texture_coord=a_texture_coord;}\n#endif\nvec4 position=u_proj_matrix*u_mv_matrix*vec4(pos.xyz,1.0);gl_Position=position;vec4 icolor=a_color;\n#if defined(PICK)\nif(mapvIsPicked()){icolor=uSelectedColor;}\n#endif\nif(u_use_lighting){vec3 N=normalize(vec3(u_normal_matrix*vec4(a_normal,1.0)));vec4 point_dir=u_mv_matrix*vec4(0,1,0,0);vec3 L_point=normalize(point_dir.xyz);float lambert_point=max(0.0,dot(N,-L_point));vec4 light_dir=u_mv_matrix*vec4(u_side_light_dir,0);vec3 L=normalize(light_dir.xyz);float lambert=max(0.0,dot(N,-L));if(pos.z<5.0){float deepGradientColor=(5.0-pos.z)/8.0;lambert=lambert-deepGradientColor;}vec4 light_dir_2=u_mv_matrix*vec4(0,0,-1,0);vec3 L2=normalize(light_dir_2.xyz);float lambert_2=max(0.0,dot(N,-L2));if(a_pre_color.r==a_color.r&&a_pre_color.g==a_color.g&&a_pre_color.b==a_color.b){}else{if(riseTime>0.0&&dataTime<riseTime){icolor.r=a_pre_color.r+(a_color.r-a_pre_color.r)*(dataTime/riseTime);icolor.g=a_pre_color.g+(a_color.g-a_pre_color.g)*(dataTime/riseTime);icolor.b=a_pre_color.b+(a_color.b-a_pre_color.b)*(dataTime/riseTime);}}v_color.rgb=icolor.rgb+icolor.rgb*light_color*lambert+icolor.rgb*light_color_2*lambert_2+icolor.rgb*point_color*lambert_point;v_color.a=icolor.a;if(u_use_texture){mat3 normalMatrix=mat3(u_normal_matrix);vec3 transformedNormal=normalMatrix*a_normal;vec3 dir=uLightingDirection;dir=vec3(normalMatrix*vec3(0.0,-1.0,2.0));float directionalLightWeighting=max(dot(normalize(transformedNormal),normalize(dir)),0.0);vec4 vLightWeighting;vLightWeighting=vec4(uAmbientColor+uDirectionalColor*directionalLightWeighting,1.0);v_color=vLightWeighting;}}else{v_color=icolor;}}",
fragmentShader:"precision highp float;varying vec4 v_color;varying vec3 v_position;varying float v_height;varying vec2 v_texture_coord;uniform vec3 u_ripple_center;uniform vec4 top_color;uniform float u_radius;uniform float style;uniform float alpha;uniform float time;uniform sampler2D u_sampler;uniform bool u_use_lighting;uniform bool u_use_texture;void main(){vec4 color=vec4(v_color);vec4 textureColor=vec4(1.0,1.0,1.0,1.0);if(u_use_texture){if(style==6.0){float x=v_texture_coord.s;float y=v_texture_coord.t;vec2 cPos=-1.0+2.0*gl_FragCoord.xy/MAPV_resolution;float cLength=length(cPos);vec2 uv=gl_FragCoord.xy/MAPV_resolution+(cPos/cLength)*cos(cLength*12.0-time/1000.0*4.0)*0.03;textureColor=texture2D(u_sampler,uv/2.0+vec2(x,y));}else{textureColor=texture2D(u_sampler,vec2(v_texture_coord.s,v_texture_coord.t));}if(u_use_lighting){color=vec4(textureColor*v_color*1.1);}else{color=textureColor;}}if(style==1.0||style==2.0){float t=time/1000.0;float diffDistance=5.0;float modX=mod(v_position.x,diffDistance*2.0);float modZ=mod(v_position.z,diffDistance*2.0);if(modX<diffDistance&&modZ<diffDistance&&v_position.z<v_height){color*=1.05;if(time>0.0&&style==2.0){float iX=ceil(v_position.x/diffDistance);float iZ=ceil(v_position.z/diffDistance);float timeDistance=8.0;t+=tan(sin(iZ));color*=(1.0+mod(t,timeDistance)/timeDistance);}}color.a=alpha;}else if(style==5.0){float t=time/1000.0;float diffDistance=10.0;float modZ=mod(v_position.z-t*40.0,diffDistance*2.0);color.a=1.0-pow(v_position.z/v_height,0.5);if(v_position.z/v_height<0.3){color.r+=0.2;color.g+=0.2;color.b+=0.2;}if(modZ<diffDistance*2.0-4.0){discard;}}else if(style==3.0){float diffDistance=10.0;float modX=mod(v_position.x,diffDistance*2.0);color.a=1.0-pow(v_position.z/v_height,0.3);}else if(style==4.0){float dis=distance(u_ripple_center,v_position);float rSize=400.0;if(v_position.z>=v_height){color=top_color;}if(dis>u_radius-rSize&&dis<u_radius+rSize){color*=(1.0-abs(dis-u_radius)/rSize)*2.0+1.0;}}else if(style==6.0){}gl_FragColor=color;}",
defines:c},this);this.vertexBuffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.colorBuffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.heightBuffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.textureBuffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.indexBuffer=new L({gl:a,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});c=[{name:"a_pos",buffer:this.vertexBuffer,stride:28,size:4,type:"FLOAT",offset:0},{name:"a_normal",buffer:this.vertexBuffer,
size:3,stride:28,type:"FLOAT",offset:16},{name:"a_color",buffer:this.colorBuffer,size:4,stride:32,type:"FLOAT",offset:0},{name:"a_pre_color",buffer:this.colorBuffer,size:4,stride:32,type:"FLOAT",offset:16},{name:"a_height",buffer:this.heightBuffer,size:1,stride:8,type:"FLOAT",offset:0},{name:"a_pre_height",buffer:this.heightBuffer,size:1,stride:8,type:"FLOAT",offset:4}];b.texture&&c.push({name:"a_texture_coord",buffer:this.textureBuffer,size:2,stride:8,type:"FLOAT",offset:0});c=c.concat(this.getCommonAttributes());
this.vertexArray=new sa({gl:a,program:this.program,attributes:c});this.initializeTime=new Date;this.normalMatrix=T.create()}},{key:"onChanged",value:function(a,c){var b=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout(function(){b.loadTexture(function(){b.dataMgr.parseData(c);b.dataTime=new Date;b.webglLayer.render()})},0))}},{key:"render",value:function(a){var b=a.gl,c=a.projectionMatrix,k=a.viewMatrix;if(this._isShow){var g=this.getData();if(g&&
!(0>=g.length)){g=this.getOptions();var h=this.program;h.use(b);if(!g.texture||this.texture){b.disable(b.CULL_FACE);g.blend&&(b.enable(b.BLEND),b.blendFunc(b.ONE,b.ONE),b.blendEquation(b.FUNC_ADD));0===g.height&&(b.enable(b.BLEND),b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA));var m=0;g.style&&Ae[g.style]&&(m=Ae[g.style]);"gradual"===g.style?(b.depthMask(!1),b.enable(b.BLEND),b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA)):b.depthMask(!0);var n=this.normizedColor(g.topColor);if("ripple"===g.style&&
g.rippleLayer&&g.rippleLayer.data&&g.rippleLayer.data[0]){var p=this.normizedPoint(g.rippleLayer.data[0].geometry.coordinates);h.setUniforms({u_ripple_center:[p[0],p[1],0],u_radius:g.rippleLayer.options.size*g.rippleLayer.currentScale})}p=Ib.fromValues(0,-1,2);g.lightDir&&(p=Ib.fromValues(g.lightDir[0],g.lightDir[1],g.lightDir[2]));var l=this.normalMatrix;T.invert(l,k);T.transpose(l,l);h.setUniforms(U(this.getCommonUniforms(a),{u_normal_matrix:l,u_sampler:this.texture,u_proj_matrix:c,u_mv_matrix:k,
style:m,top_color:n,u_use_lighting:g.useLight,u_use_texture:this.isUseTexture,alpha:void 0===g.opacity?.8:parseFloat(g.opacity),time:new Date-this.initializeTime,dataTime:new Date-this.dataTime,riseTime:g.riseTime,u_side_light_dir:p}));a=this.dataMgr.getData();0<a.vertex.length&&(this.vertexArray.bind(),this.indexBuffer.bind(),b.drawElements(b.TRIANGLES,a.index.length,b.UNSIGNED_INT,0))}}}else this.webglLayer.clear()}},{key:"loadTexture",value:function(a){var b=this,c=this.getOptions();c.texture?
(this.isUseTexture=!0,Ia(this.gl,c.texture,function(c,d){b.image=d;b.texture=c;a&&a();b.webglLayer.render()})):(this.isUseTexture=!1,this.image=this.texture=null,a&&a())}}]);return a}(da);Ta.prototype.initData=function(){this.outBuilding3d={pickColorVertex:[],vertex:[],texture:[],color:[],height:[],index:[]}};Ta.prototype.getData=function(){return this.outBuilding3d};Ta.prototype.initWorker=function(){this.worker=new Fg;this.worker.onmessage=function(c){}};Ta.prototype.parseData=function(c){var a=
this;this.initData();for(var b=this.shapeLayer.getOptions(),d=0;d<c.length;d++){var f=c[d],k=f.height||0;"properties"in f&&"height"in f.properties&&(k=f.properties.height);k*=1;var g=f.color||b.color;"properties"in f&&"color"in f.properties&&(g=f.properties.color);"[object Function]"===Object.prototype.toString.call(g)&&(g=g(f));g=this.shapeLayer.normizedColor(g);var h=void 0;b.enablePicked&&(h=this.shapeLayer.indexToRgb(d));var m=void 0,n=void 0;b.riseTime&&(n=f.preColor,"properties"in f&&"preColor"in
f.properties&&(n=f.properties.preColor),m=f.preHeight,"properties"in f&&"preHeight"in f.properties&&(m=f.properties.preHeight),void 0===m&&(m=0));if(f.geometry.coordinates)if("MultiPolygon"===f.geometry.type)for(var p=f.geometry.coordinates,l=function(b){var c=[],d=[];f.geometry.coordinates[b][0].forEach(function(b){b=a.shapeLayer.normizedPoint(b);c.push(b[0],b[1]);d.push(b[2])});a.parseBuilding3d(c,d,m,k,n,g,h,a.outBuilding3d)},r=0;r<p.length;r++)l(r);else(function(){var b=[],c=[];f.geometry.coordinates[0].forEach(function(d){d=
a.shapeLayer.normizedPoint(d);b.push(d[0],d[1]);c.push(d[2])});a.parseBuilding3d(b,c,m,k,n,g,h,a.outBuilding3d)})()}this.shapeLayer.vertexBuffer.updateData(new Float32Array(this.outBuilding3d.vertex));this.shapeLayer.colorBuffer.updateData(new Float32Array(this.outBuilding3d.color));this.shapeLayer.heightBuffer.updateData(new Float32Array(this.outBuilding3d.height));this.shapeLayer.textureBuffer.updateData(new Float32Array(this.outBuilding3d.texture));this.shapeLayer.indexBuffer.updateData(new Uint32Array(this.outBuilding3d.index));
b.enablePicked&&this.shapeLayer.pickBuffer.updateData(new Float32Array(this.outBuilding3d.pickColorVertex))};Ta.prototype.getBounds=function(c){for(var a=c[0],b=c[1],d=c[0],f=c[1],k=0;k<c.length;k+=2)a=Math.min(c[k],a),b=Math.min(c[k+1],b),d=Math.max(c[k],d),f=Math.max(c[k+1],f);return{minX:a,minY:b,maxX:d,maxY:f,width:d-a,height:f-b}};Ta.prototype.parseBuilding3d=function(c,a,b,d,f,k,g,h){void 0===b&&(b=d);var m=this.shapeLayer.options,n=h.vertex,p=h.texture,l=h.color,r=h.height,q=h.pickColorVertex;
h=h.index;void 0===f&&(f=k);var t=0,v=0;this.shapeLayer.image&&(t=this.shapeLayer.image.width*m.textureScale,v=this.shapeLayer.image.height*m.textureScale);if("gradual"!=m.style){var w=nb(c),x=w[0],u=w[1],A=w[2];x=[c[2*x],c[2*x+1],1];u=[c[2*u],c[2*u+1],1];var y=[c[2*A],c[2*A+1],1];A=[];Ib.cross(A,[y[0]-u[0],y[1]-u[1],y[2]-u[2]],[x[0]-u[0],x[1]-u[1],x[2]-u[2]]);u=n.length/7;if(m.texture)var z=this.getBounds(c);x=m.isTextureFull;y=0;for(var B=c.length;y<B;y+=2)n.push(c[y],c[y+1],a[y/2],1,A[0],A[1],
A[2]),l.push(k[0],k[1],k[2],k[3],f[0],f[1],f[2],f[3]),r.push(d,b),m.texture&&(x?(p.push((c[y]-z.minX)/z.width),p.push((c[y+1]-z.minY)/z.height)):(p.push((c[y]-z.minX)/t),p.push((c[y+1]-z.minY)/v))),g&&q.push(g[0]/255,g[1]/255,g[2]/255);z=0;for(A=w.length;z<A;z++)h.push(w[z]+u)}if(!(d===b&&0>=d))for(w=0,z=c.length;w<z;w+=2){A=n.length/7;var C=c[w],J=c[w+1];u=[C,J,a[w/2],0];y=[C,J,a[w/2],1];B=w+2;var D=w+3;w===z-2&&(B=0,D=1);B=c[B];D=c[D];C=Math.sqrt(Math.pow(B-C,2),Math.pow(D-J,2));J=[B,D,a[w/2],0];
B=[B,D,a[w/2],1];D=[];Ib.cross(D,[J[0]-u[0],J[1]-u[1],J[2]-u[2]],[y[0]-u[0],y[1]-u[1],y[2]-u[2]]);n.push(u[0],u[1],u[2],u[3]);n.push(D[0],D[1],D[2]);n.push(y[0],y[1],y[2],y[3]);n.push(D[0],D[1],D[2]);n.push(J[0],J[1],J[2],J[3]);n.push(D[0],D[1],D[2]);n.push(B[0],B[1],B[2],B[3]);n.push(D[0],D[1],D[2]);l.push(k[0],k[1],k[2],k[3]);l.push(f[0],f[1],f[2],f[3]);l.push(k[0],k[1],k[2],k[3]);l.push(f[0],f[1],f[2],f[3]);l.push(k[0],k[1],k[2],k[3]);l.push(f[0],f[1],f[2],f[3]);l.push(k[0],k[1],k[2],k[3]);l.push(f[0],
f[1],f[2],f[3]);r.push(d);r.push(b);r.push(d);r.push(b);r.push(d);r.push(b);r.push(d);r.push(b);m.texture&&(x?(p.push(0,0),p.push(0,1),p.push(1,0),p.push(1,1)):(p.push(0,0),p.push(0,d/v),p.push(C/t,0),p.push(C/t,d/v)));g&&(q.push(g[0]/255,g[1]/255,g[2]/255),q.push(g[0]/255,g[1]/255,g[2]/255),q.push(g[0]/255,g[1]/255,g[2]/255),q.push(g[0]/255,g[1]/255,g[2]/255));h.push(A,A+2,A+3,A,A+3,A+1)}};var Be=function(c){function a(b,c){E(this,a);b=M(this,(a.__proto__||I(a)).call(this,b,c));b.preHeightMapper=
{};b.preColorMapper={};return b}G(a,c);F(a,[{key:"getDefaultOptions",value:function(){return U(Ra(a.prototype.__proto__||I(a.prototype),"getDefaultOptions",this).call(this),{style:"grid",gridSize:500,height:function(){return 1E3},color:function(){return"rgb(200, 200, 20)"}})}},{key:"generateGrid",value:function(a,c){var b=c.gridSize,d=[],g={};c=a.length;for(var h=this.getPointOffset(),m=0;m<c;m++){var n=this.normizedPoint(a[m].geometry.coordinates);n=~~((n[0]+h[0])/b)+"_"+~~((n[1]+h[1])/b);void 0===
g[n]&&(g[n]=0);var p=~~a[m].count||1;"properties"in a[m]&&"count"in a[m].properties&&(p=~~a[m].properties.count);g[n]+=p}wa(g).forEach(function(a){var c=a.split("_");d.push([c[0]*b+b/2,c[1]*b+b/2,g[a]])});return d}},{key:"onChanged",value:function(b,c){c=this.processData(c);Ra(a.prototype.__proto__||I(a.prototype),"onChanged",this).call(this,b,c)}},{key:"getGridDataRange",value:function(){var a=this.gridData,c=void 0,f=void 0;a[0]&&(c=a[0][2],f=a[0][2]);for(var k=a.length,g=0;g<k;g++){var h=a[g];
c=Math.max(h[2],c);f=Math.min(h[2],f)}return{max:c/2,min:f}}},{key:"processData",value:function(a){var b=this.getOptions(),c=b.style,k=b.gridSize,g=[];this.gridData=g;if("normal"===c){c=this.getPointOffset();for(var h=0;h<a.length;h++){var m=this.normizedPoint(a[h].geometry.coordinates),n=m[0]+c[0];m=m[1]+c[1];var p=~~a[h].count||1;"properties"in a[h]&&"count"in a[h].properties&&(p=~~a[h].properties.count);var l=a[h].color;"properties"in a[h]&&"color"in a[h].properties&&(l=~~a[h].properties.color);
g.push([n,m,p,l])}}else g=this.generateGrid(a,b);a=[];this._preHeightMapper={};this._preColorMapper={};for(c=0;c<g.length;c++)h=g[c],h[0]=h[0],h[1]=h[1],n=h[2],b.height&&(n="function"===typeof b.height?b.height({count:h[2]}):b.height),m=k/2-5,p=h[3],b.color&&(p="function"===typeof b.color?b.color({count:h[2],color:h[3]}):ba(p).unitArray()),l="p"+h[0]+h[1],a.push({geometry:{type:"Polygon",coordinates:[[[h[0]-m,h[1]-m],[h[0]-m,h[1]+m],[h[0]+m,h[1]+m],[h[0]+m,h[1]-m]]]},color:p,preHeight:this.preHeightMapper[l],
preColor:this.preColorMapper[l],height:n}),this._preHeightMapper[l]=n,this._preColorMapper[l]=p;this.preHeightMapper=this._preHeightMapper;this.preColorMapper=this._preColorMapper;return a}}]);return a}(ic),ib=function(c){function a(b){E(this,a);return M(this,(a.__proto__||I(a)).call(this,b))}G(a,c);F(a,[{key:"initialize",value:function(a){var b=this;this.children&&this.children.forEach(function(c){c.map=b.map;c.setWebglLayer(b.getWebglLayer());c.commonInitialize&&c.commonInitialize(a);c.initialize&&
c.initialize(a);c.onOptionsChanged(c.getOptions());c.onDataChanged(c.getData());c.onChanged(c.getOptions(),c.getData())})}},{key:"isRequestAnimation",value:function(){if(void 0!==this.autoUpdate)return Ra(a.prototype.__proto__||I(a.prototype),"isRequestAnimation",this).call(this);for(var b=!1,c=0;c<this.children.length;c++)if(this.children[c].isRequestAnimation()){b=!0;break}return b}},{key:"render",value:function(a){this.children&&this.children.forEach(function(b){b.render(a)})}}]);return a}(Pc),
Gg=function(c){function a(b,c){E(this,a);b=M(this,(a.__proto__||I(a)).call(this,b,c));b.gridLayer=new Be(b.getGridOptions());b.children=[b.gridLayer];b.options.riseTime&&(b.autoUpdate=!0);return b}G(a,c);F(a,[{key:"onDataChanged",value:function(a){this.gridLayer.setData(a)}},{key:"getGridOptions",value:function(){var a=this.getOptions(),c=a.max,f=a.min;void 0===c&&(f=this.gridLayer.getGridDataRange(),c=f.max,f=f.min);var k=new ia({max:c,min:f,gradient:a.gradient,maxSize:a.maxHeight,minSize:a.minHeight});
a.height=function(a){var b=k.getSize(a.count);"properties"in a&&"count"in a.properties&&(b=k.getSize(a.properties.count));return b};a.color=function(a){var b=k.getImageData(a.count);"properties"in a&&"count"in a.properties&&(b=k.getImageData(a.properties.count));return[b[0]/255,b[1]/255,b[2]/255]};return a}},{key:"onOptionsChanged",value:function(a){this.gridLayer.setOptions(this.getGridOptions())}},{key:"getDefaultOptions",value:function(){return{style:"grid",gridSize:500,maxHeight:8E3,minHeight:200,
gradient:{0:"rgb(50, 50, 256)","0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}}}}]);return a}(ib),Ce=function(c){function a(b,c){E(this,a);b=M(this,(a.__proto__||I(a)).call(this,b,c));b.bufferData=[];return b}G(a,c);F(a,[{key:"initialize",value:function(a){this.gl=a;var b=this.getOptions();this.program=new Q(this.gl,{vertexShader:"uniform mat4 u_matrix;attribute vec3 aPos;attribute vec4 aColor;varying vec4 vColor;\n#if defined(DASH)\nvarying vec3 vPos;\n#endif\nvoid main(){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=u_matrix*vec4(aPos,1.0);\n#if defined(DASH)\nvPos=aPos;\n#endif\n}",
fragmentShader:"precision highp float;varying vec4 vColor;varying vec3 vPos;void main(){\n#if defined(DASH)\nif(mod(vPos.x,3.0)<1.5){discard;}\n#endif\ngl_FragColor=vColor;}",defines:b.useDash?["DASH"]:""},this);this.buffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.vertexArray=new sa({gl:a,program:this.program,attributes:[{stride:28,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:28,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:12}]})}},{key:"onChanged",
value:function(a,c){var b=this;if(this.gl){var d=[],g=function(a,c){if(a)for(var f=0;f<a.length-1;f++){var g=b.normizedPoint(a[f]);d.push(g[0]);d.push(g[1]);d.push(g[2]);d.push(c[0],c[1],c[2],c[3]);g=b.normizedPoint(a[f+1]);d.push(g[0]);d.push(g[1]);d.push(g[2]);d.push(c[0],c[1],c[2],c[3])}};a=a.color;for(var h=0;h<c.length;h++){var m=c[h].color||a;"properties"in c[h]&&"color"in c[h].properties&&(m=c[h].properties.color);"[object Function]"===Object.prototype.toString.call(m)&&(m=m(c[h]));m=this.normizedColor(m);
var n=c[h].geometry,p=n.coordinates;if("MultiPolygon"===n.type){if(p)for(n=0;n<p.length;n++)g(p[n][0],m)}else if("Polygon"===n.type)p&&g(p[0],m);else if("MultiLineString"===n.type){if(p)for(n=0;n<p.length;n++)g(p[n],m)}else g(p,m)}this.bufferData=d;this.buffer.updateData(new Float32Array(d))}}},{key:"render",value:function(a){var b=a.gl;a=a.matrix;if(this.bufferData&&!(0>=this.bufferData.length)){var c=this.program;c.use(b);this.vertexArray.bind();c.setUniforms({u_matrix:a});a=this.getOptions().blend;
b.enable(b.BLEND);b.blendEquation(b.FUNC_ADD);a&&"lighter"===a?b.blendFunc(b.SRC_ALPHA,b.ONE):b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);b.drawArrays(b.LINES,0,this.bufferData.length/7);b.disable(b.BLEND)}}}]);return a}(da),Hg=bc.f("species"),Ig=H(function(c){c.exports={"default":Hg,__esModule:!0}});K(Ig);var De="undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{},Da=[],ta=[],Ze="undefined"!==typeof Uint8Array?Uint8Array:Array,wc=!1,Jg={}.toString,
pd=Array.isArray||function(c){return"[object Array]"==Jg.call(c)};v.TYPED_ARRAY_SUPPORT=void 0!==De.TYPED_ARRAY_SUPPORT?De.TYPED_ARRAY_SUPPORT:!0;v.poolSize=8192;v._augment=function(c){c.__proto__=v.prototype;return c};v.from=function(c,a,b){return md(null,c,a,b)};v.TYPED_ARRAY_SUPPORT&&(v.prototype.__proto__=Uint8Array.prototype,v.__proto__=Uint8Array);v.alloc=function(c,a,b){od(c);c=0>=c?Ja(null,c):void 0!==a?"string"===typeof b?Ja(null,c).fill(a,b):Ja(null,c).fill(a):Ja(null,c);return c};v.allocUnsafe=
function(c){return xc(null,c)};v.allocUnsafeSlow=function(c){return xc(null,c)};v.isBuffer=function(c){return null!=c&&(!!c._isBuffer||zd(c)||"function"===typeof c.readFloatLE&&"function"===typeof c.slice&&zd(c.slice(0,0)))};v.compare=function(c,a){if(!Ea(c)||!Ea(a))throw new TypeError("Arguments must be Buffers");if(c===a)return 0;for(var b=c.length,d=a.length,f=0,k=Math.min(b,d);f<k;++f)if(c[f]!==a[f]){b=c[f];d=a[f];break}return b<d?-1:d<b?1:0};v.isEncoding=function(c){switch(String(c).toLowerCase()){case "hex":case "utf8":case "utf-8":case "ascii":case "latin1":case "binary":case "base64":case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return!0;
default:return!1}};v.concat=function(c,a){if(!pd(c))throw new TypeError('"list" argument must be an Array of Buffers');if(0===c.length)return v.alloc(0);var b;if(void 0===a)for(b=a=0;b<c.length;++b)a+=c[b].length;a=v.allocUnsafe(a);var d=0;for(b=0;b<c.length;++b){var f=c[b];if(!Ea(f))throw new TypeError('"list" argument must be an Array of Buffers');f.copy(a,d);d+=f.length}return a};v.byteLength=nd;v.prototype._isBuffer=!0;v.prototype.swap16=function(){var c=this.length;if(0!==c%2)throw new RangeError("Buffer size must be a multiple of 16-bits");
for(var a=0;a<c;a+=2)Ua(this,a,a+1);return this};v.prototype.swap32=function(){var c=this.length;if(0!==c%4)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var a=0;a<c;a+=4)Ua(this,a,a+3),Ua(this,a+1,a+2);return this};v.prototype.swap64=function(){var c=this.length;if(0!==c%8)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var a=0;a<c;a+=8)Ua(this,a,a+7),Ua(this,a+1,a+6),Ua(this,a+2,a+5),Ua(this,a+3,a+4);return this};v.prototype.toString=function(){var c=
this.length|0;return 0===c?"":0===arguments.length?rd(this,0,c):Xe.apply(this,arguments)};v.prototype.equals=function(c){if(!Ea(c))throw new TypeError("Argument must be a Buffer");return this===c?!0:0===v.compare(this,c)};v.prototype.inspect=function(){var c="";0<this.length&&(c=this.toString("hex",0,50).match(/.{2}/g).join(" "),50<this.length&&(c+=" ... "));return"<Buffer "+c+">"};v.prototype.compare=function(c,a,b,d,f){if(!Ea(c))throw new TypeError("Argument must be a Buffer");void 0===a&&(a=0);
void 0===b&&(b=c?c.length:0);void 0===d&&(d=0);void 0===f&&(f=this.length);if(0>a||b>c.length||0>d||f>this.length)throw new RangeError("out of range index");if(d>=f&&a>=b)return 0;if(d>=f)return-1;if(a>=b)return 1;a>>>=0;b>>>=0;d>>>=0;f>>>=0;if(this===c)return 0;var k=f-d,g=b-a,h=Math.min(k,g);d=this.slice(d,f);c=c.slice(a,b);for(a=0;a<h;++a)if(d[a]!==c[a]){k=d[a];g=c[a];break}return k<g?-1:g<k?1:0};v.prototype.includes=function(c,a,b){return-1!==this.indexOf(c,a,b)};v.prototype.indexOf=function(c,
a,b){return sd(this,c,a,b,!0)};v.prototype.lastIndexOf=function(c,a,b){return sd(this,c,a,b,!1)};v.prototype.write=function(c,a,b,d){if(void 0===a)d="utf8",b=this.length,a=0;else if(void 0===b&&"string"===typeof a)d=a,b=this.length,a=0;else if(isFinite(a))a|=0,isFinite(b)?(b|=0,void 0===d&&(d="utf8")):(d=b,b=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var f=this.length-a;if(void 0===b||b>f)b=f;if(0<c.length&&(0>b||0>a)||a>this.length)throw new RangeError("Attempt to write outside buffer bounds");
d||(d="utf8");for(f=!1;;)switch(d){case "hex":a:{a=Number(a)||0;d=this.length-a;b?(b=Number(b),b>d&&(b=d)):b=d;d=c.length;if(0!==d%2)throw new TypeError("Invalid hex string");b>d/2&&(b=d/2);for(d=0;d<b;++d){f=parseInt(c.substr(2*d,2),16);if(isNaN(f)){c=d;break a}this[a+d]=f}c=d}return c;case "utf8":case "utf-8":return sb(Pb(c,this.length-a),this,a,b);case "ascii":return sb(yd(c),this,a,b);case "latin1":case "binary":return sb(yd(c),this,a,b);case "base64":return sb(qd(c),this,a,b);case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":d=
c;f=this.length-a;for(var k=[],g=0;g<d.length&&!(0>(f-=2));++g){var h=d.charCodeAt(g);c=h>>8;h%=256;k.push(h);k.push(c)}return sb(k,this,a,b);default:if(f)throw new TypeError("Unknown encoding: "+d);d=(""+d).toLowerCase();f=!0}};v.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var ud=4096;v.prototype.slice=function(c,a){var b=this.length;c=~~c;a=void 0===a?b:~~a;0>c?(c+=b,0>c&&(c=0)):c>b&&(c=b);0>a?(a+=b,0>a&&(a=0)):a>b&&(a=b);a<c&&(a=c);if(v.TYPED_ARRAY_SUPPORT)a=
this.subarray(c,a),a.__proto__=v.prototype;else{b=a-c;a=new v(b,void 0);for(var d=0;d<b;++d)a[d]=this[d+c]}return a};v.prototype.readUIntLE=function(c,a,b){c|=0;a|=0;b||ea(c,a,this.length);b=this[c];for(var d=1,f=0;++f<a&&(d*=256);)b+=this[c+f]*d;return b};v.prototype.readUIntBE=function(c,a,b){c|=0;a|=0;b||ea(c,a,this.length);b=this[c+--a];for(var d=1;0<a&&(d*=256);)b+=this[c+--a]*d;return b};v.prototype.readUInt8=function(c,a){a||ea(c,1,this.length);return this[c]};v.prototype.readUInt16LE=function(c,
a){a||ea(c,2,this.length);return this[c]|this[c+1]<<8};v.prototype.readUInt16BE=function(c,a){a||ea(c,2,this.length);return this[c]<<8|this[c+1]};v.prototype.readUInt32LE=function(c,a){a||ea(c,4,this.length);return(this[c]|this[c+1]<<8|this[c+2]<<16)+16777216*this[c+3]};v.prototype.readUInt32BE=function(c,a){a||ea(c,4,this.length);return 16777216*this[c]+(this[c+1]<<16|this[c+2]<<8|this[c+3])};v.prototype.readIntLE=function(c,a,b){c|=0;a|=0;b||ea(c,a,this.length);b=this[c];for(var d=1,f=0;++f<a&&
(d*=256);)b+=this[c+f]*d;b>=128*d&&(b-=Math.pow(2,8*a));return b};v.prototype.readIntBE=function(c,a,b){c|=0;a|=0;b||ea(c,a,this.length);b=a;for(var d=1,f=this[c+--b];0<b&&(d*=256);)f+=this[c+--b]*d;f>=128*d&&(f-=Math.pow(2,8*a));return f};v.prototype.readInt8=function(c,a){a||ea(c,1,this.length);return this[c]&128?-1*(255-this[c]+1):this[c]};v.prototype.readInt16LE=function(c,a){a||ea(c,2,this.length);c=this[c]|this[c+1]<<8;return c&32768?c|4294901760:c};v.prototype.readInt16BE=function(c,a){a||
ea(c,2,this.length);c=this[c+1]|this[c]<<8;return c&32768?c|4294901760:c};v.prototype.readInt32LE=function(c,a){a||ea(c,4,this.length);return this[c]|this[c+1]<<8|this[c+2]<<16|this[c+3]<<24};v.prototype.readInt32BE=function(c,a){a||ea(c,4,this.length);return this[c]<<24|this[c+1]<<16|this[c+2]<<8|this[c+3]};v.prototype.readFloatLE=function(c,a){a||ea(c,4,this.length);return Ob(this,c,!0,23,4)};v.prototype.readFloatBE=function(c,a){a||ea(c,4,this.length);return Ob(this,c,!1,23,4)};v.prototype.readDoubleLE=
function(c,a){a||ea(c,8,this.length);return Ob(this,c,!0,52,8)};v.prototype.readDoubleBE=function(c,a){a||ea(c,8,this.length);return Ob(this,c,!1,52,8)};v.prototype.writeUIntLE=function(c,a,b,d){c=+c;a|=0;b|=0;d||la(this,c,a,b,Math.pow(2,8*b)-1,0);d=1;var f=0;for(this[a]=c&255;++f<b&&(d*=256);)this[a+f]=c/d&255;return a+b};v.prototype.writeUIntBE=function(c,a,b,d){c=+c;a|=0;b|=0;d||la(this,c,a,b,Math.pow(2,8*b)-1,0);d=b-1;var f=1;for(this[a+d]=c&255;0<=--d&&(f*=256);)this[a+d]=c/f&255;return a+b};
v.prototype.writeUInt8=function(c,a,b){c=+c;a|=0;b||la(this,c,a,1,255,0);v.TYPED_ARRAY_SUPPORT||(c=Math.floor(c));this[a]=c&255;return a+1};v.prototype.writeUInt16LE=function(c,a,b){c=+c;a|=0;b||la(this,c,a,2,65535,0);v.TYPED_ARRAY_SUPPORT?(this[a]=c&255,this[a+1]=c>>>8):Qb(this,c,a,!0);return a+2};v.prototype.writeUInt16BE=function(c,a,b){c=+c;a|=0;b||la(this,c,a,2,65535,0);v.TYPED_ARRAY_SUPPORT?(this[a]=c>>>8,this[a+1]=c&255):Qb(this,c,a,!1);return a+2};v.prototype.writeUInt32LE=function(c,a,b){c=
+c;a|=0;b||la(this,c,a,4,4294967295,0);v.TYPED_ARRAY_SUPPORT?(this[a+3]=c>>>24,this[a+2]=c>>>16,this[a+1]=c>>>8,this[a]=c&255):Rb(this,c,a,!0);return a+4};v.prototype.writeUInt32BE=function(c,a,b){c=+c;a|=0;b||la(this,c,a,4,4294967295,0);v.TYPED_ARRAY_SUPPORT?(this[a]=c>>>24,this[a+1]=c>>>16,this[a+2]=c>>>8,this[a+3]=c&255):Rb(this,c,a,!1);return a+4};v.prototype.writeIntLE=function(c,a,b,d){c=+c;a|=0;d||(d=Math.pow(2,8*b-1),la(this,c,a,b,d-1,-d));d=0;var f=1,k=0;for(this[a]=c&255;++d<b&&(f*=256);)0>
c&&0===k&&0!==this[a+d-1]&&(k=1),this[a+d]=(c/f>>0)-k&255;return a+b};v.prototype.writeIntBE=function(c,a,b,d){c=+c;a|=0;d||(d=Math.pow(2,8*b-1),la(this,c,a,b,d-1,-d));d=b-1;var f=1,k=0;for(this[a+d]=c&255;0<=--d&&(f*=256);)0>c&&0===k&&0!==this[a+d+1]&&(k=1),this[a+d]=(c/f>>0)-k&255;return a+b};v.prototype.writeInt8=function(c,a,b){c=+c;a|=0;b||la(this,c,a,1,127,-128);v.TYPED_ARRAY_SUPPORT||(c=Math.floor(c));0>c&&(c=255+c+1);this[a]=c&255;return a+1};v.prototype.writeInt16LE=function(c,a,b){c=+c;
a|=0;b||la(this,c,a,2,32767,-32768);v.TYPED_ARRAY_SUPPORT?(this[a]=c&255,this[a+1]=c>>>8):Qb(this,c,a,!0);return a+2};v.prototype.writeInt16BE=function(c,a,b){c=+c;a|=0;b||la(this,c,a,2,32767,-32768);v.TYPED_ARRAY_SUPPORT?(this[a]=c>>>8,this[a+1]=c&255):Qb(this,c,a,!1);return a+2};v.prototype.writeInt32LE=function(c,a,b){c=+c;a|=0;b||la(this,c,a,4,2147483647,-2147483648);v.TYPED_ARRAY_SUPPORT?(this[a]=c&255,this[a+1]=c>>>8,this[a+2]=c>>>16,this[a+3]=c>>>24):Rb(this,c,a,!0);return a+4};v.prototype.writeInt32BE=
function(c,a,b){c=+c;a|=0;b||la(this,c,a,4,2147483647,-2147483648);0>c&&(c=4294967295+c+1);v.TYPED_ARRAY_SUPPORT?(this[a]=c>>>24,this[a+1]=c>>>16,this[a+2]=c>>>8,this[a+3]=c&255):Rb(this,c,a,!1);return a+4};v.prototype.writeFloatLE=function(c,a,b){return wd(this,c,a,!0,b)};v.prototype.writeFloatBE=function(c,a,b){return wd(this,c,a,!1,b)};v.prototype.writeDoubleLE=function(c,a,b){return xd(this,c,a,!0,b)};v.prototype.writeDoubleBE=function(c,a,b){return xd(this,c,a,!1,b)};v.prototype.copy=function(c,
a,b,d){b||(b=0);d||0===d||(d=this.length);a>=c.length&&(a=c.length);a||(a=0);0<d&&d<b&&(d=b);if(d===b||0===c.length||0===this.length)return 0;if(0>a)throw new RangeError("targetStart out of bounds");if(0>b||b>=this.length)throw new RangeError("sourceStart out of bounds");if(0>d)throw new RangeError("sourceEnd out of bounds");d>this.length&&(d=this.length);c.length-a<d-b&&(d=c.length-a+b);var f=d-b;if(this===c&&b<a&&a<d)for(d=f-1;0<=d;--d)c[d+a]=this[d+b];else if(1E3>f||!v.TYPED_ARRAY_SUPPORT)for(d=
0;d<f;++d)c[d+a]=this[d+b];else Uint8Array.prototype.set.call(c,this.subarray(b,b+f),a);return f};v.prototype.fill=function(c,a,b,d){if("string"===typeof c){"string"===typeof a?(d=a,a=0,b=this.length):"string"===typeof b&&(d=b,b=this.length);if(1===c.length){var f=c.charCodeAt(0);256>f&&(c=f)}if(void 0!==d&&"string"!==typeof d)throw new TypeError("encoding must be a string");if("string"===typeof d&&!v.isEncoding(d))throw new TypeError("Unknown encoding: "+d);}else"number"===typeof c&&(c&=255);if(0>
a||this.length<a||this.length<b)throw new RangeError("Out of range index");if(b<=a)return this;a>>>=0;b=void 0===b?this.length:b>>>0;c||(c=0);if("number"===typeof c)for(d=a;d<b;++d)this[d]=c;else for(c=Ea(c)?c:Pb((new v(c,d)).toString()),f=c.length,d=0;d<b-a;++d)this[d+a]=c[d%f];return this};var Ye=/[^+\/0-9A-Za-z-_]/g,Wc={normal:null,road:function(){var c=document.createElement("canvas");c.width=c.height=32;var a=c.getContext("2d");a.save();a.moveTo(0,0);a.lineTo(20,0);a.lineTo(32,16);a.lineTo(20,
32);a.lineTo(0,32);a.lineTo(10,16);a.fillStyle="#fff";a.fill();a.restore();return c}()},Ee=function(c){function a(b,c){E(this,a);b=M(this,(a.__proto__||I(a)).call(this,b,c));b.initData();return b}G(a,c);F(a,[{key:"getDefaultOptions",value:function(){return{color:"rgba(25, 25, 250, 1)",blend:"normal",width:4,isFlat:!0,antialias:!1,lineJoin:"miter",lineCap:"butt",style:"normal",dashArray:0,dashRatio:0,dashOffset:0}}},{key:"initData",value:function(){this.dataMgr={position:[],prev:[],next:[],direction:[],
color:[],index:[],counter:[],uv:[]}}},{key:"initialize",value:function(a){this.gl=a;var b=this.getOptions(),c=[];b.enablePicked&&c.push("PICK");Wc[b.style]&&c.push("USE_TEXTURE");this.program=new Q(this.gl,{vertexShader:"precision highp float;uniform mat4 u_matrix;uniform float thickness;uniform int miter;uniform vec4 uSelectedColor;uniform bool uFlat;uniform float zoomUnits;uniform float devicePixelRatio;attribute vec3 position;attribute vec3 next;attribute vec3 previous;attribute float direction;attribute vec4 aColor;attribute float aCounter;\n#if defined(USE_TEXTURE)\nattribute vec2 uv;\n#endif\nvarying vec4 vColor;varying vec2 vNormal;varying float vCounter;varying vec2 vUV;vec2 project(vec4 coord){vec3 screen=coord.xyz/coord.w;vec2 clip=(screen.xy+1.0)/2.0;return clip*MAPV_resolution;}vec4 unproject(vec2 projected,float z,float w){vec2 clip=projected/MAPV_resolution;vec2 screen=clip*2.0-1.0;return vec4(screen*w,z,w);}vec2 calcNormal(vec2 currentScreen,vec2 previousScreen,vec2 nextScreen){vec2 dir=vec2(0.0);if(currentScreen==previousScreen){dir=normalize(nextScreen-currentScreen);}else if(currentScreen==nextScreen){dir=normalize(currentScreen-previousScreen);}else{vec2 dirA=normalize((currentScreen-previousScreen));if(miter==1){vec2 dirB=normalize((nextScreen-currentScreen));vec2 tangent=normalize(dirA+dirB);vec2 perp=vec2(-dirA.y,dirA.x);vec2 miter=vec2(-tangent.y,tangent.x);dir=tangent;}else{dir=dirA;}}vec2 normal=vec2(-dir.y,dir.x);return normal;}void main(){vColor=aColor;vCounter=aCounter;\n#if defined(USE_TEXTURE)\nvUV=uv;\n#endif\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\nif(uFlat){float len=thickness*zoomUnits;vec2 normal=calcNormal(position.xy,previous.xy,next.xy);normal*=len/2.0;vNormal=normal*direction;gl_Position=u_matrix*vec4(position.xy+normal*direction,position.z,1.0);}else{vec4 previousProjected=u_matrix*vec4(previous,1.0);vec4 currentProjected=u_matrix*vec4(position,1.0);vec4 nextProjected=u_matrix*vec4(next,1.0);vec2 currentScreen=project(currentProjected);vec2 previousScreen=project(previousProjected);vec2 nextScreen=project(nextProjected);float len=thickness*devicePixelRatio;vec2 dir=vec2(0.0);if(currentScreen==previousScreen){dir=normalize(nextScreen-currentScreen);}else if(currentScreen==nextScreen){dir=normalize(currentScreen-previousScreen);}else{vec2 dirA=normalize((currentScreen-previousScreen));if(miter==1){vec2 dirB=normalize((nextScreen-currentScreen));vec2 tangent=normalize(dirA+dirB);vec2 perp=vec2(-dirA.y,dirA.x);vec2 miter=vec2(-tangent.y,tangent.x);dir=tangent;if(dot(dirA,dirB)>0.75){len=thickness*devicePixelRatio/dot(miter,perp);}}else{dir=dirA;}}vec2 normal=vec2(-dir.y,dir.x);normal*=len/2.0;vNormal=normal*direction;vec2 pos=currentScreen+normal*direction;vec4 finalPos=unproject(pos,currentProjected.z,currentProjected.w);gl_Position=finalPos;}}",
fragmentShader:"precision highp float;uniform bool uUseTexture;uniform bool uAntialias;varying vec4 vColor;varying vec2 vNormal;varying float vCounter;uniform float uDashOffset;uniform float uDashArray;uniform float uDashRatio;uniform float uvDelta;uniform float markerDelta;uniform sampler2D textureImage;varying vec2 vUV;void main(){vec4 color=vColor;if(uAntialias){float blur=1.0;blur=1.0-smoothstep(0.98,1.0,length(vNormal));color.a*=blur;}if(uUseTexture){vec4 texture=vec4(1.0,1.0,1.0,0.0);float uvx=vUV.x;float muvx=mod(uvx,markerDelta);float halfd=markerDelta/2.0;if(muvx>=halfd&&muvx<=halfd+uvDelta){float s=(muvx-halfd)/uvDelta;texture=texture2D(textureImage,vec2(s,vUV.y));color=texture.a>=0.5 ? texture : color;}}if(uDashArray>0.0){color.a*=ceil(mod(vCounter+uDashOffset,uDashArray)-(uDashArray*uDashRatio));}gl_FragColor=color;}",
defines:c},this);this.prevBuffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.currentBuffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.nextBuffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.directionBuffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.colorBuffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.counterBuffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.uvBuffer=new L({gl:a,target:"ARRAY_BUFFER",
usage:"STATIC_DRAW"});this.indexBuffer=new L({gl:a,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});c=[{stride:12,name:"previous",buffer:this.prevBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"position",buffer:this.currentBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"next",buffer:this.nextBuffer,size:3,type:"FLOAT",offset:0},{stride:4,name:"direction",buffer:this.directionBuffer,size:1,type:"FLOAT",offset:0},{stride:16,name:"aColor",buffer:this.colorBuffer,size:4,type:"FLOAT",offset:0},
{stride:4,name:"aCounter",buffer:this.counterBuffer,size:1,type:"FLOAT",offset:0}];c=c.concat(this.getCommonAttributes());Wc[b.style]&&(c.push({stride:8,name:"uv",buffer:this.uvBuffer,size:2,type:"FLOAT",offset:0}),this.setOptions({texture:Wc[b.style]}));this.loadTexture();this.vertexArray=new sa({gl:a,program:this.program,attributes:c})}},{key:"onChanged",value:function(a,c){var b=this;if(this.gl){this.initData();for(var d=a.color,g=[],h=0;h<c.length;h++){var m=[],n=c[h].geometry.coordinates;n&&
0<n.length&&(m="Polygon"===c[h].geometry.type?n[0].map(function(a){return b.normizedPoint(a)}):n.map(function(a){return b.normizedPoint(a)}));n=c[h].color||d;"properties"in c[h]&&"color"in c[h].properties&&(n=c[h].properties.color);"[object Function]"===Object.prototype.toString.call(n)&&(n=n(c[h]));n=this.normizedColor(n);for(var p=this.addMultipleCoords(m),l=0;l<p.length;l++)this.processData(this.dataMgr,p[l],n);if(a.enablePicked)for(n=this.indexToRgb(h),p=0;p<m.length;p++)g.push(n[0]/255,n[1]/
255,n[2]/255),g.push(n[0]/255,n[1]/255,n[2]/255),a.repeat&&(g.push(n[0]/255,n[1]/255,n[2]/255),g.push(n[0]/255,n[1]/255,n[2]/255),g.push(n[0]/255,n[1]/255,n[2]/255),g.push(n[0]/255,n[1]/255,n[2]/255))}this.counterBuffer.updateData(new Float32Array(this.dataMgr.counter));this.currentBuffer.updateData(new Float32Array(this.dataMgr.position));this.prevBuffer.updateData(new Float32Array(this.dataMgr.prev));this.nextBuffer.updateData(new Float32Array(this.dataMgr.next));this.directionBuffer.updateData(new Float32Array(this.dataMgr.direction));
this.colorBuffer.updateData(new Float32Array(this.dataMgr.color));this.indexBuffer.updateData(new Uint32Array(this.dataMgr.index));this.isUseTexture&&this.uvBuffer.updateData(new Float32Array(this.dataMgr.uv));a.enablePicked&&this.pickBuffer.updateData(new Float32Array(g))}}},{key:"processData",value:function(a,c,f){var b,d,h,m,n,p,l,r,q=c.length,t=a.position.length/6,v=Bd(c),w=v.arr,x=v.total;v=ua(w.map(function(a){return a/x}));w=w.map(function(a){return[a,0,a,1]});var u=ua(c.map(function(a){return 1}),
!0),A=ua(c),y=ua(c.map(Sb(-1))),z=ua(c.map(Sb(1)));c=ua(c.map(function(a){return f}));q=Ad(q,t);(b=a.uv).push.apply(b,aa(Ka(w)));(d=a.counter).push.apply(d,aa(v));(h=a.position).push.apply(h,aa(Ka(A)));(m=a.prev).push.apply(m,aa(Ka(y)));(n=a.next).push.apply(n,aa(Ka(z)));(p=a.direction).push.apply(p,aa(u));(l=a.color).push.apply(l,aa(Ka(c)));(r=a.index).push.apply(r,aa(q))}},{key:"render",value:function(a){var b=a.gl,c=a.matrix,k=this.dataMgr;if(k&&!(0>=k.index.length)&&this.map){var g=this.getOptions(),
h=this.program;h.use(b);var m=0,n=0;this.isUseTexture&&(n=this.map.getZoomUnits(),m=Math.min(1E3,Math.max(n/.125*8,1)),n=parseFloat((g.width*n).toFixed(2)));h.setUniforms(U(this.getCommonUniforms(a),{u_matrix:c,uFlat:g.isFlat,zoomUnits:this.map.getZoomUnits(),devicePixelRatio:window.devicePixelRatio,miter:1,thickness:g.width,uDashArray:g.dashArray,uDashRatio:g.dashRatio,uDashOffset:g.dashOffset,uAntialias:g.antialias,uUseTexture:this.isUseTexture,textureImage:this.texture,markerDelta:m,uvDelta:n}));
b.enable(b.BLEND);b.blendEquation(b.FUNC_ADD);g.blend&&"lighter"===g.blend?b.blendFunc(b.SRC_ALPHA,b.ONE):b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);this.indexBuffer.bind();this.vertexArray.bind();b.drawElements(b.TRIANGLES,k.index.length,b.UNSIGNED_INT,0);b.bindBuffer(b.ARRAY_BUFFER,null);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null);b.disable(b.BLEND)}}},{key:"loadTexture",value:function(a){var b=this,c=this.getOptions();c.texture?(this.isUseTexture=!0,Ia(this.gl,c.texture,function(c,d){b.image=
d;b.texture=c;a&&a();b.webglLayer.render()})):(this.isUseTexture=!1,this.image=this.texture=null,a&&a())}}]);return a}(da),Kg=function(){function c(a,b){E(this,c);this.layer=a;this.gl=b;this.initData()}F(c,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]};this.maxLength=0}},{key:"getData",value:function(){return this.outWall3d}},{key:"getMaxDataLength",value:function(){return this.maxLength}},{key:"onLayerChange",value:function(a,b){this.initData();
var c=a.color,f=a.height,k=a.gradient;a=this.gl;for(var g=0;g<b.length;g++){var h=b[g].geometry.coordinates,m=h.length;this.maxLength=m>this.maxLength?m:this.maxLength;for(var n=[],p=0;p<m;p++){var l=this.layer.normizedPoint(h[p]);n.push(l)}m=b[g].color||c;"properties"in b[g]&&"color"in b[g].properties&&(m=b[g].properties.color);k||"[object Function]"!==Object.prototype.toString.call(m)||(m=m(b[g]));h=this.layer.normizedColor(k?k[0]:m);m=this.layer.normizedColor(k?k[1]:m);p=b[g].height||f;"properties"in
b[g]&&"height"in b[g].properties&&(p=b[g].properties.height);"[object Function]"===Object.prototype.toString.call(p)&&(p=p(b[g]));this.processData(this.outWall3d,n,h,m,p)}for(b=0;b<this.outWall3d.vertex.length;b++){c=[];f=this.outWall3d.vertex[b].length;for(k=0;k<f;k++)c.push.apply(c,aa(this.outWall3d.vertex[b][k]));f=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,f);a.bufferData(a.ARRAY_BUFFER,new Float32Array(c),a.STATIC_DRAW);this.outWall3d.vertexBuffer[b]=f;a.bindBuffer(a.ARRAY_BUFFER,null);f=a.createBuffer();
a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,f);a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[b]),a.STATIC_DRAW);this.outWall3d.indexBuffer[b]=f;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(a,b,c,f,k){var d=a.vertex[a.vertex.length-1],h=a.index[a.index.length-1],m=b.length;if(!h||65536<=h.length+2*m+2)d=[],h=[],a.vertex.push(d),a.index.push(h);(a=d.length)&&h.push(a-1,a);for(var n=a=0;n<m;n++){var p=[],l=[],r=b[n];p.push(r[0],r[1]);p.push(r[2]?Number(r[2])+
k:k);p.push(r[3]?Number(r[3]):n);p.push(a);p.push(c[0],c[1],c[2],c[3]);l.push(r[0],r[1]);l.push(r[2]?Number(r[2]):0);l.push(r[3]?Number(r[3]):n);l.push(a);l.push(f[0],f[1],f[2],f[3]);r=d.length;d.push(p,l);h.push(r,r+1);n<m-1&&(a+=this.getDistance(b[n],b[n+1]))}}},{key:"getDistance",value:function(a,b){return Math.sqrt(Math.pow(Math.abs(a[0]-b[0]),2)+Math.pow(Math.abs(a[1]-b[1]),2))}}]);return c}(),Fe=function(c){function a(b,c){E(this,a);b=M(this,(a.__proto__||I(a)).call(this,b,c));b.startTime=b.options.startTime||
0;b.endTime=b.options.endTime;b.time=b.startTime;b.autoUpdate=!0;return b}G(a,c);F(a,[{key:"getDefaultOptions",value:function(){return{height:100,color:[1,1,1,1],trailLength:3,step:.1}}},{key:"initialize",value:function(a){this.gl=a;this.dataMgr=new Kg(this,this.gl);this.program=new Q(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;attribute vec4 aPos;attribute float aDistance;attribute vec4 aColor;varying vec4 vColor;varying float vHeight;varying float vTime;varying float vDistance;void main(){vTime=1.0-((currentTime-aPos.w)/trailLength);vHeight=aPos.z;vColor=aColor;vDistance=aDistance;gl_Position=u_matrix*vec4(aPos.xyz,1.0);}",
fragmentShader:"precision highp float;varying vec4 vColor;varying float vTime;varying float vDistance;varying float vHeight;uniform float currentTime;void main(){if(vTime>1.0||vTime<0.0){}float radius=2.5;float distance=vDistance+currentTime*20.0;float modDistance=mod(distance,9.0);float alpha=1.0;if(modDistance>radius*2.0){discard;}else{float x=abs(modDistance-radius);float y=abs(vHeight-radius);float dis=sqrt(pow(x,2.0)+pow(y,2.0));if(dis>radius){discard;}alpha=dis/radius;}gl_FragColor=vec4(vColor.rgb,1.0-alpha);}"})}},
{key:"onChanged",value:function(a,c){this.gl&&(this.dataMgr.onLayerChange(a,c),void 0===a.endTime&&(this.endTime=this.dataMgr.getMaxDataLength()))}},{key:"render",value:function(a){var b=a.gl,c=a.matrix;if((a=this.dataMgr.getData())&&!(0>=a.vertex.length)){var k=this.getOptions(),g=this.program;b.useProgram(g.program);b.enable(b.BLEND);b.blendEquation(b.FUNC_ADD);b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);b.enableVertexAttribArray(g.attributes.aPos);b.enableVertexAttribArray(g.attributes.aDistance);
b.enableVertexAttribArray(g.attributes.aColor);b.uniformMatrix4fv(g.uniforms.u_matrix,!1,c);b.uniform1f(g.uniforms.currentTime,this.time);b.uniform1f(g.uniforms.trailLength,k.trailLength);for(c=0;c<a.vertex.length;c++)if(!(0>=a.vertex[c].length)){var h=a.vertex[c],m=(new Float32Array(h[0])).BYTES_PER_ELEMENT;h=m*h[0].length;b.bindBuffer(b.ARRAY_BUFFER,a.vertexBuffer[c]);b.vertexAttribPointer(g.attributes.aPos,4,b.FLOAT,!1,h,0);b.vertexAttribPointer(g.attributes.aDistance,1,b.FLOAT,!1,h,4*m);b.vertexAttribPointer(g.attributes.aColor,
4,b.FLOAT,!1,h,5*m);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,a.indexBuffer[c]);b.drawElements(b.TRIANGLE_STRIP,a.index[c].length,b.UNSIGNED_SHORT,0);b.bindBuffer(b.ARRAY_BUFFER,null);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null)}b.disable(b.BLEND);this.time+=k.step;this.time>this.endTime&&(this.time=this.startTime);b.useProgram(null)}}}]);return a}(da),Lg=H(function(c,a){a.__esModule=!0;var b=La&&La.__esModule?La:{default:La};a.default=function(a,c,k){c in a?(0,b.default)(a,c,{value:k,enumerable:!0,configurable:!0,
writable:!0}):a[c]=k;return a}}),jb=K(Lg),Jb,Kb,Mg=(Jb={},jb(Jb,1,1),jb(Jb,2,1),jb(Jb,3,1),Jb),Ng=(Kb={},jb(Kb,1,1),jb(Kb,2,1),jb(Kb,3,1),Kb),ab=function(c){function a(b,c){E(this,a);b=M(this,(a.__proto__||I(a)).call(this,b,c));b.bufferMap={};b.bufferData=[];b.autoUpdate=!0;return b}G(a,c);F(a,[{key:"getDefaultOptions",value:function(){return{color:[1,1,1,.8],speed:1,size:5,pointFade:!0,pointFadeBuffer:1,minLineLength:2,animationType:2,shapeType:2,depthTest:!1}}},{key:"initialize",value:function(a){this.gl=
a;var b=this.getOptions();this.updateUniformsFromOptions(b);this.program=new Q(this.gl,{vertexShader:"precision highp float;attribute vec3 aPos;attribute vec3 aNextPos;attribute float aIndex;attribute float aNextIndex;attribute float aLength;uniform float uSize;uniform mat4 u_matrix;uniform float uElapsedSteps;uniform int uAnimationType;uniform int uPointFade;uniform float uPointFadeBuffer;varying float vAddOpacity;void main(){if(uAnimationType==1){if(abs(aIndex-mod(uElapsedSteps,aLength))>.1){gl_Position=vec4(-2.,-2.,0,1.0);return;}gl_Position=u_matrix*vec4(aPos.xyz,1.0);vAddOpacity=1.;}else if(uAnimationType==2){float lineLength=aLength-1.;float cIndex=mod(uElapsedSteps,lineLength);float rest=cIndex-aIndex;if(rest<1.&&rest>=0.){if(uPointFade==1){if(cIndex<uPointFadeBuffer){vAddOpacity=cIndex/uPointFadeBuffer;}else if(cIndex>lineLength-uPointFadeBuffer){vAddOpacity=(lineLength-cIndex)/uPointFadeBuffer;}else{vAddOpacity=1.;}}else{vAddOpacity=1.;}gl_Position=u_matrix*vec4(aPos.x+(aNextPos.x-aPos.x)*rest,aPos.y+(aNextPos.y-aPos.y)*rest,aPos.z+(aNextPos.z-aPos.z)*rest,1.0);}else{gl_Position=vec4(-2.,-2.,0,1.0);return;}}else if(uAnimationType==3){float percent=mod(uElapsedSteps,aLength)/aLength;if(percent<=aNextIndex&&percent>=aIndex){if(uPointFade==1){float fadePercent=uPointFadeBuffer*1000./aLength;if(percent<fadePercent){vAddOpacity=percent/fadePercent;}else if(percent>1.-fadePercent){vAddOpacity=(1.-percent)/fadePercent;}else{vAddOpacity=1.;}}else{vAddOpacity=1.;}float rest=(percent-aIndex)/(aNextIndex-aIndex);gl_Position=u_matrix*vec4(aPos.x+(aNextPos.x-aPos.x)*rest,aPos.y+(aNextPos.y-aPos.y)*rest,aPos.z+(aNextPos.z-aPos.z)*rest,1.0);}else{gl_Position=vec4(-2.,-2.,0,1.0);return;}}gl_PointSize=uSize;}",
fragmentShader:"precision highp float;uniform vec4 uColor;uniform int ushapeType;varying float vAddOpacity;void main(){if(ushapeType==2){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}gl_FragColor=vec4(uColor.rgb,uColor.a*vAddOpacity);}else if(ushapeType==3){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}gl_FragColor=vec4(uColor.rgb,uColor.a*smoothstep(1.0,0.0,d*2.)*vAddOpacity);}else{gl_FragColor=vec4(uColor.rgb,uColor.a*vAddOpacity);}}"});this.buffer=a.createBuffer();
a.bindBuffer(a.ARRAY_BUFFER,this.buffer)}},{key:"bindAttributeBufferData",value:function(a,c,f,k){var b=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b);f=new Float32Array(f);a.bufferData(a.ARRAY_BUFFER,f,a.STATIC_DRAW);this.bufferMap[c]={buffer:b,data:f,elementSize:k}}},{key:"onChanged",value:function(a,c){var b=this.gl;if(b){Array.isArray(c)||(c=[]);this.updateUniformsFromOptions(a);var d=[],g=[],h=[],m=[],n=[];a=a.minLineLength;for(var p=0;p<c.length;p++){var l=c[p].geometry.coordinates,r=l.length;
if(!(r<a)){for(var q=0;q<r;++q){var t=this.normizedPoint(l[q]);d.push(t[0]);d.push(t[1]);d.push(t[2]||0);3!==this.animationType&&(g.push(q),m.push(r))}if(1!==this.animationType){t=d.length-3*r+3;q=d.length;for(l=t;l<q;++l)n.push(d[l]);d.splice(q-3,3);if(2===this.animationType)g.pop(),m.pop();else if(3===this.animationType){t-=3;q=d.length-3;l=0;r=[];for(var v=t;v<=q;v+=3)t=Math.sqrt(Math.pow(n[v]-d[v],2)+Math.pow(n[v+1]-d[v+1],2)+Math.pow(n[v+2]-d[v+2],2)),l+=t,r.push(t);g.push(0);v=q=0;for(var w=
r.length-1;v<w;++v)q+=r[v],t=q/l,g.push(t),h.push(t),m.push(l);h.push(1);m.push(l)}}}}this.bindAttributeBufferData(b,"aPos",d,3);this.bindAttributeBufferData(b,"aIndex",g,1);this.bindAttributeBufferData(b,"aLength",m,1);1!==this.animationType&&(this.bindAttributeBufferData(b,"aNextPos",n,3),3===this.animationType&&this.bindAttributeBufferData(b,"aNextIndex",h,1));this.vertCount=d.length/3}}},{key:"updateUniformsFromOptions",value:function(a){this.color=this.normizedColor(a.color);this.startTime=(new Date).getTime();
Mg[a.animationType]||(a.animationType=2);Ng[a.shapeType]||(a.shapeType=2);if(isNaN(a.minLineLength)||2>a.minLineLength)a.minLineLength=2;this.animationType=a.animationType}},{key:"renderAttributeArr",value:function(a,c,f){if(void 0!==c.attributes[f]){var b=this.bufferMap[f];b&&(a.bindBuffer(a.ARRAY_BUFFER,b.buffer),a.enableVertexAttribArray(c.attributes[f]),a.vertexAttribPointer(c.attributes[f],b.elementSize,a.FLOAT,!1,b.data.BYTES_PER_ELEMENT*b.elementSize,0))}}},{key:"render",value:function(a){var b=
a.gl;a=a.matrix;if(!(0>=this.vertCount)){var c=this.program;b.useProgram(c.program);this.renderAttributeArr(b,c,"aPos");this.renderAttributeArr(b,c,"aIndex");this.renderAttributeArr(b,c,"aLength");1!==this.animationType&&(this.renderAttributeArr(b,c,"aNextPos"),3===this.animationType&&this.renderAttributeArr(b,c,"aNextIndex"));var k=(new Date).getTime()-this.startTime;k=1===this.animationType?Math.round(k/1E3*this.options.speed*20):3===this.animationType?k/1E3*this.options.speed*1E3:k/1E3*this.options.speed;
b.uniformMatrix4fv(c.uniforms.u_matrix,!1,a);b.uniform4f(c.uniforms.uColor,this.color[0],this.color[1],this.color[2],this.color[3]);b.uniform1f(c.uniforms.uSize,this.options.size);b.uniform1f(c.uniforms.uElapsedSteps,k);b.uniform1i(c.uniforms.uAnimationType,this.animationType);b.uniform1i(c.uniforms.ushapeType,this.options.shapeType);b.uniform1i(c.uniforms.uPointFade,this.options.pointFade?1:0);b.uniform1f(c.uniforms.uPointFadeBuffer,this.options.pointFadeBuffer);a=this.options.blend;c=this.options.depthTest;
b.enable(b.BLEND);b.blendEquation(b.FUNC_ADD);a&&"lighter"===a?b.blendFunc(b.SRC_ALPHA,b.ONE):b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);c||b.disable(b.DEPTH_TEST);b.drawArrays(b.POINTS,0,this.vertCount);b.bindBuffer(b.ARRAY_BUFFER,null);b.disable(b.BLEND);b.disable(b.DEPTH_TEST);b.useProgram(null)}}}]);return a}(da);ab.ANIMATION_TYPE_LEAP=1;ab.ANIMATION_TYPE_SMOOTH=2;ab.ANIMATION_TYPE_UNIFORM_SPEED=3;ab.SHAPE_TYPE_SQUARE=1;ab.SHAPE_TYPE_CIRCLE=2;ab.SHAPE_TYPE_CIRCLE_GRADIENT=3;var Og=function(){function c(a,
b){E(this,c);this.layer=a;this.gl=b;this.initData()}F(c,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]}}},{key:"getData",value:function(){return this.outWall3d}},{key:"onLayerChange",value:function(a,b){this.initData();for(var c=a.color,f=a.height,k=a.gradient,g=a.enablePreciseMap,h=this.gl,m=0;m<b.length;m++){for(var n=b[m].geometry.coordinates,p=n.length,l=[],r=[],q=0,t=0;t<p;t++){var v=this.layer.normizedPoint(n[t]);if(0<t&&g){var w=this.layer.normizedPoint(n[t-
1]);q+=Math.sqrt(Math.pow(v[0]-w[0],2)+Math.pow(v[1]-w[1],2))}l.push(v);r.push(q)}p=b[m].color||c;"properties"in b[m]&&"color"in b[m].properties&&(p=b[m].properties.color);k||"[object Function]"!==Object.prototype.toString.call(p)||(p=p(b[m]));n=this.layer.normizedColor(k?k[0]:p);p=this.layer.normizedColor(k?k[1]:p);q=b[m].height||f;"properties"in b[m]&&"height"in b[m].properties&&(q=b[m].properties.height);"[object Function]"===Object.prototype.toString.call(q)&&(q=q(b[m]));this.processData(this.outWall3d,
a,l,r,n,p,q)}for(a=0;a<this.outWall3d.vertex.length;a++){b=[];c=this.outWall3d.vertex[a].length;for(f=0;f<c;f++)b.push.apply(b,aa(this.outWall3d.vertex[a][f]));c=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,c);h.bufferData(h.ARRAY_BUFFER,new Float32Array(b),h.STATIC_DRAW);this.outWall3d.vertexBuffer[a]=c;h.bindBuffer(h.ARRAY_BUFFER,null);c=h.createBuffer();h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,c);h.bufferData(h.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[a]),h.STATIC_DRAW);this.outWall3d.indexBuffer[a]=
c;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(a,b,c,f,k,g,h){var d=f[f.length-1],n=a.vertex[a.vertex.length-1],p=a.index[a.index.length-1],l=c.length;if(!p||65536<=p.length+2*l+2)n=[],p=[],a.vertex.push(n),a.index.push(p);(a=n.length)&&p.push(a-1,a);for(a=0;a<l;a++){var r=[],q=[],t=c[a];r.push(t[0],t[1],h);r.push(k[0],k[1],k[2],k[3]);q.push(t[0],t[1],0);q.push(g[0],g[1],g[2],g[3]);b.texture&&(t=f[a],b.enablePreciseMap?(r.push(t/d,1),q.push(t/d,0)):(r.push(a/(l-1),
1),q.push(a/(l-1),0)));t=n.length;n.push(r,q);p.push(t,t+1)}}}]);return c}(),Pg=function(c){function a(b,c){E(this,a);return M(this,(a.__proto__||I(a)).call(this,b,c))}G(a,c);F(a,[{key:"getDefaultOptions",value:function(){return{texture:null,enablePreciseMap:!1,height:100,color:[1,1,1,1]}}},{key:"initialize",value:function(a){this.gl=a;this.dataMgr=new Og(this,this.gl);this.texture=null;this.isUseTexture=!1;this.vertexLength=10;this.program=new Q(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform bool uUseTexture;attribute vec3 aPos;attribute vec4 aColor;attribute vec2 aTextureCoords;varying vec2 vTextureCoords;varying vec4 vColor;void main(){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}if(uUseTexture){vTextureCoords=aTextureCoords;}gl_Position=u_matrix*vec4(aPos,1.0);}",
fragmentShader:"precision highp float;uniform bool uUseTexture;uniform sampler2D uSampler;varying vec2 vTextureCoords;varying vec4 vColor;void main(){if(uUseTexture){gl_FragColor=vec4(1.0,1.0,1.0,1.0)*texture2D(uSampler,vTextureCoords);}else{gl_FragColor=vColor;}}"});this.loadTexture()}},{key:"onChanged",value:function(a,c){var b=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout(function(){b.loadTexture(function(){b.dataMgr.onLayerChange(a,c);
b.webglLayer.render()})},0))}},{key:"render",value:function(a){var b=a.gl,c=a.matrix;if((a=this.dataMgr.getData())&&!(0>=a.vertex.length)){var k=this.getOptions(),g=this.program;b.useProgram(g.program);b.enable(b.BLEND);b.blendEquation(b.FUNC_ADD);b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);if(k.texture){if(!this.texture)return;b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,this.texture);b.uniform1i(g.uniforms.uSampler,0);b.depthMask(!0);b.depthFunc(b.LESS)}else b.depthMask(!1);k.texture?
b.enableVertexAttribArray(g.attributes.aTextureCoords):b.disableVertexAttribArray(g.attributes.aTextureCoords);b.enableVertexAttribArray(g.attributes.aPos);b.enableVertexAttribArray(g.attributes.aColor);b.uniformMatrix4fv(g.uniforms.u_matrix,!1,c);b.uniform1i(g.uniforms.uUseTexture,this.isUseTexture);for(c=0;c<a.vertex.length;c++)if(!(0>=a.vertex[c].length)){var h=a.vertex[c],m=(new Float32Array(h[0])).BYTES_PER_ELEMENT;h=m*h[0].length;b.bindBuffer(b.ARRAY_BUFFER,a.vertexBuffer[c]);b.vertexAttribPointer(g.attributes.aPos,
3,b.FLOAT,!1,h,0);b.vertexAttribPointer(g.attributes.aColor,4,b.FLOAT,!1,h,3*m);k.texture&&b.vertexAttribPointer(g.attributes.aTextureCoords,2,b.FLOAT,!1,h,7*m);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,a.indexBuffer[c]);b.drawElements(b.TRIANGLE_STRIP,a.index[c].length,b.UNSIGNED_SHORT,0);b.bindBuffer(b.ARRAY_BUFFER,null);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null)}b.disable(b.BLEND);b.useProgram(null)}}},{key:"loadTexture",value:function(a){var b=this,c=this.getOptions();c.texture?(this.isUseTexture=!0,
Ia(this.gl,c.texture,function(c,d){b.image=d;b.texture=c;a&&a();b.webglLayer.render()})):(this.isUseTexture=!1,this.image=this.texture=null,a&&a())}}]);return a}(da),Qg=function(){function c(a,b){E(this,c);this.layer=a;this.gl=b;this.initData()}F(c,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]};this.maxLength=0}},{key:"getData",value:function(){return this.outWall3d}},{key:"getMaxDataLength",value:function(){return this.maxLength}},{key:"onLayerChange",
value:function(a,b){this.initData();var c=a.color,f=a.height,k=a.gradient;a=this.gl;for(var g=0;g<b.length;g++){var h=b[g].geometry.coordinates,m=h.length;this.maxLength=m>this.maxLength?m:this.maxLength;for(var n=[],p=0;p<m;p++){var l=this.layer.normizedPoint(h[p]);n.push(l)}m=b[g].color||c;"properties"in b[g]&&"color"in b[g].properties&&(m=b[g].properties.color);k||"[object Function]"!==Object.prototype.toString.call(m)||(m=m(b[g]));h=this.layer.normizedColor(k?k[0]:m);m=this.layer.normizedColor(k?
k[1]:m);p=b[g].height||f;"properties"in b[g]&&"height"in b[g].properties&&(p=b[g].properties.height);"[object Function]"===Object.prototype.toString.call(p)&&(p=p(b[g]));this.processData(this.outWall3d,n,h,m,p)}for(b=0;b<this.outWall3d.vertex.length;b++){c=[];f=this.outWall3d.vertex[b].length;for(k=0;k<f;k++)c.push.apply(c,aa(this.outWall3d.vertex[b][k]));f=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,f);a.bufferData(a.ARRAY_BUFFER,new Float32Array(c),a.STATIC_DRAW);this.outWall3d.vertexBuffer[b]=
f;a.bindBuffer(a.ARRAY_BUFFER,null);f=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,f);a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[b]),a.STATIC_DRAW);this.outWall3d.indexBuffer[b]=f;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(a,b,c,f,k){var d=a.vertex[a.vertex.length-1],h=a.index[a.index.length-1],m=b.length;if(!h||65536<=h.length+2*m+2)d=[],h=[],a.vertex.push(d),a.index.push(h);(a=d.length)&&h.push(a-1,a);for(a=0;a<m;a++){var n=
[],p=[],l=b[a];n.push(l[0],l[1]);n.push(l[2]?Number(l[2])+k:k);n.push(l[3]?Number(l[3]):a);n.push(c[0],c[1],c[2],c[3]);p.push(l[0],l[1]);p.push(l[2]?Number(l[2]):0);p.push(l[3]?Number(l[3]):a);p.push(f[0],f[1],f[2],f[3]);l=d.length;d.push(n,p);h.push(l,l+1)}}}]);return c}(),Rg=function(c){function a(b,c){E(this,a);b=M(this,(a.__proto__||I(a)).call(this,b,c));b.startTime=b.options.startTime||0;b.endTime=b.options.endTime;b.time=b.startTime;b.autoUpdate=!0;return b}G(a,c);F(a,[{key:"getDefaultOptions",
value:function(){return{height:100,color:[1,1,1,1],trailLength:3,step:.1}}},{key:"initialize",value:function(a){this.gl=a;this.dataMgr=new Qg(this,this.gl);this.program=new Q(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;attribute vec4 aPos;attribute vec4 aColor;varying vec4 vColor;varying float vTime;void main(){vTime=1.0-((currentTime-aPos.w)/trailLength);vColor=aColor;gl_Position=u_matrix*vec4(aPos.xyz,1.0);}",fragmentShader:"precision highp float;varying vec4 vColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(vColor.rgb,1.0*vTime);}"})}},
{key:"onChanged",value:function(a,c){this.gl&&(this.dataMgr.onLayerChange(a,c),void 0===a.endTime&&(this.endTime=this.dataMgr.getMaxDataLength()))}},{key:"render",value:function(a){var b=a.gl,c=a.matrix;if((a=this.dataMgr.getData())&&!(0>=a.vertex.length)){var k=this.getOptions(),g=this.program;b.useProgram(g.program);b.enable(b.BLEND);b.blendEquation(b.FUNC_ADD);b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);b.enableVertexAttribArray(g.attributes.aPos);b.enableVertexAttribArray(g.attributes.aColor);
b.uniformMatrix4fv(g.uniforms.u_matrix,!1,c);b.uniform1f(g.uniforms.currentTime,this.time);b.uniform1f(g.uniforms.trailLength,k.trailLength);for(c=0;c<a.vertex.length;c++)if(!(0>=a.vertex[c].length)){var h=a.vertex[c],m=(new Float32Array(h[0])).BYTES_PER_ELEMENT;h=m*h[0].length;b.bindBuffer(b.ARRAY_BUFFER,a.vertexBuffer[c]);b.vertexAttribPointer(g.attributes.aPos,4,b.FLOAT,!1,h,0);b.vertexAttribPointer(g.attributes.aColor,4,b.FLOAT,!1,h,4*m);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,a.indexBuffer[c]);b.drawElements(b.TRIANGLE_STRIP,
a.index[c].length,b.UNSIGNED_SHORT,0);b.bindBuffer(b.ARRAY_BUFFER,null);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null)}b.disable(b.BLEND);this.time+=k.step;this.time>this.endTime&&(this.time=this.startTime);b.useProgram(null)}}}]);return a}(da),Sg=function(c){function a(b,c){E(this,a);b=M(this,(a.__proto__||I(a)).call(this,b,c));b.simpleLineLayer=new Ce(b.getHeatOptions());b.children=[b.simpleLineLayer];return b}G(a,c);F(a,[{key:"getDefaultOptions",value:function(){return{blend:"normal",gradient:{0:"rgb(50, 50, 256)",
"0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}}}},{key:"onDataChanged",value:function(a){this.simpleLineLayer.setData(a)}},{key:"onOptionsChanged",value:function(a){this.simpleLineLayer.setOptions(this.getHeatOptions())}},{key:"getHeatOptions",value:function(){var a=this.getOptions(),c=a.max,f=a.min;void 0===c&&(f=this.getDataRange(),c=f.max,f=f.min);var k=new ia({max:c,min:f,gradient:a.gradient});a.color=function(a){var b=~~a.count||1;"properties"in a&&"count"in a.properties&&
(b=~~a.properties.count);a=k.getImageData(b);return[a[0]/255,a[1]/255,a[2]/255,a[3]/255]};return a}},{key:"getDataRange",value:function(){var a=this.getData(),c=0,f=0;a[0]&&(c=~~a[0].count||1,f=~~a[0].count||1);"properties"in a[0]&&"count"in a[0].properties&&(c=~~a[0].properties.count,f=~~a[0].properties.count);for(var k=a.length,g=0;g<k;g++){var h=~~a[g].count||1;"properties"in a[g]&&"count"in a[g].properties&&(h=~~a[g].properties.count);c=Math.max(h,c);f=Math.min(h,f)}return{max:c/2,min:f}}}]);
return a}(ib),Tg=H(function(c,a){(function(a,d){c.exports=d()})(Dd,function(){function a(b,d,f,g,k){for(;g>f;){if(600<g-f){var h=g-f+1,l=d-f+1,m=Math.log(h),u=.5*Math.exp(2*m/3);m=.5*Math.sqrt(m*u*(h-u)/h)*(0>l-h/2?-1:1);a(b,d,Math.max(f,Math.floor(d-l*u/h+m)),Math.min(g,Math.floor(d+(h-l)*u/h+m)),k)}h=b[d];l=f;u=g;c(b,f,d);for(0<k(b[g],h)&&c(b,f,g);l<u;){c(b,l,u);l++;for(u--;0>k(b[l],h);)l++;for(;0<k(b[u],h);)u--}0===k(b[f],h)?c(b,f,u):(u++,c(b,u,g));u<=d&&(f=u+1);d<=u&&(g=u-1)}}function c(a,b,c){var d=
a[b];a[b]=a[c];a[c]=d}function f(a,b){return a<b?-1:a>b?1:0}function k(a,b){g(a,0,a.children.length,b,a)}function g(a,b,c,d,f){f||(f=t(null));f.minX=Infinity;f.minY=Infinity;f.maxX=-Infinity;for(f.maxY=-Infinity;b<c;b++){var g=a.children[b];h(f,a.leaf?d(g):g)}return f}function h(a,b){a.minX=Math.min(a.minX,b.minX);a.minY=Math.min(a.minY,b.minY);a.maxX=Math.max(a.maxX,b.maxX);a.maxY=Math.max(a.maxY,b.maxY);return a}function m(a,b){return a.minX-b.minX}function n(a,b){return a.minY-b.minY}function p(a){return(a.maxX-
a.minX)*(a.maxY-a.minY)}function l(a){return a.maxX-a.minX+(a.maxY-a.minY)}function r(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function q(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function t(a){return{children:a,height:1,leaf:!0,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function v(b,c,d,g,k){for(var h=[c,d];h.length;)if(d=h.pop(),c=h.pop(),!(d-c<=g)){var l=c+Math.ceil((d-c)/g/2)*g;a(b,l,c||0,d||b.length-1,k||f);h.push(c,
l,l,d)}}var w=function(a){void 0===a&&(a=9);this._maxEntries=Math.max(4,a);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));this.clear()};w.prototype.all=function(){return this._all(this.data,[])};w.prototype.search=function(a){var b=this.data,c=[];if(!q(a,b))return c;for(var d=this.toBBox,f=[];b;){for(var g=0;g<b.children.length;g++){var k=b.children[g],h=b.leaf?d(k):k;q(a,h)&&(b.leaf?c.push(k):r(a,h)?this._all(k,c):f.push(k))}b=f.pop()}return c};w.prototype.collides=function(a){var b=
this.data;if(!q(a,b))return!1;for(var c=[];b;){for(var d=0;d<b.children.length;d++){var f=b.children[d],g=b.leaf?this.toBBox(f):f;if(q(a,g)){if(b.leaf||r(a,g))return!0;c.push(f)}}b=c.pop()}return!1};w.prototype.load=function(a){if(!a||!a.length)return this;if(a.length<this._minEntries){for(var b=0;b<a.length;b++)this.insert(a[b]);return this}a=this._build(a.slice(),0,a.length-1,0);this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&(b=this.data,
this.data=a,a=b),this._insert(a,this.data.height-a.height-1,!0)):this.data=a;return this};w.prototype.insert=function(a){a&&this._insert(a,this.data.height-1);return this};w.prototype.clear=function(){this.data=t([]);return this};w.prototype.remove=function(a,b){if(!a)return this;for(var c=this.data,d=this.toBBox(a),f=[],g=[],k,h,l;c||f.length;){c||(c=f.pop(),h=f[f.length-1],k=g.pop(),l=!0);if(c.leaf){a:{var m=a;var n=c.children,p=b;if(p){for(var u=0;u<n.length;u++)if(p(m,n[u])){m=u;break a}m=-1}else m=
n.indexOf(m)}if(-1!==m){c.children.splice(m,1);f.push(c);this._condense(f);break}}l||c.leaf||!r(c,d)?h?(k++,c=h.children[k],l=!1):c=null:(f.push(c),g.push(k),k=0,h=c,c=c.children[0])}return this};w.prototype.toBBox=function(a){return a};w.prototype.compareMinX=function(a,b){return a.minX-b.minX};w.prototype.compareMinY=function(a,b){return a.minY-b.minY};w.prototype.toJSON=function(){return this.data};w.prototype.fromJSON=function(a){this.data=a;return this};w.prototype._all=function(a,b){for(var c=
[];a;)a.leaf?b.push.apply(b,a.children):c.push.apply(c,a.children),a=c.pop();return b};w.prototype._build=function(a,b,c,d){var f=c-b+1,g=this._maxEntries;if(f<=g){var h=t(a.slice(b,c+1));k(h,this.toBBox);return h}d||(d=Math.ceil(Math.log(f)/Math.log(g)),g=Math.ceil(f/Math.pow(g,d-1)));h=t([]);h.leaf=!1;h.height=d;f=Math.ceil(f/g);g=f*Math.ceil(Math.sqrt(g));for(v(a,b,c,g,this.compareMinX);b<=c;b+=g){var l=Math.min(b+g-1,c);v(a,b,l,f,this.compareMinY);for(var m=b;m<=l;m+=f)h.children.push(this._build(a,
m,Math.min(m+f-1,l),d-1))}k(h,this.toBBox);return h};w.prototype._chooseSubtree=function(a,b,c,d){for(;;){d.push(b);if(b.leaf||d.length-1===c)break;for(var f=Infinity,g=Infinity,h=void 0,k=0;k<b.children.length;k++){var l=b.children[k],m=p(l),n=(Math.max(l.maxX,a.maxX)-Math.min(l.minX,a.minX))*(Math.max(l.maxY,a.maxY)-Math.min(l.minY,a.minY))-m;n<g?(g=n,f=m<f?m:f,h=l):n===g&&m<f&&(f=m,h=l)}b=h||b.children[0]}return b};w.prototype._insert=function(a,b,c){c=c?a:this.toBBox(a);var d=[],f=this._chooseSubtree(c,
this.data,b,d);f.children.push(a);for(h(f,c);0<=b;)if(d[b].children.length>this._maxEntries)this._split(d,b),b--;else break;this._adjustParentBBoxes(c,d,b)};w.prototype._split=function(a,b){var c=a[b],d=c.children.length,f=this._minEntries;this._chooseSplitAxis(c,f,d);d=this._chooseSplitIndex(c,f,d);d=t(c.children.splice(d,c.children.length-d));d.height=c.height;d.leaf=c.leaf;k(c,this.toBBox);k(d,this.toBBox);b?a[b-1].children.push(d):this._splitRoot(c,d)};w.prototype._splitRoot=function(a,b){this.data=
t([a,b]);this.data.height=a.height+1;this.data.leaf=!1;k(this.data,this.toBBox)};w.prototype._chooseSplitIndex=function(a,b,c){for(var d,f=Infinity,h=Infinity,k=b;k<=c-b;k++){var l=g(a,0,k,this.toBBox),m=g(a,k,c,this.toBBox);var n=Math.max(0,Math.min(l.maxX,m.maxX)-Math.max(l.minX,m.minX))*Math.max(0,Math.min(l.maxY,m.maxY)-Math.max(l.minY,m.minY));l=p(l)+p(m);n<f?(f=n,d=k,h=l<h?l:h):n===f&&l<h&&(h=l,d=k)}return d||c-b};w.prototype._chooseSplitAxis=function(a,b,c){var d=a.leaf?this.compareMinX:m,
f=a.leaf?this.compareMinY:n,g=this._allDistMargin(a,b,c,d);b=this._allDistMargin(a,b,c,f);g<b&&a.children.sort(d)};w.prototype._allDistMargin=function(a,b,c,d){a.children.sort(d);d=this.toBBox;for(var f=g(a,0,b,d),k=g(a,c-b,c,d),m=l(f)+l(k),n=b;n<c-b;n++){var p=a.children[n];h(f,a.leaf?d(p):p);m+=l(f)}for(c=c-b-1;c>=b;c--)f=a.children[c],h(k,a.leaf?d(f):f),m+=l(k);return m};w.prototype._adjustParentBBoxes=function(a,b,c){for(;0<=c;c--)h(b[c],a)};w.prototype._condense=function(a){for(var b=a.length-
1,c;0<=b;b--)0===a[b].children.length?0<b?(c=a[b-1].children,c.splice(c.indexOf(a[b]),1)):this.clear():k(a[b],this.toBBox)};return w})}),kb=window.devicePixelRatio,lb=Math.max(2,kb),Xc=function(c){function a(b,c){E(this,a);b=M(this,(a.__proto__||I(a)).call(this,b,c));c=b.canvas=document.createElement("canvas");c=b.ctx=c.getContext("2d");c.textAlign="start";c.textBaseline="top";return b}G(a,c);F(a,[{key:"getDefaultOptions",value:function(){return{color:"#fff",fontFamily:"Microsoft Yahei",fontSize:14,
isFlat:!1,collides:!0,offset:[0,0],padding:[2,2],margin:[0,0]}}},{key:"initialize",value:function(a){this.gl=a;this.texture=null;this.program=new Q(this.gl,{vertexShader:"precision highp float;uniform mat4 matrix;uniform bool uFlat;uniform float zoomUnits;uniform float devicePixelRatio;uniform vec2 offset;attribute vec3 position;attribute float corner;attribute vec2 size;attribute vec2 aTextCoord;varying vec2 vTextCoord;vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;if(corner==1.0){x-=size[0];y+=size[1];}else if(corner==2.0){x+=size[0];y+=size[1];}else if(corner==3.0){x+=size[0];y-=size[1];}else{x-=size[0];y-=size[1];}return vec3(x,y,coord.z);}void main(){vec2 pixelOffset=offset*zoomUnits;vTextCoord=aTextCoord;if(uFlat){vec2 halfSize=size/2.0*zoomUnits;vec3 current=transformCoord(position,halfSize,corner);gl_Position=matrix*vec4(current.x+pixelOffset[0],current.y+pixelOffset[1],current.z,1.0);}else{vec4 projection=matrix*vec4(position.x+pixelOffset[0],position.y+pixelOffset[1],position.z,1.0);vec3 screen=projection.xyz/projection.w;vec2 halfSize=size/MAPV_resolution*devicePixelRatio;vec3 current=transformCoord(screen,halfSize,corner);gl_Position=vec4(current,1.0);}}",
fragmentShader:"precision highp float;uniform sampler2D textureImage;varying vec2 vTextCoord;void main(){gl_FragColor=texture2D(textureImage,vec2(vTextCoord.x,1.0-vTextCoord.y));}"},this);this.vertexBuffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.uvBuffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.indexBuffer=new L({gl:a,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});var b=[{name:"position",buffer:this.vertexBuffer,size:3,stride:24,type:"FLOAT",offset:0},
{name:"corner",buffer:this.vertexBuffer,size:1,stride:24,type:"FLOAT",offset:12},{name:"size",buffer:this.vertexBuffer,size:2,stride:24,type:"FLOAT",offset:16},{name:"aTextCoord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}];b=b.concat(this.getCommonAttributes());this.vertexArray=new sa({gl:a,program:this.program,attributes:b})}},{key:"onChanged",value:function(a,c){this.gl&&this.processCache(c)}},{key:"processCache",value:function(a){this.cachedData=[];for(var b=0;b<a.length;b++){var c=
this.normizedPoint(a[b].geometry.coordinates),k=a[b].text||"";"properties"in a[b]&&"text"in a[b].properties&&(k=a[b].properties.text);c&&k&&this.cachedData.push({point:c,text:k})}}},{key:"render",value:function(a){if(this.cachedData&&this.cachedData.length&&this.map){var b=a.gl,c=a.matrix,k=this.getOptions(),g=this.program;g.use(b);this.updateText(a);b.enable(b.BLEND);b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);b.disable(b.DEPTH_TEST);var h=this.map.getZoomUnits();g.setUniforms(U(this.getCommonUniforms(a),
{matrix:c,devicePixelRatio:kb,textureImage:this.texture,uFlat:k.isFlat,offset:k.offset,zoomUnits:h}));0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),b.drawElements(b.TRIANGLES,this.index.length,b.UNSIGNED_INT,0));b.useProgram(null)}}},{key:"updateText",value:function(a){var b=a.gl,c=a.matrix,k=this.getOptions(),g=k.color,h=k.fontSize,m=k.fontFamily;a=k.padding;var n=k.margin,p=k.collides,l=b.canvas.width,r=b.canvas.height,q=this.canvas;b=this.ctx;b.save();b.scale(lb,lb);b.textBaseline=
"top";b.font=h+"px "+m;var t=new Tg;k=[];for(var v=0;v<this.cachedData.length;v++){var w=this.cachedData[v],x=w.point;w=w.text;var u=Fb(x,3);u=hc.clone([u[0],u[1],u[2],1]);hc.transformMat4(u,u,c);hc.scale(u,u,1/u[3]);var A=(u[0]+1)/2*l,y=(-u[1]+1)/2*r,z=b.measureText(w);u=z.width+2*a[0];var B=h+2*a[1];z.actualBoundingBoxAscent&&z.actualBoundingBoxDescent&&(B=z.actualBoundingBoxDescent-z.actualBoundingBoxAscent);B+=2*a[1];var C=u+2*n[0];z=h+2*n[1];A-=C/2*kb;y-=z/2*kb;C=A+C*kb;z=y+z*kb;if(!(0>C||0>
z||A>l||y>r)){if(p){z={minX:A,maxX:C,minY:y,maxY:z};if(t.collides(z))continue;t.insert(z)}k.push({w:u,h:B,point:x,text:w})}}b.restore();n=$e(k);c=oc(n.w);n=oc(n.h);q.width=c*lb;q.height=n*lb;b.save();b.scale(lb,lb);b.textBaseline="top";b.fillStyle=g;b.font=h+"px "+m;g=[];h=[];m=[];q=0;for(p=k.length;q<p;++q){l=k[q];b.fillText(l.text,l.x+a[0],l.y+a[1]);v=Fb(l.point,3);r=v[0];t=v[1];v=v[2];for(x=0;4>x;x++)g.push(r,t,v),g.push(x),g.push(l.w,l.h);r=l.x/c;t=(l.x+l.w)/c;v=(l.y+l.h)/n;l=l.y/n;h.push(r,v,
r,l,t,l,t,v);l=4*q;m.push(l,l+2,l+1,l,l+3,l+2)}b.restore();this.loadTexture();this.index=m;this.vertexBuffer.updateData(new Float32Array(g));this.uvBuffer.updateData(new Float32Array(h));this.indexBuffer.updateData(new Uint32Array(m))}},{key:"loadTexture",value:function(){var a=this;this.canvas?Ia(this.gl,this.canvas,function(b){a.texture=b}):this.texture=null}}]);return a}(da),Ge=H(function(c,a){(function(a,d){c.exports=d()})(Dd,function(){function a(b,d,f,g,k,h){if(!(k-g<=f)){var l=g+k>>1;c(b,d,
l,g,k,h%2);a(b,d,f,g,l-1,h+1);a(b,d,f,l+1,k,h+1)}}function c(a,b,d,g,k,h){for(;k>g;){if(600<k-g){var l=k-g+1,m=d-g+1,n=Math.log(l),p=.5*Math.exp(2*n/3);n=.5*Math.sqrt(n*p*(l-p)/l)*(0>m-l/2?-1:1);c(a,b,d,Math.max(g,Math.floor(d-m*p/l+n)),Math.min(k,Math.floor(d+(l-m)*p/l+n)),h)}l=b[2*d+h];m=g;p=k;f(a,b,g,d);for(b[2*k+h]>l&&f(a,b,g,k);m<p;){f(a,b,m,p);m++;for(p--;b[2*m+h]<l;)m++;for(;b[2*p+h]>l;)p--}b[2*g+h]===l?f(a,b,g,p):(p++,f(a,b,p,k));p<=d&&(g=p+1);d<=p&&(k=p-1)}}function f(a,b,c,d){k(a,c,d);k(b,
2*c,2*d);k(b,2*c+1,2*d+1)}function k(a,b,c){var d=a[b];a[b]=a[c];a[c]=d}function g(a,b){a=a.geometry.coordinates;return{x:a[0]/360+.5,y:n(a[1]),zoom:Infinity,index:b,parentId:-1}}function h(a){var b=a.id,c=m(a);return{type:"Feature",id:b,properties:c,geometry:{type:"Point",coordinates:[360*(a.x-.5),360*Math.atan(Math.exp((180-360*a.y)*Math.PI/180))/Math.PI-90]}}}function m(a){var b=a.numPoints,c=1E4<=b?Math.round(b/1E3)+"k":1E3<=b?Math.round(b/100)/10+"k":b;return p(p({},a.properties),{cluster:!0,
cluster_id:a.id,point_count:b,point_count_abbreviated:c})}function n(a){a=Math.sin(a*Math.PI/180);a=.5-.25*Math.log((1+a)/(1-a))/Math.PI;return 0>a?0:1<a?1:a}function p(a,b){for(var c in b)a[c]=b[c];return a}function l(a){return a.x}function r(a){return a.y}var q=function(a){return a[0]},t=function(a){return a[1]},v=function(b,c,d,f,g){void 0===c&&(c=q);void 0===d&&(d=t);void 0===f&&(f=64);void 0===g&&(g=Float64Array);this.nodeSize=f;this.points=b;var k=this.ids=new (65536>b.length?Uint16Array:Uint32Array)(b.length);
g=this.coords=new g(2*b.length);for(var h=0;h<b.length;h++)k[h]=h,g[2*h]=c(b[h]),g[2*h+1]=d(b[h]);a(k,g,f,0,k.length-1,0)};v.prototype.range=function(a,b,c,d){for(var f=this.ids,g=this.coords,h=this.nodeSize,k=[0,f.length-1,0],l=[],m,n;k.length;){var p=k.pop(),q=k.pop(),t=k.pop();if(q-t<=h)for(p=t;p<=q;p++)m=g[2*p],n=g[2*p+1],m>=a&&m<=c&&n>=b&&n<=d&&l.push(f[p]);else{var u=Math.floor((t+q)/2);m=g[2*u];n=g[2*u+1];m>=a&&m<=c&&n>=b&&n<=d&&l.push(f[u]);var r=(p+1)%2;if(0===p?a<=m:b<=n)k.push(t),k.push(u-
1),k.push(r);if(0===p?c>=m:d>=n)k.push(u+1),k.push(q),k.push(r)}}return l};v.prototype.within=function(a,b,c){for(var d=this.ids,f=this.coords,g=this.nodeSize,k=[0,d.length-1,0],h=[],l=c*c;k.length;){var m=k.pop(),n=k.pop(),p=k.pop();if(n-p<=g)for(m=p;m<=n;m++){p=f[2*m]-a;var q=f[2*m+1]-b;p*p+q*q<=l&&h.push(d[m])}else{q=Math.floor((p+n)/2);var t=f[2*q],r=f[2*q+1],u=t-a,v=r-b;u*u+v*v<=l&&h.push(d[q]);u=(m+1)%2;if(0===m?a-c<=t:b-c<=r)k.push(p),k.push(q-1),k.push(u);if(0===m?a+c>=t:b+c>=r)k.push(q+1),
k.push(n),k.push(u)}}return h};var w={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(a){return a}},x=function(a){this.options=p(ag(w),a);this.trees=Array(this.options.maxZoom+1)};x.prototype.load=function(a){var b=this.options,c=b.minZoom,d=b.maxZoom;b=b.nodeSize;this.points=a;for(var f=[],k=0;k<a.length;k++)a[k].geometry&&f.push(g(a[k],k));this.trees[d+1]=new v(f,l,r,b,Float32Array);for(a=d;a>=c;a--)f=this._cluster(f,a),this.trees[a]=new v(f,l,
r,b,Float32Array);return this};x.prototype.getClusters=function(a,b){var c=((a[0]+180)%360+360)%360-180,d=Math.max(-90,Math.min(90,a[1])),f=180===a[2]?180:((a[2]+180)%360+360)%360-180,g=Math.max(-90,Math.min(90,a[3]));if(360<=a[2]-a[0])c=-180,f=180;else if(c>f)return c=this.getClusters([c,d,180,g],b),d=this.getClusters([-180,d,f,g],b),c.concat(d);b=this.trees[this._limitZoom(b)];a=[];var k=0;for(d=b.range(c/360+.5,n(g),f/360+.5,n(d));k<d.length;k+=1)f=b.points[d[k]],a.push(f.numPoints?h(f):this.points[f.index]);
return a};x.prototype.getChildren=function(a){var b=this._getOriginId(a),c=this._getOriginZoom(a),d=this.trees[c];if(!d)throw Error("No cluster with the specified id.");var f=d.points[b];if(!f)throw Error("No cluster with the specified id.");b=[];var g=0;for(c=d.within(f.x,f.y,this.options.radius/(this.options.extent*Math.pow(2,c-1)));g<c.length;g+=1)f=d.points[c[g]],f.parentId===a&&b.push(f.numPoints?h(f):this.points[f.index]);if(0===b.length)throw Error("No cluster with the specified id.");return b};
x.prototype.getLeaves=function(a,b,c){var d=[];this._appendLeaves(d,a,b||10,c||0,0);return d};x.prototype.getTile=function(a,b,c){var d=this.trees[this._limitZoom(a)];a=Math.pow(2,a);var f=this.options;f=f.radius/f.extent;var g=(c-f)/a,k=(c+1+f)/a,h={features:[]};this._addTileFeatures(d.range((b-f)/a,g,(b+1+f)/a,k),d.points,b,c,a,h);0===b&&this._addTileFeatures(d.range(1-f/a,g,1,k),d.points,a,c,a,h);b===a-1&&this._addTileFeatures(d.range(0,g,f/a,k),d.points,-1,c,a,h);return h.features.length?h:null};
x.prototype.getClusterExpansionZoom=function(a){for(var b=this._getOriginZoom(a)-1;b<=this.options.maxZoom;){a=this.getChildren(a);b++;if(1!==a.length)break;a=a[0].properties.cluster_id}return b};x.prototype._appendLeaves=function(a,b,c,d,f){var g=0;for(b=this.getChildren(b);g<b.length;g+=1){var k=b[g],h=k.properties;h&&h.cluster?f=f+h.point_count<=d?f+h.point_count:this._appendLeaves(a,h.cluster_id,c,d,f):f<d?f++:a.push(k);if(a.length===c)break}return f};x.prototype._addTileFeatures=function(a,b,
c,d,f,g){for(var k=0;k<a.length;k+=1){var h=b[a[k]],l=h.numPoints,n={type:1,geometry:[[Math.round(this.options.extent*(h.x*f-c)),Math.round(this.options.extent*(h.y*f-d))]],tags:l?m(h):this.points[h.index].properties},p=void 0;l?p=h.id:this.options.generateId?p=h.index:this.points[h.index].id&&(p=this.points[h.index].id);void 0!==p&&(n.id=p);g.features.push(n)}};x.prototype._limitZoom=function(a){return Math.max(this.options.minZoom,Math.min(a,this.options.maxZoom+1))};x.prototype._cluster=function(a,
b){var c=[],d=this.options,f=d.reduce;d=d.radius/(d.extent*Math.pow(2,b));for(var g=0;g<a.length;g++){var k=a[g];if(!(k.zoom<=b)){k.zoom=b;for(var h=this.trees[b+1],l=h.within(k.x,k.y,d),m=k.numPoints||1,n=k.x*m,p=k.y*m,q=f&&1<m?this._map(k,!0):null,t=(g<<5)+(b+1)+this.points.length,r=0;r<l.length;r+=1){var u=h.points[l[r]];if(!(u.zoom<=b)){u.zoom=b;var v=u.numPoints||1;n+=u.x*v;p+=u.y*v;m+=v;u.parentId=t;f&&(q||(q=this._map(k,!0)),f(q,this._map(u)))}}1===m?c.push(k):(k.parentId=t,c.push({x:n/m,y:p/
m,zoom:Infinity,id:t,parentId:-1,numPoints:m,properties:q}))}}return c};x.prototype._getOriginId=function(a){return a-this.points.length>>5};x.prototype._getOriginZoom=function(a){return(a-this.points.length)%32};x.prototype._map=function(a,b){if(a.numPoints)return b?p({},a.properties):a.properties;a=this.points[a.index].properties;var c=this.options.map(a);return b&&c===a?p({},c):c};return x})}),Ug=function(c){function a(b){E(this,a);b=M(this,(a.__proto__||I(a)).call(this,b));b.shapeLayer=new ic(b.options);
b.textLayer=new Xc(b.options.textOptions);b.children=[b.shapeLayer,b.textLayer];b.max=[];return b}G(a,c);F(a,[{key:"getDefaultOptions",value:function(){return{size:50,height:0,maxZoom:19,minZoom:5,gradient:{0:"rgb(50, 50, 256)","0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"},enableCluster:!1,showText:!0,textOptions:{fontSize:13,color:"white"}}}},{key:"onOptionsChanged",value:function(a){this.textLayer.setOptions(a.textOptions)}},{key:"setOptions",value:function(){var a=0<
arguments.length&&void 0!==arguments[0]?arguments[0]:{},c=this.options.textOptions;a.textOptions&&U(c,a.textOptions);var f=a.minZoom,k=a.maxZoom,g=a.size;f=k&&k!==this.options.maxZoom||f&&f!==this.options.minZoom||g&&g!==this.options.size;U(this.options,a,{textOptions:c});if(f)this.onChanged(this.options,this.data);else this.refreshLayer();this.onOptionsChanged(this.getOptions())}},{key:"onChanged",value:function(a,c){if(c&&c.length){this.zoom=Math.floor(this.map.map.getZoom());var b=a.maxZoom,d=
a.minZoom,g=a.enableCluster;a=a.size;this.zoom>b?this.zoom=b:this.zoom<d&&(this.zoom=d);g&&(this.supercluster=new Ge({maxZoom:b,minZoom:d,radius:a/2}),this.supercluster.load(c));this.refreshLayer()}}},{key:"refreshLayer",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.data,f=this.map.map,k=this.zoom;a.enableCluster&&(c=this.getClusterData(a));if(c&&c.length){var g=a.gradient,h=a.showText,m=a.textOptions,
n=a.height,p=a.size;p*=Math.pow(2,18-k);c=bf(c,p,function(a){var b=Fb(a,2),c=b[0];b=b[1];-180<=c&&180>=c&&-90<=b&&90>=b&&(b=f.lnglatToMercator(c,b),c=b[0],b=b[1]);a[0]=c;a[1]=b;return a});this.max[k]=Math.max(this.max[k]||0,c.max);var l=new ia({max:this.max[k],min:0,maxSize:n*Math.pow(2,18-k),minSize:0,gradient:g});g=[];if(h){var r=m&&m.format;r="function"===typeof r?r:null;g=c.map(function(a){return{geometry:{coordinates:[a.center.x,a.center.y,l.getSize(a.count)+m.fontSize/2*Math.pow(2,18-k)]},text:r?
r(a.count):a.count}})}this.textLayer.setData(g);h=c.map(function(a){for(var b=a.center,d=c.r,f=[],g=0;6>g;g++)f.push(af({x:b.x,y:b.y},d,g));return{geometry:{type:"Polygon",coordinates:[f]},properties:{height:l.getSize(a.count),color:l.getColor(a.count)}}});this.shapeLayer.setData(h);a.enablePicked&&a.autoSelect&&this.pick(-1,-1)}}},{key:"getClusterData",value:function(){var a=this.map.map,c=a.getBounds(),f=c.ne;c=c.sw;this.ne=f;this.sw=c;var k=f,g=k.lng;k=k.lat;var h=[];-180<=g&&180>=g&&-90<=k&&90>=
k?h=[c.lng,c.lat,f.lng,f.lat]:(f=a.mercatorToLnglat(this.ne.lng,this.ne.lat),c=a.mercatorToLnglat(this.sw.lng,this.sw.lat),h=c.concat(f));return this.supercluster.getClusters(h,this.zoom).map(function(a){var b=0;a.properties&&a.properties.point_count&&(b=a.properties.point_count);return{geometry:a.geometry,count:b}})}},{key:"pick",value:function(a,c){return this.shapeLayer.pick(a,c)}},{key:"shouldUpdate",value:function(){if(!this.data)return!1;var a=this.map.map,c=Math.floor(a.getZoom()),f=this.options,
k=f.maxZoom;f=f.minZoom;c>k?c=k:c<f&&(c=f);if(this.zoom!==c)return this.zoom=c,!0;if(!this.options.enableCluster)return!1;c=a.getBounds();a=c.ne;c=c.sw;if(this.ne.lng!==a.lng||this.ne.lat!==a.lat||this.sw.lng!==c.lng||this.sw.lat!==c.lat)return!0}},{key:"render",value:function(b){this.shouldUpdate()?this.refreshLayer():Ra(a.prototype.__proto__||I(a.prototype),"render",this).call(this,b)}}]);return a}(ib),Lb=function(){function c(a,b){E(this,c);this.map=a;this.options=b||{}}F(c,[{key:"onResize",value:function(a){}},
{key:"onUpdate",value:function(a){throw"\u672a\u5b9e\u73b0onUpdate\u65b9\u6cd5";}},{key:"getContainer",value:function(){throw"\u672a\u5b9e\u73b0getContainer\u65b9\u6cd5";}},{key:"getSize",value:function(){throw"\u672a\u5b9e\u73b0getSize\u65b9\u6cd5";}},{key:"getTilt",value:function(){throw"\u672a\u5b9e\u73b0getTilt\u65b9\u6cd5";}},{key:"getHeading",value:function(){throw"\u672a\u5b9e\u73b0getHeading\u65b9\u6cd5";}},{key:"getZoomUnits",value:function(){throw"\u672a\u5b9e\u73b0getZoomUnits\u65b9\u6cd5";
}},{key:"getCenter",value:function(){throw"\u672a\u5b9e\u73b0getCenter\u65b9\u6cd5";}},{key:"getMapType",value:function(){throw"\u672a\u5b9e\u73b0getMapType\u65b9\u6cd5";}},{key:"lnglatToMercator",value:function(a,b){if("gcj02"===this.options.coordinateSystem)return b=b*Math.PI/180,b=3189068.5*Math.log((1+Math.sin(b))/(1-Math.sin(b))),[parseFloat((a*Math.PI/180*6378137).toFixed(2)),parseFloat(b.toFixed(2))];a=ra.convertLL2MC({lng:a,lat:b});return[a.lng,a.lat]}}]);return c}(),Vg=function(c){function a(b){E(this,
a);return M(this,(a.__proto__||I(a)).call(this,b))}G(a,c);F(a,[{key:"onResize",value:function(a){this.map.addEventListener("resize",a)}},{key:"onMousemove",value:function(a){this.map.addEventListener("mousemove",function(b){a({x:b.x,y:b.y})})}},{key:"onClick",value:function(a){this.map.addEventListener("click",function(b){a({x:b.x,y:b.y})})}},{key:"onUpdate",value:function(a){this.map.addEventListener("update",a);this.map.addEventListener("onearthstatuschange",a)}},{key:"getContainer",value:function(){return this.map.getContainer()}},
{key:"getSize",value:function(){return this.map.getSize()}},{key:"getTilt",value:function(){return this.map.getTilt()}},{key:"getHeading",value:function(){return this.map.getHeading()}},{key:"getZoomUnits",value:function(){return this.map.getZoomUnits()}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"getCenter",value:function(){var a=this.map.getCenter();-180<=a.lng&&180>=a.lng&&(a=this.map.lnglatToMercator(a.lng,a.lat),a={lng:a[0],lat:a[1]});return a}},{key:"getMapType",value:function(){return this.map.getMapType()}},
{key:"lnglatToMercator",value:function(a,c){return this.map.lnglatToMercator(a,c)}}]);return a}(Lb),Wg=function(c){function a(b){E(this,a);b=M(this,(a.__proto__||I(a)).call(this,b));b.div=document.createElement("div");b.div.style.position="absolute";b.div.style.userSelect="none";b.map.getPanes().mapPane.appendChild(b.div);return b}G(a,c);F(a,[{key:"onResize",value:function(a){this.map.addEventListener("resize",a)}},{key:"onMousemove",value:function(a){this.map.addEventListener("mousemove",a)}},{key:"onClick",
value:function(a){this.map.addEventListener("click",a)}},{key:"changeCanvas",value:function(){var a=this.map,c=a.getSize(),f=a.getCenter();a=a.pointToOverlayPixel(f);this.div.style.left=a.x-c.width/2+"px";this.div.style.top=a.y-c.height/2+"px"}},{key:"onUpdate",value:function(a){var b=this;this.map.addEventListener("moveend",function(){b.changeCanvas();a()});this.map.addEventListener("moving",function(){b.changeCanvas();a()});this.map.addEventListener("zoomend",function(){b.changeCanvas();a()})}},
{key:"getContainer",value:function(){return this.div}},{key:"getSize",value:function(){return this.map.getSize()}},{key:"getTilt",value:function(){return 0}},{key:"getHeading",value:function(){return 0}},{key:"getZoomUnits",value:function(){return Math.pow(2,18-this.map.getZoom())}},{key:"getCenter",value:function(){var a=this.map.getMapType().getProjection().lngLatToPoint(this.map.getCenter());return{lng:a.x,lat:a.y}}}]);return a}(Lb),Xg=function(c){function a(b){E(this,a);return M(this,(a.__proto__||
I(a)).call(this,b))}G(a,c);F(a,[{key:"onResize",value:function(a){window.addEventListener("resize",a)}},{key:"onUpdate",value:function(a){}},{key:"getContainer",value:function(){return this.map.container.getElementsByClassName("cesium-widget")[0]}},{key:"getSize",value:function(){var a=this.map;return{width:a.canvas.clientWidth,height:a.canvas.clientHeight}}},{key:"getTilt",value:function(){return 180*this.map.camera.pitch/Math.PI+90}},{key:"getHeading",value:function(){return 360-180*this.map.camera.heading/
Math.PI}},{key:"getZoomUnits",value:function(){var a=this.map;return 6.8*a.scene.globe.ellipsoid.cartesianToCartographic(a.camera.position).height/6500}},{key:"getZoom",value:function(){return 10}},{key:"getCenter",value:function(){var a=this.map;a=a.camera.pickEllipsoid(new Cesium.Cartesian2(a.canvas.clientWidth/2,a.canvas.clientHeight/2));a=Cesium.Ellipsoid.WGS84.cartesianToCartographic(a);a=this.getMercator([180*a.longitude/Math.PI,180*a.latitude/Math.PI]);return{lng:a[0],lat:a[1]}}},{key:"getMercator",
value:function(a){var b=[];b[0]=a[0]*Math.PI/180*6378137;a=a[1]*Math.PI/180;b[1]=3189068.5*Math.log((1+Math.sin(a))/(1-Math.sin(a)));return b}}]);return a}(Lb),Yg=function(c){function a(b){E(this,a);return M(this,(a.__proto__||I(a)).call(this,b))}G(a,c);F(a,[{key:"onResize",value:function(a){window.addEventListener("resize",a)}},{key:"onUpdate",value:function(a){}},{key:"getContainer",value:function(){return this.map.container}},{key:"getSize",value:function(){return{width:this.map.container.clientWidth,
height:this.map.container.clientHeight}}},{key:"getTilt",value:function(){return this.map.tilt}},{key:"getHeading",value:function(){return this.map.heading}},{key:"getZoomUnits",value:function(){return this.map.zoomUnits}},{key:"getCenter",value:function(){return this.map.center}}]);return a}(Lb),Zg=function(c){function a(b,c){E(this,a);return M(this,(a.__proto__||I(a)).call(this,b,c))}G(a,c);F(a,[{key:"onResize",value:function(a){window.addEventListener("resize",a)}},{key:"onUpdate",value:function(a){}},
{key:"getContainer",value:function(){return this.map.container}},{key:"getSize",value:function(){return{width:this.map.container.clientWidth,height:this.map.container.clientHeight}}},{key:"getTilt",value:function(){return this.map.tilt}},{key:"getHeading",value:function(){return this.map.heading}},{key:"getZoomUnits",value:function(){return this.map.zoomUnits}},{key:"getCenter",value:function(){return this.map.center}}]);return a}(Lb),He=function(){function c(a,b){E(this,c);b=b||{};"bmap"===b.mapType?
this.map=new Wg(a,b):"blank"===b.mapType?this.map=new Yg(a,b):"cesium"===b.mapType?this.map=new Xg(a,b):"three"===b.mapType?this.map=new Zg(a,b):(b.mapType="bmapgl",this.map=new Vg(a,b));this.map.type=b.mapType;this.options=b||{};this.renderArr=[];(a=b.canvas)||(a=document.createElement("canvas"));this.canvas=a;this.gl=b.gl?b.gl:dd(a);this.gl.getExtension("OES_element_index_uint");this.changeSize();this.projectionMatrix=T.create(Float64Array);this.orthoMatrix=T.create(Float64Array);this.matrix=T.create(Float64Array);
this.viewMatrix=T.create(Float64Array);this.pointToPixelMatrix=T.create(Float64Array);this.pixelToViewMatrix=T.create(Float64Array);this.fovy=35;this._animation=this.animation.bind(this);this._update=this.update.bind(this);this.onInitialize(this.options.onInitialize);this.options.onRender&&this.renderArr.push(this.options.onRender);this.stateManager=new re({gl:this.gl});this.pickFBO=new pa(this.gl);this.transferOptions={};this.bind()}F(c,[{key:"bind",value:function(){var a=this,b=this.map;b.onResize(function(){a.changeSize();
a.render()});b.onUpdate(this._update);b.onClick&&b.onClick(function(b){a.onClick&&a.onClick(b)});b.onMousemove&&b.onMousemove(function(b){a.onMousemove&&a.onMousemove(b)});this.options.canvas||b.getContainer().appendChild(this.canvas)}},{key:"setOptions",value:function(a){this.options=a}},{key:"onInitialize",value:function(a){a&&(this.transferOptions=a.bind(this)(this.gl)||{})}},{key:"bindFramebuffer",value:function(a){var b=this.gl;a?b.bindFramebuffer(b.FRAMEBUFFER,a.framebuffer):b.bindFramebuffer(b.FRAMEBUFFER,
null)}},{key:"saveFramebuffer",value:function(){var a=this.gl;this.preFramebuffer=a.getParameter(a.FRAMEBUFFER_BINDING)}},{key:"restoreFramebuffer",value:function(){var a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.preFramebuffer)}},{key:"onRender",value:function(a){this.renderArr.push(a)}},{key:"changeSize",value:function(){var a=this.canvas;if(a){var b=a.style,c=this.map.getSize(),f=window.devicePixelRatio;a.width=c.width*f;a.height=c.height*f;b.cssText="position: absolute;left:0;top:0;width:"+
c.width+"px;height:"+c.height+"px;z-index:2;";c=this.options;"cesium"!==c.mapType||c.canvas||(b.pointerEvents="none");this.gl.viewport(0,0,a.width,a.height)}}},{key:"update",value:function(){!1===this.options.autoUpdate||this.isAnimation||this.render()}},{key:"render",value:function(){if(this.map){var a=this.options,b=this.projectionMatrix,c=this.viewMatrix;if("three"===a.mapType)c=this.map.map.camera,b=c.projectionMatrix.elements,c=c.matrixWorldInverse.elements;else if("cesium"===a.mapType){c=this.map.map;
var f=c.camera.frustum.projectionMatrix;b=new Float32Array([f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9],f[10],f[11],f[12],f[13],f[14],f[15]]);f=c.camera.viewMatrix;c=new Float32Array([f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9],f[10],f[11],f[12],f[13],f[14],f[15]])}else"B_EARTH_MAP"===this.map.map.mapType?(b=this.map.map.getEarth().scene._camera.getProjectionMatrix(),c=this.map.map.getEarth().scene._camera.getModelViewMatrix()):(this.updateProjectionMatrix(),this.updateModelViewMatrix());
f=T.multiply(this.matrix,b,c);U(this.transferOptions,{gl:this.gl,matrix:f,pointToPixelMatrix:this.pointToPixelMatrix,pixelToViewMatrix:this.pixelToViewMatrix,projectionMatrix:b,orthoMatrix:this.orthoMatrix,viewMatrix:c,stateManager:this.stateManager});"three"!==a.mapType&&"cesium"!==a.mapType&&!1!==a.autoUpdate&&this.clear();for(a=0;a<this.renderArr.length;a++)this.renderArr[a]&&this.renderArr[a].bind(this)(this.transferOptions)}}},{key:"clear",value:function(a){var b=this.gl,c=this.options.clearColor||
[0,0,0,0];b.clearColor(c[0],c[1],c[2],c[3]);a&&(a instanceof Array||(a=ba(a).unitArray()),b.clearColor(a[0],a[1],a[2],a[3]));b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT)}},{key:"updateProjectionMatrix",value:function(){var a=this.gl.canvas.width/this.gl.canvas.height,b=this.options.cameraNear||1,c=this.options.cameraFar||4E3;T.perspective(this.projectionMatrix,fa(this.fovy),a,b,c);a=this.map.getSize();T.ortho(this.orthoMatrix,-a.width/2,a.width/2,-a.height/2,a.height/2,b,c)}},{key:"updateModelViewMatrix",
value:function(){var a=this.map,b=this.viewMatrix,c=this.pointToPixelMatrix,f=this.pixelToViewMatrix;T.identity(b);T.identity(c);T.identity(f);var k=a.getSize();k=Math.round(-k.height/(2*Math.tan(fa(this.fovy)/2)));T.translate(f,f,[0,0,k]);T.rotate(f,f,fa(a.getTilt()),[-1,0,0]);T.rotate(f,f,fa(a.getHeading()),[0,0,-1]);k=a.getCenter();var g=this.options.pointOffset||[0,0];a=a.getZoomUnits();T.translate(c,c,[(g[0]-k.lng)/a,(g[1]-k.lat)/a,0]);a=1/a;T.scale(c,c,[a,a,a]);T.multiply(b,f,c)}},{key:"destroy",
value:function(){this.stopAnimation();this.map.getContainer().removeChild(this.canvas);this.canvas=null}},{key:"animation",value:function(){this.isAnimation&&(this.render(),window.requestAnimationFrame(this._animation))}},{key:"startAnimation",value:function(){this.isAnimation||(this.isAnimation=!0,window.requestAnimationFrame(this._animation))}},{key:"stopAnimation",value:function(){this.isAnimation=!1}}]);return c}(),Ie={circle:1,square:2},Yc=function(c){function a(b){E(this,a);b=M(this,(a.__proto__||
I(a)).call(this,b));b.bufferData=[];return b}G(a,c);F(a,[{key:"getDefaultOptions",value:function(){return{color:[.1,.1,.9,1],blend:"normal",shape:"circle",size:5}}},{key:"initialize",value:function(a){this.gl=a;var b=this.getOptions();this.program=new Q(this.gl,{vertexShader:"attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;uniform mat4 uMatrix;varying vec4 vColor;uniform vec4 uSelectedColor;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=uMatrix*vec4(aPos.xyz,1.0);gl_PointSize=aSize;\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\n}",
fragmentShader:"varying vec4 vColor;uniform int uShape;void main(void){vec4 color=vColor;if(uShape==1){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}float blur=1.0;blur=1.0-smoothstep(0.49,0.5,d);color.a*=blur;gl_FragColor=color;}else{gl_FragColor=color;}}",defines:b.enablePicked?["PICK"]:[]},this);this.buffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});b=[{stride:32,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:32,name:"aColor",buffer:this.buffer,
size:4,type:"FLOAT",offset:12},{stride:32,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:28}];b=b.concat(this.getCommonAttributes());this.vertexArray=new sa({gl:a,program:this.program,attributes:b})}},{key:"onChanged",value:function(a,c){if(this.gl){for(var b=[],d=a.color,g=a.size,h=0;h<c.length;h++){var m=this.normizedPoint(c[h].geometry.coordinates),n=c[h].color||d;"properties"in c[h]&&"color"in c[h].properties&&(n=c[h].properties.color);"[object Function]"===Object.prototype.toString.call(n)&&
(n=n(c[h]));n=this.normizedColor(n);var p=c[h].size||g;"properties"in c[h]&&"size"in c[h].properties&&(p=c[h].properties.size);p="[object Function]"===Object.prototype.toString.call(p)?p(c[h]):Number(p);m=this.addMultipleCoords(m);for(var l=0;l<m.length;l++){var r=m[l];b.push(r[0],r[1],Number(r[2]||0));b.push(n[0],n[1],n[2],n[3]);b.push(p*window.devicePixelRatio)}}this.bufferData=b;this.buffer.updateData(new Float32Array(b));a.enablePicked&&this.parsePickData(c)}}},{key:"parsePickData",value:function(a){var b=
this.getOptions(),c=[];if(b.enablePicked)for(var k=0;k<a.length;k++){var g=this.indexToRgb(k);c.push(g[0]/255,g[1]/255,g[2]/255);b.repeat&&(c.push(g[0]/255,g[1]/255,g[2]/255),c.push(g[0]/255,g[1]/255,g[2]/255))}b.enablePicked&&this.pickBuffer.updateData(new Float32Array(c))}},{key:"destroy",value:function(){this.buffer=this.program=this.bufferData=null}},{key:"render",value:function(a){var b=a.gl,c=a.matrix,k=a.isPickRender;if(!(0>=this.bufferData.length)){this.getOptions();var g=this.program;g.use(b);
this.vertexArray.bind();var h=1;this.options.shape&&Ie[this.options.shape]&&(h=Ie[this.options.shape]);a=this.getCommonUniforms(a);a=U(a,{uShape:h,uMatrix:c});g.setUniforms(a);c=this.options.blend;k?b.disable(b.BLEND):(b.enable(b.BLEND),b.blendEquation(b.FUNC_ADD),c&&"lighter"===c?b.blendFunc(b.SRC_ALPHA,b.ONE):b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA));b.drawArrays(b.POINTS,0,this.bufferData.length/8)}}}]);return a}(da),$g=function(c){function a(b){E(this,a);b=M(this,(a.__proto__||I(a)).call(this,
b));b.bufferData=[];b.date=new Date;b.autoUpdate=!0;return b}G(a,c);F(a,[{key:"getDefaultOptions",value:function(){return{color:[.1,.1,.9,1],blend:"normal",size:20,unit:"px",duration:2}}},{key:"initialize",value:function(a){this.gl=a;var b=this.getOptions();this.program=new Q(this.gl,{vertexShader:"attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;uniform mat4 uMatrix;uniform vec4 uSelectedColor;uniform float uTime;uniform float duration;uniform float zoomUnits;varying vec4 vColor;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}float percent=mod(uTime,duration)/duration;vColor.a=1.-percent;gl_Position=uMatrix*vec4(aPos.xyz,1.0);gl_PointSize=aSize/zoomUnits*percent;\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\n}",
fragmentShader:"varying vec4 vColor;void main(void){vec4 color=vColor;float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}float blur=1.0;blur=1.0-smoothstep(0.49,0.5,d);color.a*=blur;gl_FragColor=color;}",defines:b.enablePicked?["PICK"]:[]},this);this.buffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});b=[{stride:32,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:32,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:12},{stride:32,name:"aSize",
buffer:this.buffer,size:1,type:"FLOAT",offset:28}];b=b.concat(this.getCommonAttributes());this.vertexArray=new sa({gl:a,program:this.program,attributes:b})}},{key:"onChanged",value:function(a,c){if(this.gl){for(var b=[],d=a.color,g=a.size,h=0;h<c.length;h++){var m=c[h].geometry.coordinates,n=c[h].color||d;"properties"in c[h]&&"color"in c[h].properties&&(n=c[h].properties.color);"[object Function]"===Object.prototype.toString.call(n)&&(n=n(c[h]));n=this.normizedColor(n);m=this.normizedPoint(m);var p=
c[h].size||g;"properties"in c[h]&&"size"in c[h].properties&&(p=c[h].properties.size);p="[object Function]"===Object.prototype.toString.call(p)?p(c[h]):Number(p);b.push(m[0],m[1],Number(m[2]||0));b.push(n[0],n[1],n[2],n[3]);b.push(p*window.devicePixelRatio)}this.bufferData=b;this.buffer.updateData(new Float32Array(b));a.enablePicked&&this.parsePickData(c)}}},{key:"parsePickData",value:function(a){var b=this.getOptions(),c=[];if(b.enablePicked)for(var k=0;k<a.length;k++){var g=this.indexToRgb(k);c.push(g[0]/
255,g[1]/255,g[2]/255)}b.enablePicked&&this.pickBuffer.updateData(new Float32Array(c))}},{key:"destroy",value:function(){this.buffer=this.program=this.bufferData=null}},{key:"render",value:function(a){var b=a.gl,c=a.matrix,k=a.isPickRender;if(!(0>=this.bufferData.length)){var g=this.getOptions(),h=this.program;h.use(b);this.vertexArray.bind();a=this.getCommonUniforms(a);var m=1;"m"===g.unit&&this.map&&(m=this.map.getZoomUnits());a=U(a,{zoomUnits:m,uTime:(new Date-this.date)/1E3,duration:g.duration,
uMatrix:c});h.setUniforms(a);c=this.options.blend;k?b.disable(b.BLEND):(b.enable(b.BLEND),b.blendEquation(b.FUNC_ADD),c&&"lighter"===c?b.blendFunc(b.SRC_ALPHA,b.ONE):b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA));b.drawArrays(b.POINTS,0,this.bufferData.length/8)}}}]);return a}(da),ah=function(c){function a(b,c){E(this,a);b=M(this,(a.__proto__||I(a)).call(this,b,c));b.bufferData=[];b.startTime=b.options.startTime||0;b.endTime=b.options.endTime;b.time=b.startTime;b.segs=b.options.segs||10;b.autoUpdate=
!0;return b}G(a,c);F(a,[{key:"getDefaultOptions",value:function(){return{color:[.9,.1,.1,1],trailLength:3,height:100,step:.1,segs:10}}},{key:"setTime",value:function(a){this.time=a}},{key:"initialize",value:function(a){this.gl=a;this.program=new Q(this.gl,{vertexShader:"precision mediump float;attribute vec4 aPos;uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;varying float vTime;void main(){gl_Position=u_matrix*vec4(aPos.xyz,1.0);vTime=1.0-((currentTime-aPos.w)/trailLength);}",
fragmentShader:"precision mediump float;uniform vec3 uFragColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(uFragColor,1.0*vTime);}"});this.buffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.buffer)}},{key:"onChanged",value:function(a,c){var b=this.gl;if(b){this.buffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.buffer);for(var d=[],g=a.height,h=0;h<c.length;h++){var m=c[h].geometry.coordinates;var n="[object Function]"===Object.prototype.toString.call(g)?
g(c[h]):Number(g);for(var p=0,l=0;l<this.segs;l++){var r=this.normizedPoint(m);d.push(r[0],r[1],p);void 0===m[2]?d.push(l):d.push(Number(m[2]));p+=n/this.segs;d.push(r[0],r[1],p);void 0===m[2]?d.push(l+1):d.push(Number(m[2]))}}void 0===a.endTime&&(this.endTime=this.segs);this.bufferData=d;b.bufferData(b.ARRAY_BUFFER,new Float32Array(d),b.STATIC_DRAW);this.webglLayer&&this.webglLayer.render()}}},{key:"render",value:function(a){var b=a.gl,c=a.matrix;a=this.program;b.useProgram(a.program);b.uniformMatrix4fv(a.uniforms.u_matrix,
!1,c);b.bindBuffer(b.ARRAY_BUFFER,this.buffer);b.enableVertexAttribArray(a.attributes.aPos);b.vertexAttribPointer(a.attributes.aPos,4,b.FLOAT,!1,0,0);c=this.normizedColor(this.options.color);b.uniform3f(a.uniforms.uFragColor,c[0],c[1],c[2]);b.uniform1f(a.uniforms.currentTime,this.time);b.uniform1f(a.uniforms.trailLength,this.options.trailLength);b.enable(b.BLEND);b.polygonOffset(2,1);b.blendFunc(b.SRC_ALPHA,b.ONE);b.blendEquation(b.FUNC_ADD);b.drawArrays(b.LINES,0,this.bufferData.length/4);b.bindBuffer(b.ARRAY_BUFFER,
null);b.disable(b.BLEND);this.time+=this.options.step;this.time>1.5*this.endTime&&(this.time=this.startTime);b.useProgram(null)}}]);return a}(da),bh=function(c){function a(b){E(this,a);b=M(this,(a.__proto__||I(a)).call(this,b));b.pointLayer=new Yc(b.options);b.textLayer=new Xc(b.options.textOptions);b.children=[b.pointLayer,b.textLayer];return b}G(a,c);F(a,[{key:"getDefaultOptions",value:function(){return{minSize:25,maxSize:40,clusterRadius:200,showText:!0,maxZoom:19,minZoom:4,gradient:{0:"rgb(50, 50, 256)",
"0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"},textOptions:{fontSize:12,color:"white"}}}},{key:"onOptionsChanged",value:function(a){this.textLayer.setOptions(a.textOptions)}},{key:"setOptions",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},c=this.options.textOptions;a.textOptions&&U(c,a.textOptions);var f=a.minZoom,k=a.maxZoom,g=a.clusterRadius;f=k&&k!==this.options.maxZoom||f&&f!==this.options.minZoom||g&&g!==this.options.clusterRadius;
U(this.options,a,{textOptions:c});if(f)this.onChanged(this.options,this.data);else this.refreshCluster();this.onOptionsChanged(this.getOptions())}},{key:"onChanged",value:function(a,c){c&&c.length&&(this.supercluster=new Ge({maxZoom:a.maxZoom,minZoom:a.minZoom,radius:a.clusterRadius,extent:256}),this.supercluster.load(c),this.supercluster.trees.forEach(function(a){var b=0,c=Infinity;a.points.forEach(function(a){b=Math.max(a.numPoints||0,b);c=Math.min(a.numPoints||Infinity,c)});a.max=b;a.min=c}),this.refreshCluster())}},
{key:"refreshCluster",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options,c=this.getClusterData(a);c&&c.length&&(this.pointLayer.setData(c),this.textLayer.setData(a.showText?c:[]),a.enablePicked&&a.autoSelect&&this.pick(-1,-1))}},{key:"getClusterData",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options,c=this.map.map,f=c.getBounds(),k=f.ne;f=f.sw;this.ne=k;this.sw=f;var g=k,h=g.lng;g=g.lat;-180<=h&&180>=h&&-90<=g&&90>=g?
k=[f.lng,f.lat,k.lng,k.lat]:(k=c.mercatorToLnglat(this.ne.lng,this.ne.lat),f=c.mercatorToLnglat(this.sw.lng,this.sw.lat),k=f.concat(k));c=Math.floor(c.getZoom());k=this.supercluster.getClusters(k,c);this.zoom!==c&&0<k.length&&(this.zoom=c,h=this.supercluster.trees,f=h[c]&&h[c].max||this.max,c=h[c]&&h[c].min||this.min,f!==c&&(this.max=f,this.min=c));return this.processData(k,a)}},{key:"processData",value:function(a,c){var b=c.defaultColor,d=c.defaultSize,g=c.gradient,h=c.minSize,m=c.textOptions,n=
new ia({max:this.max,min:~~this.min||1,minSize:h||8,maxSize:c.maxSize||30,gradient:g});b=b||g[0]||"black";d=d||.5*h||5;var p=m&&m.format;p="function"===typeof p?p:null;return a.map(function(a){var c=d,f=b,g=0;a.properties&&a.properties.point_count&&(g=a.properties.point_count,c=n.getSize(g)||c,f=n.getColor(g),g=p?p(g):g);return{geometry:a.geometry,properties:{text:g,size:c,color:f}}})}},{key:"pick",value:function(a,c){return this.pointLayer.pick(a,c)}},{key:"shouldUpdate",value:function(){if(!this.data||
!this.supercluster)return!1;var a=this.map.map;if(this.zoom!==Math.floor(a.getZoom()))return!0;var c=a.getBounds();a=c.ne;c=c.sw;if(this.ne.lng!==a.lng||this.ne.lat!==a.lat||this.sw.lng!==c.lng||this.sw.lat!==c.lat)return!0}},{key:"render",value:function(b){this.shouldUpdate()?this.refreshCluster():Ra(a.prototype.__proto__||I(a.prototype),"render",this).call(this,b)}}]);return a}(ib),ch=function(c){function a(b,c){E(this,a);return M(this,(a.__proto__||I(a)).call(this,b,c))}G(a,c);F(a,[{key:"getDefaultOptions",
value:function(){return U(Ra(a.prototype.__proto__||I(a.prototype),"getDefaultOptions",this).call(this),{style:"grid",gridSize:500,gradient:{0:"rgb(50, 50, 256)","0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}})}},{key:"onChanged",value:function(b,c){this.gl&&(c=this.processData(c,b),Ra(a.prototype.__proto__||I(a.prototype),"onChanged",this).call(this,b,c))}},{key:"generateGrid",value:function(a,c){var b=c.gridSize,d=[],g={};c=a.length;for(var h=this.getPointOffset(),m=0;m<
c;m++){var n=this.normizedPoint(a[m].geometry.coordinates);n=~~((n[0]+h[0])/b)+"_"+~~((n[1]+h[1])/b);void 0===g[n]&&(g[n]=0);var p=~~a[m].count||1;"properties"in a[m]&&"count"in a[m].properties&&(p=~~a[m].properties.count);g[n]+=p}wa(g).forEach(function(a){var c=a.split("_");d.push([c[0]*b+b/2,c[1]*b+b/2,g[a]])});return d}},{key:"processData",value:function(a,c){var b=[];if("normal"===c.style)for(var d=this.getPointOffset(),g=0;g<a.length;g++){var h=this.normizedPoint(a[g].geometry.coordinates),m=
h[0]+d[0];h=h[1]+d[1];var n=~~a[g].count||1;"properties"in a[g]&&"count"in a[g].properties&&(n=~~a[g].properties.count);b.push([m,h,n])}else b=this.generateGrid(a,c);d=a=0;if(void 0!==c.max&&void 0!==c.min)a=c.max,d=c.min;else{b[0]&&(a=b[0][2],d=b[0][2]);g=b.length;for(m=0;m<g;m++)h=b[m],a=Math.max(h[2],a),d=Math.min(h[2],d);a/=2}c=new ia({max:~~a,min:d,gradient:c.gradient});a=[];for(d=0;d<b.length;d++)g=b[d],g[0]=g[0],g[1]=g[1],m=c.getImageData(g[2]),a.push({geometry:{type:"Point",coordinates:[g[0],
g[1]]},color:[m[0]/255,m[1]/255,m[2]/255,m[3]/255]});return a}}]);return a}(Yc),dh=function(c){function a(b,c){E(this,a);b=M(this,(a.__proto__||I(a)).call(this,b,c));b.bufferData=[];return b}G(a,c);F(a,[{key:"getDefaultOptions",value:function(){return{color:[1,.05,.05,1]}}},{key:"onChanged",value:function(a,c){if(a=this.gl){this.buffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.buffer);for(var b=[],d=0;20>d;d++)for(var g=5*d,h=0;h<c.length;h++)for(var m=c[h].geometry.coordinates,n=0;n<m.length-
1;n++){var p=this.normizedPoint(m[n]);b.push(p[0]);b.push(p[1]);b.push(Number(g));p=this.normizedPoint(m[n+1]);b.push(p[0]);b.push(p[1]);b.push(Number(g))}a.bufferData(a.ARRAY_BUFFER,new Float32Array(b),a.STATIC_DRAW);this.bufferData=b;a.bindBuffer(a.ARRAY_BUFFER,null)}}},{key:"initialize",value:function(a){this.gl=a;this.program=new Q(a,{vertexShader:"uniform mat4 uMatrix;attribute vec3 aPos;void main(){gl_PointSize=10.0;gl_Position=uMatrix*vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform vec4 uFragColor;void main(){gl_FragColor=uFragColor;}"});
this.buffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.buffer)}},{key:"render",value:function(a){var b=a.gl;a=a.matrix;var c=this.program;b.useProgram(c.program);var k=this.normizedColor(this.options.color);b.uniform4f(c.uniforms.uFragColor,k[0],k[1],k[2],k[3]);b.uniformMatrix4fv(c.uniforms.uMatrix,!1,a);b.bindBuffer(b.ARRAY_BUFFER,this.buffer);b.enableVertexAttribArray(c.attributes.aPos);b.vertexAttribPointer(c.attributes.aPos,3,b.FLOAT,!1,0,0);b.enable(b.BLEND);b.blendEquation(b.FUNC_ADD);
b.blendFunc(b.ONE,b.ONE);b.drawArrays(b.LINES,0,this.bufferData.length/3);b.bindBuffer(b.ARRAY_BUFFER,null)}}]);return a}(da),Je={circle:1,square:2},eh=function(c){function a(b,c){E(this,a);b=M(this,(a.__proto__||I(a)).call(this,b,c));b.bufferData=[];b.startTime=b.options.startTime||0;b.endTime=b.options.endTime;b.time=b.startTime;b.autoUpdate=!0;return b}G(a,c);F(a,[{key:"initialize",value:function(a){this.gl=a;this.program=new Q(this.gl,{vertexShader:"attribute vec4 aPos;attribute vec4 aColor;attribute float aSize;uniform mat4 u_matrix;varying vec4 vColor;uniform float currentTime;uniform float trailLength;varying float vTime;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=u_matrix*vec4(aPos.xyz,1.0);gl_PointSize=aSize;vTime=1.0-((currentTime-aPos.w)/trailLength);}",
fragmentShader:"precision highp float;varying vec4 vColor;uniform int uShape;varying float vTime;void main(void){if(vTime>1.0||vTime<0.0){discard;}if(uShape==1){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d<0.5){gl_FragColor=vColor;}else{discard;}}else{gl_FragColor=vec4(vColor.rgb,vColor.a*vTime);}}"});this.f32BufferData=new Float32Array;this.buffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.buffer)}},{key:"onChanged",value:function(a,c){var b=this.gl;if(b){this.buffer=b.createBuffer();
b.bindBuffer(b.ARRAY_BUFFER,this.buffer);for(var d=[],g=a.color||[.1,.1,.9,1],h=a.size||5,m=0;m<c.length;m++){var n=c[m].geometry.coordinates,p=c[m].color||g;"[object Function]"===Object.prototype.toString.call(p)&&(p=p(c[m]));"properties"in c[m]&&"color"in c[m].properties&&(p=c[m].properties.color);p=this.normizedColor(p);var l=this.normizedPoint(n),r=h;r="[object Function]"===Object.prototype.toString.call(r)?r(c[m]):Number(r);var q=c[m].time||m;"properties"in c[m]&&"time"in c[m].properties&&(q=
c[m].properties.time);d.push(l[0],l[1],Number(n[2]||0),q);d.push(p[0],p[1],p[2],p[3]);d.push(r*window.devicePixelRatio)}void 0===a.endTime&&(this.endTime=c.length);this.bufferData=d;this.f32BufferData=new Float32Array(d);b.bufferData(b.ARRAY_BUFFER,this.f32BufferData,b.STATIC_DRAW)}}},{key:"render",value:function(a){var b=a.gl,c=a.matrix;0>=this.bufferData.length||(a=this.program,b.useProgram(a.program),b.uniformMatrix4fv(a.uniforms.u_matrix,!1,c),b.bindBuffer(b.ARRAY_BUFFER,this.buffer),c=this.f32BufferData.BYTES_PER_ELEMENT,
b.enableVertexAttribArray(a.attributes.aPos),b.vertexAttribPointer(a.attributes.aPos,4,b.FLOAT,!1,9*c,0),b.enableVertexAttribArray(a.attributes.aColor),b.vertexAttribPointer(a.attributes.aColor,4,b.FLOAT,!1,9*c,4*c),b.enableVertexAttribArray(a.attributes.aSize),b.vertexAttribPointer(a.attributes.aSize,1,b.FLOAT,!1,9*c,8*c),b.uniform1f(a.uniforms.currentTime,this.time),b.uniform1f(a.uniforms.trailLength,this.options.trailLength||3),c=1,this.options.shape&&Je[this.options.shape]&&(c=Je[this.options.shape]),
b.uniform1i(a.uniforms.uShape,c),a=this.options.blend,b.enable(b.BLEND),b.blendEquation(b.FUNC_ADD),a&&"lighter"===a?b.blendFunc(b.SRC_ALPHA,b.ONE):b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA),b.drawArrays(b.POINTS,0,this.bufferData.length/9),b.bindBuffer(b.ARRAY_BUFFER,null),b.disable(b.BLEND),b.useProgram(null),this.time+=this.options.step||.1,this.time>this.endTime&&(this.time=this.startTime))}}]);return a}(da),fh=function(c){function a(b,c){E(this,a);b=M(this,(a.__proto__||I(a)).call(this,b,
c));b.bufferData=[];b.startTime=b.options.startTime||0;b.endTime=b.options.endTime;b.time=b.startTime;b.autoUpdate=!0;return b}G(a,c);F(a,[{key:"getDefaultOptions",value:function(){return{color:[1,.05,.05,1],trailLength:3,step:.1}}},{key:"initialize",value:function(a){this.gl=a;this.program=new Q(this.gl,{vertexShader:"precision highp float;attribute vec4 aPos;attribute vec4 aColor;uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;varying float vTime;varying vec4 vColor;void main(){gl_Position=u_matrix*vec4(aPos.xyz,1.0);vColor=aColor;vTime=1.0-((currentTime-aPos.w)/trailLength);}",
fragmentShader:"precision highp float;uniform vec3 uFragColor;varying vec4 vColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(vColor.rgb,1.0*vTime);}"},this);this.buffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.buffer)}},{key:"setTime",value:function(a){this.time=a}},{key:"onChanged",value:function(a,c){var b=this.gl;if(b){this.buffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.buffer);for(var d=[],g=0,h=this.options.color,m=0;m<c.length;m++){var n=
c[m].geometry.coordinates;c[m].color&&(h=c[m].color);"properties"in c[m]&&"color"in c[m].properties&&(h=c[m].properties.color);"[object Function]"===Object.prototype.toString.call(h)&&(h=h(c[m]));h=this.normizedColor(h);n.length>g&&(g=n.length);for(var p=0;p<n.length-1;p++){var l=this.normizedPoint(n[p]);d.push(l[0]);d.push(l[1]);d.push(l[2]);void 0===n[p][3]?d.push(p):d.push(Number(n[p][3]));d.push(h[0]);d.push(h[1]);d.push(h[2]);d.push(h[3]);l=this.normizedPoint(n[p+1]);d.push(l[0]);d.push(l[1]);
d.push(l[2]);void 0===n[p+1][3]?d.push(p+1):d.push(Number(n[p+1][3]));d.push(h[0]);d.push(h[1]);d.push(h[2]);d.push(h[3])}}void 0===a.endTime&&(this.endTime=g);this.bufferData=d;this.f32BufferData=new Float32Array(d);b.bufferData(b.ARRAY_BUFFER,this.f32BufferData,b.STATIC_DRAW)}}},{key:"render",value:function(a){var b=a.gl,c=a.matrix;a=this.program;a.use(b);b.uniformMatrix4fv(a.uniforms.u_matrix,!1,c);b.bindBuffer(b.ARRAY_BUFFER,this.buffer);c=this.f32BufferData.BYTES_PER_ELEMENT;b.enableVertexAttribArray(a.attributes.aPos);
b.vertexAttribPointer(a.attributes.aPos,4,b.FLOAT,!1,8*c,0);b.enableVertexAttribArray(a.attributes.aColor);b.vertexAttribPointer(a.attributes.aColor,4,b.FLOAT,!1,8*c,4*c);c=this.normizedColor(this.options.color);b.uniform3f(a.uniforms.uFragColor,c[0],c[1],c[2]);b.uniform1f(a.uniforms.currentTime,this.time);b.uniform1f(a.uniforms.trailLength,this.options.trailLength);b.enable(b.BLEND);b.polygonOffset(2,1);"lighter"===this.options.blend?b.blendFunc(b.ONE,b.ONE):b.blendFunc(b.SRC_ALPHA,b.ONE);b.blendEquation(b.FUNC_ADD);
b.drawArrays(b.LINES,0,this.bufferData.length/8);b.bindBuffer(b.ARRAY_BUFFER,null);this.time+=this.options.step;this.time>this.endTime&&(this.time=this.startTime);b.useProgram(null)}}]);return a}(da),Ke=function(c){function a(b,c){E(this,a);b=M(this,(a.__proto__||I(a)).call(this,b,c));b.initData();b.date=new Date;b.autoUpdate=!0;return b}G(a,c);F(a,[{key:"getDefaultOptions",value:function(){return{color:"rgba(25, 25, 250, 1)",blend:"normal",width:2,antialias:!1,lineJoin:"miter",interval:.1,duration:2,
trailLength:.5,zoom:4}}},{key:"initData",value:function(){this.dataMgr={position:[],prev:[],next:[],direction:[],color:[],index:[],counter:[]}}},{key:"initialize",value:function(a){this.gl=a;var b=this.getOptions();this.program=new Q(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float thickness;uniform int miter;uniform vec4 uSelectedColor;attribute vec3 position;attribute vec3 next;attribute vec3 previous;attribute float direction;attribute vec4 aColor;attribute float aCounter;attribute vec2 uv;varying vec4 vColor;varying vec2 vNormal;varying float vCounter;vec2 project(vec4 coord){vec3 screen=coord.xyz/coord.w;vec2 clip=(screen.xy+1.0)/2.0;return clip*MAPV_resolution;}vec4 unproject(vec2 projected,float z,float w){vec2 clip=projected/MAPV_resolution;vec2 screen=clip*2.0-1.0;return vec4(screen*w,z,w);}void main(){vColor=aColor;vCounter=aCounter;\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\nvec4 previousProjected=u_matrix*vec4(previous,1.0);vec4 currentProjected=u_matrix*vec4(position,1.0);vec4 nextProjected=u_matrix*vec4(next,1.0);vec2 currentScreen=project(currentProjected);vec2 previousScreen=project(previousProjected);vec2 nextScreen=project(nextProjected);float len=thickness;float orientation=direction;vec2 dir=vec2(0.0);if(currentScreen==previousScreen){dir=normalize(nextScreen-currentScreen);}else if(currentScreen==nextScreen){dir=normalize(currentScreen-previousScreen);}else{vec2 dirA=normalize((currentScreen-previousScreen));if(miter==1){vec2 dirB=normalize((nextScreen-currentScreen));vec2 tangent=normalize(dirA+dirB);vec2 perp=vec2(-dirA.y,dirA.x);vec2 miter=vec2(-tangent.y,tangent.x);dir=tangent;}else{dir=dirA;}}vec2 normal=vec2(-dir.y,dir.x);vNormal=normal*orientation;normal*=len/2.0;vec2 pos=currentScreen+normal*orientation;vec4 finalPos=unproject(pos,currentProjected.z,currentProjected.w);gl_Position=finalPos;}",
fragmentShader:"precision highp float;uniform bool uAntialias;uniform bool uAnimate;uniform float uTime;uniform float duration;uniform float interval;uniform float trailLength;varying vec4 vColor;varying vec2 vNormal;varying float vCounter;void main(){vec4 color=vColor;if(uAntialias){float blur=1.0;blur=1.0-smoothstep(0.98,1.0,length(vNormal));color.a*=blur;}if(uAnimate){float alpha=1.0-fract(mod(1.0-vCounter,interval)*(1.0/interval)+uTime/duration);alpha=(alpha+trailLength-1.0)/trailLength;color.a*=alpha;}gl_FragColor=color;}",
defines:b.enablePicked?["PICK"]:[]},this);this.prevBuffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.currentBuffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.nextBuffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.directionBuffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.colorBuffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.counterBuffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.indexBuffer=
new L({gl:a,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});b=[{stride:12,name:"previous",buffer:this.prevBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"position",buffer:this.currentBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"next",buffer:this.nextBuffer,size:3,type:"FLOAT",offset:0},{stride:4,name:"direction",buffer:this.directionBuffer,size:1,type:"FLOAT",offset:0},{stride:16,name:"aColor",buffer:this.colorBuffer,size:4,type:"FLOAT",offset:0},{stride:4,name:"aCounter",buffer:this.counterBuffer,
size:1,type:"FLOAT",offset:0}];b=b.concat(this.getCommonAttributes());this.vertexArray=new sa({gl:a,program:this.program,attributes:b})}},{key:"onChanged",value:function(a,c){var b=this;if(this.gl){this.initData();for(var d=1,g=[],h=0;h<c.length;h++){var m=[],n=c[h].geometry.coordinates;n&&0<n.length&&(m="Polygon"===c[h].geometry.type?n[0].map(function(a){return b.normizedPoint(a)}):n.map(function(a){return b.normizedPoint(a)}));m=Bd(m);n=m.total;g[h]=m.arr;d=Math.max(n,d)}h=[];m=a.color;for(n=0;n<
c.length;n++){var p=[],l=c[n].geometry.coordinates;l&&0<l.length&&(p="Polygon"===c[n].geometry.type?l[0].map(function(a){return b.normizedPoint(a)}):l.map(function(a){return b.normizedPoint(a)}));l=c[n].color||m;"properties"in c[n]&&"color"in c[n].properties&&(l=c[n].properties.color);"[object Function]"===Object.prototype.toString.call(l)&&(l=l(c[n]));l=this.normizedColor(l);for(var r=this.addMultipleCoords(p),q=0;q<r.length;q++)this.processData(this.dataMgr,r[q],g[n],d,l);if(a.enablePicked)for(l=
this.indexToRgb(n),r=0;r<p.length;r++)h.push(l[0]/255,l[1]/255,l[2]/255),h.push(l[0]/255,l[1]/255,l[2]/255),a.repeat&&(h.push(l[0]/255,l[1]/255,l[2]/255),h.push(l[0]/255,l[1]/255,l[2]/255),h.push(l[0]/255,l[1]/255,l[2]/255),h.push(l[0]/255,l[1]/255,l[2]/255))}this.counterBuffer.updateData(new Float32Array(this.dataMgr.counter));this.currentBuffer.updateData(new Float32Array(this.dataMgr.position));this.prevBuffer.updateData(new Float32Array(this.dataMgr.prev));this.nextBuffer.updateData(new Float32Array(this.dataMgr.next));
this.directionBuffer.updateData(new Float32Array(this.dataMgr.direction));this.colorBuffer.updateData(new Float32Array(this.dataMgr.color));this.indexBuffer.updateData(new Uint32Array(this.dataMgr.index));a.enablePicked&&this.pickBuffer.updateData(new Float32Array(h))}}},{key:"processData",value:function(a,c,f,k,g){var b,d,n,p,l,r,q,t=c.length,v=a.position.length/6;f=ua(f.map(function(a){return a/k}));var w=ua(c.map(function(a){return 1}),!0),x=ua(c),u=ua(c.map(Sb(-1))),A=ua(c.map(Sb(1)));c=ua(c.map(function(a){return g}));
t=Ad(t,v);(b=a.counter).push.apply(b,aa(f));(d=a.position).push.apply(d,aa(Ka(x)));(n=a.prev).push.apply(n,aa(Ka(u)));(p=a.next).push.apply(p,aa(Ka(A)));(l=a.direction).push.apply(l,aa(w));(r=a.color).push.apply(r,aa(Ka(c)));(q=a.index).push.apply(q,aa(t))}},{key:"render",value:function(a){var b=a.gl,c=a.matrix,k=this.dataMgr;if(k&&!(0>=k.index.length)){var g=this.getOptions(),h=this.program;h.use(b);var m=this.map?this.map.getZoom()>=g.zoom&&this.autoUpdate?!0:!1:!0;h.setUniforms(U(this.getCommonUniforms(a),
{u_matrix:c,miter:1,thickness:g.width,uAntialias:g.antialias,uTime:(new Date-this.date)/1E3,uAnimate:m,duration:g.duration,interval:g.interval,trailLength:g.trailLength}));b.enable(b.BLEND);b.blendEquation(b.FUNC_ADD);g.blend&&"lighter"===g.blend?b.blendFunc(b.SRC_ALPHA,b.ONE):b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);this.indexBuffer.bind();this.vertexArray.bind();b.drawElements(b.TRIANGLES,k.index.length,b.UNSIGNED_INT,0);b.bindBuffer(b.ARRAY_BUFFER,null);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,
null);b.disable(b.BLEND)}}}]);return a}(da),gh=function(c){function a(b,c){E(this,a);return M(this,(a.__proto__||I(a)).call(this,b,c))}G(a,c);F(a,[{key:"getDefaultOptions",value:function(){return{}}},{key:"initialize",value:function(a){this.gl=a;var b=this.getOptions();this.texture=null;this.program=new Q(this.gl,{vertexShader:"precision highp float;attribute vec3 a_pos;attribute vec2 a_texture_coord;uniform sampler2D uTerrain;uniform mat4 u_proj_matrix;uniform mat4 u_mv_matrix;varying vec2 v_texture_coord;void main(){v_texture_coord=a_texture_coord;vec3 pos=a_pos.xyz;\n#if defined(TERRAIN)\nvec4 terrainColor=texture2D(uTerrain,vec2(v_texture_coord.s,v_texture_coord.t));vec3 rgb=terrainColor.rgb*256.0;pos.z=-10000.0+((rgb.r*256.0*256.0+rgb.g*256.0+rgb.b)*0.1);pos.z=pos.z-60.0;\n#endif\nvec4 position=u_proj_matrix*u_mv_matrix*vec4(pos,1.0);gl_Position=position;}",
fragmentShader:"precision highp float;varying vec2 v_texture_coord;uniform sampler2D uTile;uniform bool uUseFilter;uniform vec4 uFilterColor;void main(){vec4 textureColor=texture2D(uTile,vec2(v_texture_coord.s,v_texture_coord.t));if(uUseFilter){textureColor=textureColor*uFilterColor;}gl_FragColor=textureColor;}",defines:b.terrain?["TERRAIN"]:""},this);this.vertexBuffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.indexBuffer=new L({gl:a,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});
this.vertexArray=new sa({gl:a,program:this.program,attributes:[{name:"a_pos",buffer:this.vertexBuffer,stride:20,size:3,type:"FLOAT",offset:0},{name:"a_texture_coord",buffer:this.vertexBuffer,size:2,stride:20,type:"FLOAT",offset:12}]})}},{key:"onChanged",value:function(a,c){var b=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout(function(){b.loadTexture(function(){b.parseData(c);b.dataTime=new Date;b.webglLayer.render()})},0))}},{key:"render",value:function(a){var b=
a.gl,c=a.projectionMatrix;a=a.viewMatrix;var k=this.getOptions(),g=this.program,h=g.uniforms;g.use(b);this.texture&&(b.activeTexture(b.TEXTURE0),b.uniform1i(h.uTile,0),b.bindTexture(b.TEXTURE_2D,this.texture),b.activeTexture(b.TEXTURE1),b.uniform1i(h.uTerrain,1),b.bindTexture(b.TEXTURE_2D,this.terrainSampler),b.disable(b.CULL_FACE),g.setUniforms({u_proj_matrix:c,uUseFilter:!!k.filterColor,uFilterColor:this.normizedColor(k.filterColor||"rgba(0, 0, 100, 1.0)"),u_mv_matrix:a}),0<this.index.length&&(this.indexBuffer.bind(),
this.vertexArray.bind(),b.drawElements(b.TRIANGLES,this.index.length,b.UNSIGNED_INT,0)))}},{key:"loadTexture",value:function(a){var b=this,c=this.getOptions();c.tile?c.terrain?Ia(this.gl,c.terrain,function(d,f){b.terrainSampler=d;Ia(b.gl,c.tile,function(c,d){b.texture=c;a&&a();b.webglLayer.render()})},{TEXTURE_WRAP_S:"MIRRORED_REPEAT",TEXTURE_WRAP_T:"MIRRORED_REPEAT"}):Ia(this.gl,c.tile,function(c,d){b.texture=c;a&&a();b.webglLayer.render()}):(this.texture=null,a&&a())}},{key:"parseData",value:function(a){var b=
this,c=[],k=[];if(a&&a[0]){var g=a[0].geometry.coordinates[0];g=g.map(function(a){return b.normizedPoint(a)});a=g[0][0];var h=g[0][1],m=g[0][2],n=(g[2][0]-a)/16;g=(g[2][1]-h)/16;for(var p=0;16>=p;p++)for(var l=0;16>=l;l++)if(c.push(a+n*l,h+g*p,m),c.push(l/16,p/16),16>l&&16>p){var r=17*p+l,q=17*(p+1)+l;k.push(r,q+1,r+1);k.push(r,q,q+1)}}this.index=k;this.vertexBuffer.updateData(new Float32Array(c));this.indexBuffer.updateData(new Uint32Array(k))}}]);return a}(da),hh=function(c){function a(b,c){E(this,
a);return M(this,(a.__proto__||I(a)).call(this,b,c))}G(a,c);F(a,[{key:"getDefaultOptions",value:function(){return{}}},{key:"initialize",value:function(a){this.gl=a;var b=this.getOptions();this.texture=null;this.program=new Q(this.gl,{vertexShader:"precision highp float;attribute vec3 a_pos;attribute vec2 a_texture_coord;uniform mat4 u_proj_matrix;uniform mat4 u_mv_matrix;uniform vec2 u_size;uniform vec2 u_offset;varying vec2 v_texture_coord;void main(){v_texture_coord=a_texture_coord;vec3 pos=a_pos.xyz;vec4 position=u_proj_matrix*u_mv_matrix*vec4(pos,1.0);position.xyz=position.xyz/position.w;position.w=1.0;position.x=position.x+a_texture_coord.x*u_size.x/2.0/MAPV_resolution.x-u_offset.x/MAPV_resolution.x;position.y=position.y+a_texture_coord.y*u_size.y/2.0/MAPV_resolution.y-u_offset.y/MAPV_resolution.y;gl_Position=position;}",
fragmentShader:"precision highp float;varying vec2 v_texture_coord;uniform sampler2D u_icon;uniform vec4 uSelectedColor;void main(){vec4 textureColor=vec4(1.0,1.0,1.0,1.0);vec2 textureCoord=v_texture_coord;textureCoord=(textureCoord+1.0)/2.0;textureColor=texture2D(u_icon,vec2(textureCoord.s,textureCoord.t));if(textureColor.a==0.0){discard;}gl_FragColor=textureColor;\n#if defined(PICK)\nif(mapvIsPicked()){gl_FragColor=uSelectedColor;}\n#endif\n}",defines:b.enablePicked?["PICK"]:[]},this);this.vertexBuffer=
new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.indexBuffer=new L({gl:a,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});b=[{name:"a_pos",buffer:this.vertexBuffer,stride:20,size:3,type:"FLOAT",offset:0},{name:"a_texture_coord",buffer:this.vertexBuffer,size:2,stride:20,type:"FLOAT",offset:12}];b=b.concat(this.getCommonAttributes());this.vertexArray=new sa({gl:a,program:this.program,attributes:b})}},{key:"onChanged",value:function(a,c){var b=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),
this.loadTextureTime=setTimeout(function(){b.loadTexture(function(){b.parseData(c);b.dataTime=new Date;b.webglLayer.render()})},0))}},{key:"render",value:function(a){var b=a.gl,c=a.projectionMatrix,k=a.viewMatrix,g=this.getOptions(),h=this.program;h.use(b);if(this.texture){b.enable(b.BLEND);b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);var m=g.width||this.image.width,n=g.height||this.image.height;m*=window.devicePixelRatio;n*=window.devicePixelRatio;var p=0,l=0;g.offset&&(p=g.offset[0]*window.devicePixelRatio,
l=g.offset[1]*window.devicePixelRatio);h.setUniforms(U(this.getCommonUniforms(a),{u_icon:this.texture,u_proj_matrix:c,u_mv_matrix:k,u_size:[m,n],u_offset:[p,l]}));0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),b.drawElements(b.TRIANGLES,this.index.length,b.UNSIGNED_INT,0))}}},{key:"loadTexture",value:function(a){var b=this,c=this.getOptions();c.icon?Ia(this.gl,c.icon,function(c,d){b.image=d;b.texture=c;a&&a();b.webglLayer.render()}):(this.texture=null,a&&a())}},{key:"parseData",
value:function(a){for(var b=this.getOptions(),c=[],k=[],g=[],h=0;h<a.length;h++){var m=this.normizedPoint(a[h].geometry.coordinates);c.push(m[0],m[1],m[2]);c.push(-1,-1);c.push(m[0],m[1],m[2]);c.push(-1,1);c.push(m[0],m[1],m[2]);c.push(1,1);c.push(m[0],m[1],m[2]);c.push(1,-1);k.push(4*h,4*h+1,4*h+2);k.push(4*h,4*h+2,4*h+3);b.enablePicked&&(m=this.indexToRgb(h),g.push(m[0]/255,m[1]/255,m[2]/255),g.push(m[0]/255,m[1]/255,m[2]/255),g.push(m[0]/255,m[1]/255,m[2]/255),g.push(m[0]/255,m[1]/255,m[2]/255))}this.index=
k;this.vertexBuffer.updateData(new Float32Array(c));this.indexBuffer.updateData(new Uint32Array(k));b.enablePicked&&this.pickBuffer.updateData(new Float32Array(g))}}]);return a}(da),ih=function(c){function a(b){E(this,a);var c=M(this,(a.__proto__||I(a)).call(this,b));b=c.getOptions();c.shapeLayer=new ic({enablePicked:b.enablePicked});c.lineLayer=new Ee;c.children=[c.shapeLayer,c.lineLayer];return c}G(a,c);F(a,[{key:"pick",value:function(a,c){return this.shapeLayer.pick(a,c)}},{key:"onOptionsChanged",
value:function(a){this.shapeLayer.setOptions({onClick:function(b){a.onClick&&a.onClick(b)},selectedIndex:a.selectedIndex,selectedColor:a.selectedColor,height:0,autoSelect:a.autoSelect,color:a.fillColor,opacity:a.fillOpacity,topColor:a.fillColor,useLight:!1});this.lineLayer.setOptions({color:a.lineColor,width:a.lineWidth,lineJoin:a.lineJoin})}},{key:"onDataChanged",value:function(a){this.shapeLayer.setData(a);this.lineLayer.setData(a)}},{key:"getDefaultOptions",value:function(){return{enablePicked:!1,
selectedIndex:-1,selectedColor:"#ff0000",autoSelect:!0,lineColor:"rgba(250, 250, 25, 1)",lineWidth:2,lineJoin:"miter",fillColor:"rgba(25, 25, 250, 1)",fillOpacity:1}}}]);return a}(ib);X.prototype.parseColors=function(c){this.arrFeatureStyles=[[2,c[0]||"rgba(79,210,125,1)",2,2,0,[],0,0],[2,c[0]||"rgba(79,210,125,1)",3,2,0,[],0,0],[2,c[0]||"rgba(79,210,125,1)",3,2,0,[],0,0],[2,c[0]||"rgba(79,210,125,1)",5,2,0,[],0,0],[2,c[0]||"rgba(79,210,125,1)",6,2,0,[],0,0],[2,c[2]||"rgba(255,208,69,1)",2,2,0,[],
0,0],[2,c[2]||"rgba(255,208,69,1)",3,2,0,[],0,0],[2,c[2]||"rgba(255,208,69,1)",3,2,0,[],0,0],[2,c[2]||"rgba(255,208,69,1)",5,2,0,[],0,0],[2,c[2]||"rgba(255,208,69,1)",6,2,0,[],0,0],[2,c[1]||"rgba(232,14,14,1)",2,2,0,[],0,0],[2,c[1]||"rgba(232,14,14,1)",3,2,0,[],0,0],[2,c[1]||"rgba(232,14,14,1)",3,2,0,[],0,0],[2,c[1]||"rgba(232,14,14,1)",5,2,0,[],0,0],[2,c[1]||"rgba(232,14,14,1)",6,2,0,[],0,0],[2,c[3]||"rgba(181,0,0,1)",2,2,0,[],0,0],[2,c[3]||"rgba(181,0,0,1)",3,2,0,[],0,0],[2,c[3]||"rgba(181,0,0,1)",
3,2,0,[],0,0],[2,c[3]||"rgba(181,0,0,1)",5,2,0,[],0,0],[2,c[3]||"rgba(181,0,0,1)",6,2,0,[],0,0],[2,"rgba(255,255,255,1)",4,0,0,[],0,0],[2,"rgba(255,255,255,1)",5.5,0,0,[],0,0],[2,"rgba(255,255,255,1)",7,0,0,[],0,0],[2,"rgba(255,255,255,1)",8.5,0,0,[],0,0],[2,"rgba(255,255,255,1)",10,0,0,[],0,0]]};X.prototype.setColors=function(c){this.parseColors(c)};X.prototype.initialize=function(c){this._initialize||(this._initialize=!0)};X.prototype.clearCache=function(c){this.cache={}};X.prototype.setMap=function(c){c?
(this.map=c,this._initialize?this.canvaslayer.show():this.initialize(c)):this.canvaslayer.hide()};X.prototype.draw=function(c){c=c||{};c.clearCache&&this.clearCache();this.canvaslayer.draw()};X.prototype.clear=function(){};X.prototype.update=function(){var c=this.map,a=this.getDataZoom(),b=Math.pow(2,18-a),d=256*b,f=c.getCenter(),k=Math.ceil(f.lng/d),g=Math.ceil(f.lat/d),h=this.tileSize,m=a-Math.round(c.getZoom());0<m&&(h/=Math.pow(2,m));d=[k,g,(f.lng-k*d)/d*h,(f.lat-g*d)/d*h];k=c.getBounds();f=k.getNorthEast();
k=k.getSouthWest();c.getSize();c.getSize();c=(f.lng-k.lng)/b;b=(f.lat-k.lat)/b;f=d[1]-Math.ceil((b/2-d[3])/h);k=d[0]+Math.ceil((c/2+d[2])/h);g=d[1]+Math.ceil((b/2+d[3])/h);b=[];for(h=d[0]-Math.ceil((c/2-d[2])/h);h<k;h++)for(d=f;d<g;d++)b.push([h,d,a]);this.tilesOrder=b;this._loadCount={};for(h=0;h<b.length;h++)d=b[h][0],c=b[h][1],this._loadCount[d+"_"+c+"_"+b[h][2]]=!1;for(h=0;h<b.length;h++)d=b[h][0],c=b[h][1],this.showTile(d,c,a)};X.prototype.showTile=function(c,a,b){this._parseDataAndDraw(c,a,
b)};X.prototype.drawCurrentData=function(){this.clear();for(var c=[],a=0;a<this.tilesOrder.length;a++){var b=this.tilesOrder[a][0],d=this.tilesOrder[a][1],f=this.tilesOrder[a][2],k=this.cache[this.getCacheKey(b,d,f)];if(k)for(b=this._drawFeatures(k,b,d,f),d=0;d<b.length;d++)c.push(b[d])}this.lineLayer.setData(c)};X.prototype.isAllLoaded=function(){var c=!0,a;for(a in this._loadCount)if(!this._loadCount[a]){c=!1;break}return c};X.prototype.getCacheKey=function(c,a,b){return c+"_"+a+"_"+b};X.prototype.getDataZoom=
function(){var c=Math.round(this.map.getZoom());19<c&&(c=19);return c};X.prototype._parseDataAndDraw=function(c,a,b){var d=this,f=d.map,k=f.getCenter(),g=Math.round(f.getZoom()),h=this.getCacheKey(c,a,b),m="_cbk"+(1E5*Math.random()).toFixed(0),n=this.getTileUrl(c,a,b,"BMapGL."+m);BMapGL[m]=function(p){d._loadCount[c+"_"+a+"_"+b]=!0;var l=f.getCenter(),n=Math.round(f.getZoom());l.equals(k)&&n===g?(l=p.content&&p.content.tf,p.data&&(l=p.data),d.cache[h]=l?{traffic:l,precision:p.precision}:null,d.drawTogether&&
d.isAllLoaded()&&d.drawCurrentData()):n!==g&&d.clear();delete BMapGL[m]};void 0!==d.cache[h]?(d._loadCount[c+"_"+a+"_"+b]=!0,d.drawTogether&&d.isAllLoaded()&&d.drawCurrentData()):this.request(n)};X.prototype.getTileUrl=function(c,a,b,d){return"https://sp3.baidu.com/7_AZsjOpB1gCo2Kml5_Y_DAcsMJiwa/traffic/?qt=vtraffic&x="+c+"&y="+a+"&z="+b+"&fn="+d+"&t="+(new Date).getTime()};X.prototype._drawFeatures=function(c,a,b,d){var f=10;d=Math.pow(2,18-d);this.map.getCenter();var k=this.tileSize;a=[a*k*d,(b+
1)*k*d];b=[];if(c&&c.traffic){f*=c.precision;c=c.traffic;k=0;for(var g=c.length;k<g;k++){var h=c[k],m=h[1];h=this.arrFeatureStyles[h[3]];var n=m[0]/f,p=-m[1]/f,l=[];l.push([a[0]+n*d,a[1]+p*d]);for(var r=2,q=m.length;r<q;r+=2)n+=m[r]/f,p-=m[r+1]/f,l.push([a[0]+n*d,a[1]+p*d,1]);b.push({color:h[1],geometry:{type:"LineString",coordinates:l}})}}return b};X.prototype.request=function(c,a){if(a){var b=(1E5*Math.random()).toFixed(0);BMapGL._rd["_cbk"+b]=function(c){a&&a(c);delete BMapGL._rd["_cbk"+b]};c+=
"&callback=BMapGL._rd._cbk"+b}var d=document.createElement("script");d.type="text/javascript";d.charset="utf-8";d.src=c;d.addEventListener?d.addEventListener("load",function(a){a=a.target;a.parentNode.removeChild(a)},!1):d.attachEvent&&d.attachEvent("onreadystatechange",function(a){a=window.event.srcElement;!a||"loaded"!==a.readyState&&"complete"!==a.readyState||a.parentNode.removeChild(a)});setTimeout(function(){document.getElementsByTagName("head")[0].appendChild(d);d=null},1)};X.prototype.getRGBA=
function(c){c>>>=0;return"rgba("+(c>>24&255)+","+(c>>16&255)+","+(c>>8&255)+","+(c&255)/256+")"};X.prototype.getLineCap=function(c){return["butt","square","round"][c]};X.prototype.getLineJoin=function(c){return["miter","bevel","round"][c]};var jh=function(c){function a(b){E(this,a);b=M(this,(a.__proto__||I(a)).call(this,b));b.autoUpdate=!0;b.getOptions();var c=new Ke({color:"rgba(257, 254, 47, 0.9)",zoom:18,duration:.8,interval:.2,trailLength:.4}),f=new Fe({height:5,color:"rgba(257, 254, 47, 0.9)",
trailLength:2,step:.02,startTime:0,endTime:4});b.lineLayer=c;b.wallTripLayer=f;b.children=[c,f];return b}G(a,c);F(a,[{key:"initialize",value:function(b){Ra(a.prototype.__proto__||I(a.prototype),"initialize",this).call(this,b);b=this.map.map;var c=new X({});c.lineLayer=this.lineLayer;c.wallTripLayer=this.wallTripLayer;this.trafficTileManager=c;c.setMap(b);c.update();b.addEventListener("moveend",function(){c.update()});b.addEventListener("zoomend",function(){c.update()});b.addEventListener("ondraw",
function(){})}},{key:"onOptionsChanged",value:function(a){}},{key:"onDataChanged",value:function(a){}},{key:"getDefaultOptions",value:function(){return{}}}]);return a}(ib),kh=function(c){function a(b,c){E(this,a);b=M(this,(a.__proto__||I(a)).call(this,b,c));b.bufferData=[];return b}G(a,c);F(a,[{key:"getDefaultOptions",value:function(){return{size:13,unit:"px",height:0,max:100,min:0}}},{key:"initialize",value:function(a){var b=this;this.gl=a;var c=this.getOptions();this.inverseMatrix=T.create(Float64Array);
this.frameBuffer=new pa(a);this.webglLayer.map.onResize(function(){b.frameBuffer=new pa(a)});this.circle=cf(64);this.circleTexture=bb(a,this.circle,{TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"});this.intensity=new ia({gradient:c.gradient});this.paletteTexture=bb(a,this.intensity.paletteCtx.canvas,{TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"});this.offlineProgram=
new Q(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform mat4 pointToPixelMatrix;uniform mat4 pixelToViewMatrix;uniform mat4 projectionMatrix;uniform int unit;uniform float size;uniform float max;uniform float min;attribute vec3 aPos;attribute vec2 aOffset;attribute float aCount;varying vec2 vOffset;varying float vCount;varying vec3 vPosition;void main(){vOffset=aOffset;vCount=(aCount-min)/(max-min);if(unit==1){vec2 pos=(pointToPixelMatrix*vec4(aPos.xy,0.0,1.0)).xy+aOffset.xy*size/2.0;gl_Position=projectionMatrix*pixelToViewMatrix*vec4(pos,0.0,1.0);}else{vec2 pos=aPos.xy+aOffset.xy*size;gl_Position=u_matrix*vec4(pos,0.0,1.0);}vPosition=vec3(gl_Position.z/gl_Position.w);}",
fragmentShader:"varying vec2 vOffset;varying float vCount;varying vec3 vPosition;uniform sampler2D uCircle;void main(){vec4 circle=texture2D(uCircle,(vOffset+1.0)/2.0);float intensity=circle.a*vCount;if(intensity<=0.0){discard;}gl_FragColor=vec4(vPosition,intensity);}"},this);this.offlineBuffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.offlineIndexBuffer=new L({gl:a,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});this.offlineVertexArray=new sa({gl:a,program:this.offlineProgram,
attributes:[{stride:24,name:"aPos",buffer:this.offlineBuffer,size:3,type:"FLOAT",offset:0},{stride:24,name:"aOffset",buffer:this.offlineBuffer,size:2,type:"FLOAT",offset:12},{stride:24,name:"aCount",buffer:this.offlineBuffer,size:1,type:"FLOAT",offset:20}]});this.indexBuffer=new L({gl:a,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});this.program=new Q(this.gl,{vertexShader:"attribute vec2 aPos;varying vec2 vPos;uniform float uHeight;uniform mat4 pixelToViewMatrix;uniform mat4 projectionMatrix;uniform sampler2D u_sampler;uniform mat4 inverseMatrix;void main(){vPos=aPos;if(uHeight<=0.0){gl_Position=vec4(aPos,0.0,1.0);}else{vec4 gray=texture2D(u_sampler,(aPos+1.0)/2.0);vec4 m0=inverseMatrix*vec4(aPos.xy,0.0,1.0);vec4 m1=inverseMatrix*vec4(aPos.xy,1.0,1.0);m0/=m0.w;m1/=m1.w;vec4 pixel=m0+(-m0.z/(m1.z-m0.z))*(m1-m0);pixel.z=uHeight*gray.a;gl_Position=projectionMatrix*pixelToViewMatrix*vec4(pixel.xyz,1.0);}}",
fragmentShader:"uniform sampler2D u_sampler;uniform sampler2D u_samplerPalette;uniform float uHeight;varying vec2 vPos;void main(){vec4 gray=texture2D(u_sampler,(vPos+1.0)/2.0);float grayAlpha=gray.a;if(grayAlpha<=0.0){discard;}vec4 color=texture2D(u_samplerPalette,vec2(grayAlpha,1.0));gl_FragColor=vec4(color.rgb,grayAlpha);}"},this);this.buffer=new L({gl:a,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.vertexArray=new sa({gl:a,program:this.program,attributes:[{stride:8,name:"aPos",buffer:this.buffer,
size:2,type:"FLOAT",offset:0}]});c=[];for(var k=[],g=Math.floor(a.canvas.width/4),h=Math.floor(a.canvas.height/4),m=g+1,n=0;n<=h;n++)for(var p=0;p<=g;p++)if(c.push(2*p/g-1,2*n/h-1),p<g&&n<h){var l=m*n+p,r=m*(n+1)+p;k.push(l,r+1,l+1);k.push(l,r,r+1)}this.bufferData=c;this.buffer.updateData(new Float32Array(c));this.indexData=k;this.indexBuffer.updateData(new Uint32Array(k))}},{key:"onOptionsChanged",value:function(a,c){var b=this.gl;b&&a.gradient!==c.gradient&&(this.intensity=new ia({gradient:a.gradient}),
this.paletteTexture=bb(b,this.intensity.paletteCtx.canvas,{TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}))}},{key:"onDataChanged",value:function(a){if(this.gl){var b=[],c=[];this.getOptions();for(var k=0;k<a.length;k++){var g=a[k],h=this.normizedPoint(a[k].geometry.coordinates),m=void 0===g.count?1:g.count;"properties"in g&&"count"in g.properties&&(m=g.properties.count);b.push(h[0],h[1],h[2]);b.push(-1,-1);b.push(m);b.push(h[0],
h[1],h[2]);b.push(-1,1);b.push(m);b.push(h[0],h[1],h[2]);b.push(1,1);b.push(m);b.push(h[0],h[1],h[2]);b.push(1,-1);b.push(m);g=4*k;c.push(g+0,g+1,g+2);c.push(g+0,g+2,g+3)}this.offlineBufferData=b;this.offlineIndexData=c;this.offlineBuffer.updateData(new Float32Array(b));this.offlineIndexBuffer.updateData(new Uint32Array(c))}}},{key:"render",value:function(a){var b=a.gl,c=a.matrix,k=a.pointToPixelMatrix,g=a.pixelToViewMatrix;a=a.projectionMatrix;if(this.offlineBufferData&&!(0>=this.offlineBufferData.length)){var h=
this.getOptions();b.enable(b.BLEND);b.disable(b.DEPTH_TEST);b.blendFunc(b.ONE,b.ONE);b.bindFramebuffer(b.FRAMEBUFFER,this.frameBuffer.framebuffer);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT);this.offlineProgram.use(b);this.offlineProgram.setUniforms({u_matrix:c,uCircle:this.circleTexture,pointToPixelMatrix:k,pixelToViewMatrix:g,projectionMatrix:a,unit:"px"===h.unit?1:0,size:h.size,max:h.max,min:h.min});this.offlineVertexArray.bind();this.offlineIndexBuffer.bind();b.drawElements(b.TRIANGLES,
this.offlineIndexData.length,b.UNSIGNED_INT,0);b.bindFramebuffer(b.FRAMEBUFFER,null);this.program.use(b);this.vertexArray.bind();c=this.inverseMatrix;T.identity(c);T.multiply(c,a,g);T.invert(c,c);b.enable(b.DEPTH_TEST);b.disable(b.BLEND);this.program.setUniforms({u_sampler:this.frameBuffer.framebuffer.texture,u_samplerPalette:this.paletteTexture,uHeight:h.height,pixelToViewMatrix:g,inverseMatrix:c,projectionMatrix:a});this.indexBuffer.bind();b.drawElements(b.TRIANGLES,this.indexData.length,b.UNSIGNED_INT,
0)}}}]);return a}(da),lh=function(){function c(a){E(this,c);this.layers=[];this.options=a;this.webglLayer=a.webglLayer}F(c,[{key:"addLayer",value:function(a){for(var b=!1,c=0;c<this.layers.length;c++)if(this.layers[c]===a){b=!0;break}b||(a.map=this.webglLayer.map,"threeLayer"===a.layerType?(a.setWebglLayer(this.webglLayer),b=a.getThreeLayer(),this.addLayer(b),a.initialize&&a.initialize(b)):(a.setWebglLayer(this.webglLayer),a.commonInitialize&&a.commonInitialize(this.webglLayer.gl),a.initialize&&a.initialize(this.webglLayer.gl),
a.onOptionsChanged(a.getOptions(),{}),a.onDataChanged(a.getData()),a.onChanged(a.getOptions(),a.getData())),this.layers.push(a));this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation());this.webglLayer.render()}},{key:"removeLayer",value:function(a){for(var b=0;b<this.layers.length;b++)this.layers[b]===a&&(a.destroy&&a.destroy(),this.layers.splice(b,1));this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():
this.webglLayer.stopAnimation());this.webglLayer.render()}},{key:"removeAllLayers",value:function(){for(var a=0;a<this.layers.length;a++){var b=this.layers[a];b.destroy&&b.destroy();this.layers.splice(a,1)}this.webglLayer.render()}},{key:"isRequestAnimation",value:function(){for(var a=!1,b=0;b<this.layers.length;b++)if(this.layers[b].isRequestAnimation()){a=!0;break}return a}},{key:"beforeRender",value:function(a){a.gl&&this.webglLayer.stateManager.save()}},{key:"afterRender",value:function(a){a.gl&&
this.webglLayer.stateManager.restore()}},{key:"renderGLLayers",value:function(a){this.webglLayer.stateManager.save();this.webglLayer.stateManager.setDefaultState();for(var b=0;b<this.layers.length;b++){var c=this.layers[b];"threeLayer"!==c.layerType&&"ThreeLayer"!==c.layerType&&(this.beforeRender(a),a.gl.enable(a.gl.DEPTH_TEST),a.gl.depthFunc(a.gl.LEQUAL),a.gl.enable(a.gl.POLYGON_OFFSET_FILL),a.gl.polygonOffset(1,1),c.render(a),this.afterRender(a))}this.webglLayer.stateManager.restore()}},{key:"renderThreeLayer",
value:function(a){for(var b=0;b<this.layers.length;b++){var c=this.layers[b];"ThreeLayer"===c.layerType&&c.render(a)}}},{key:"renderThreeLayers",value:function(a){for(var b=0;b<this.layers.length;b++){var c=this.layers[b];"threeLayer"===c.layerType&&(this.beforeRender(a),c.render(a),this.afterRender(a))}}},{key:"onClick",value:function(a){for(var b=0;b<this.layers.length;b++){var c=this.layers[b];if("threeLayer"!==c.layerType&&"ThreeLayer"!==c.layerType&&c.options.enablePicked&&c.options.onClick&&
c.pick){var f=c.pick(a.x,a.y);c.options.onClick(f)}}}},{key:"onMousemove",value:function(a){for(var b=!1,c=0;c<this.layers.length;c++){var f=this.layers[c];if("threeLayer"!==f.layerType&&"ThreeLayer"!==f.layerType&&f.options.enablePicked&&f.options.autoSelect&&f.pick){b=!0;var k=f.pick(a.x,a.y);f.options.onMousemove&&f.options.onMousemove(k)}}b&&(this.webglLayer.isAnimation||this.webglLayer.render())}}]);return c}(),mh=function(){function c(a){var b=this;E(this,c);this.options={autoUpdate:!0};U(this.options,
a);var d=a.pointOffset;this.webglLayer=a.webglLayer||new He(a.map,this.options);this.layerManager=new lh({autoUpdate:this.options.autoUpdate,webglLayer:this.webglLayer});this.effectManager=new se(this.webglLayer.gl);this.webglRender={render:function(){}};this.options.effects&&this.effectManager.setEffects([this.webglRender].concat(this.options.effects));this.webglLayer.onRender(function(a){b._render(a)});this.webglLayer.onClick=function(a){b.layerManager.onClick(a)};this.webglLayer.onMousemove=function(a){b.layerManager.onMousemove(a)};
d||"cesium"===this.webglLayer.options.mapType||(d=this.webglLayer.map.getCenter(),this.webglLayer.options.pointOffset=[d.lng,d.lat]);this.webglLayer.map.onResize(function(){b.effectManager.onResize()});if(this.postProcessing=a.postProcessing)this.postProcessing.setWebglLayer(this.webglLayer),a=this.postProcessing.getThreeLayer(),this.addLayer(a),this.postProcessing.initialize(a),a.postProcessing=this.postProcessing}F(c,[{key:"renderCanvas",value:function(a){var b=this;this.postProcessing?(this.postProcessing.addRender(function(){b.renderGLLayers(a)}),
this.layerManager.renderThreeLayers(a),this.layerManager.renderThreeLayer(a)):(this.layerManager.renderThreeLayers(a),this.layerManager.renderThreeLayer(a),this.layerManager.renderGLLayers(a))}},{key:"render",value:function(){this.webglLayer.render()}},{key:"_render",value:function(a){var b=this,c=this.options.effects;c&&0<c.length?(this.webglRender.render=function(){b.renderCanvas(a)},this.effectManager.render()):(this.webglLayer.saveFramebuffer(),this.renderCanvas(a),this.webglLayer.restoreFramebuffer())}},
{key:"onRender",value:function(a){this.webglLayer.onRender(a)}},{key:"destroy",value:function(){this.stopAnimation();this.layerManager.removeAllLayers();this.webglLayer.destroy()}},{key:"isRequestAnimation",value:function(){return this.layerManager.isRequestAnimation()}},{key:"startAnimation",value:function(){this.webglLayer.startAnimation()}},{key:"stopAnimation",value:function(){this.webglLayer.stopAnimation()}},{key:"addLayer",value:function(a){this.layerManager.addLayer(a)}},{key:"removeLayer",
value:function(a){this.layerManager.removeLayer(a)}}]);return c}();window._hmt=window._hmt||[];(function(){var c=document.createElement("script");c.src="https://hm.baidu.com/hm.js?e8002ef3d9e0d8274b5b74cc4a027d08";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(c,a)})();w.View=mh;w.GridLayer=Be;w.HeatGridLayer=Gg;w.ShapeLayer=ic;w.SimpleLineLayer=Ce;w.LineLayer=Ee;w.WallSpriteLayer=Fe;w.LinePointLayer=ab;w.WallLayer=Pg;w.WallTripLayer=Rg;w.HeatLineLayer=Sg;w.HoneycombLayer=
Ug;w.WebglLayer=He;w.PointLayer=Yc;w.RippleLayer=$g;w.SparkLayer=ah;w.ClusterLayer=bh;w.HeatPointLayer=ch;w.ShapeLineLayer=dh;w.PointTripLayer=eh;w.LineTripLayer=fh;w.LineFlowLayer=Ke;w.TileLayer=gh;w.IconLayer=hh;w.PolygonLayer=ih;w.Layer=da;w.TextLayer=Xc;w.TrafficLayer=jh;w.HeatmapLayer=kh;w.BlurEffect=ug;w.BloomEffect=vg;w.BrightEffect=wg;w.DepthEffect=xg;w.EffectManager=se;w.getContext=dd;w.createTexture=bb;w.loadTextureImage=Ia;w.FrameBufferObject=pa;w.Program=Q;w.StateManager=re;w.Buffer=L;
w.VertexArray=sa;w.CommonLayer=Pc;w.MercatorProjection=ra;w.Canvas=rc;w.Intensity=ia;w.BezierCurve=Ha;w.GeodesicCurve=Oa;w.toRadian=fa;w.toAngle=nc;w.ceilPowerOfTwo=oc;w.floorPowerOfTwo=pc;w.approximatelyEqual=qc;w.__moduleExports=va;w.vec4=hc;w.vec3=Ib;w.vec2=yg;w.quat2=zg;w.quat=Ag;w.mat4=T;w.mat3=Bg;w.mat2d=Cg;w.mat2=Dg;w.glMatrix=Eg;Object.defineProperty(w,"__esModule",{value:!0})});
